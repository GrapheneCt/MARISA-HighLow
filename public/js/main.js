!function(t){var e={};function i(o){if(e[o])return e[o].exports;var n=e[o]={i:o,l:!1,exports:{}};return t[o].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,o){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(o,n,function(e){return t[e]}.bind(null,n));return o},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/js/",i(i.s=39)}([function(t,e,i){"use strict";t.exports=i(41)},function(t,e,i){"use strict";var o={inherit:function(t,e){for(var i in t.prototype=function(t){if(Object.create)return Object.create(t);var e=function(){};return e.prototype=t,new e}(e.prototype),t.prototype.constructor=t,e)t[i]=e[i]},loop:function(t,e){for(var i=0;i<t;i++)e(i)},radianToTheta:function(t){return 180*t/Math.PI|0},thetaToRadian:function(t){return t*Math.PI/180},calcMoveXByVelocity:function(t){return t.magnitude*Math.cos(o.thetaToRadian(t.theta))},calcMoveYByVelocity:function(t){return t.magnitude*Math.sin(o.thetaToRadian(t.theta))},hexToRGBString:function(t){var e="#"===t.charAt(0)?t.substring(1,7):t;return"rgb("+parseInt(e.substring(0,2),16)+", "+parseInt(e.substring(2,4),16)+", "+parseInt(e.substring(4,6),16)+")"},clamp:function(t,e,i){return t<e?e:t>i?i:t},isElectron:function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)},canPlayOgg:function(){var t=document.createElement("audio");return!!t.canPlayType&&t.canPlayType("audio/ogg")},getRandomInt:function(t,e){return 1===arguments.length&&(e=arguments[0],t=1),Math.floor(Math.random()*(e-t+1))+t},downloadBlob:function(t,e){var i=(window.URL||window.webkitURL).createObjectURL(t),o=document.createEvent("MouseEvents");o.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null);var n=document.createElementNS("http://www.w3.org/1999/xhtml","a");n.href=i,n.download=e,n.dispatchEvent(o)},shallowCopyHash:function(t){var e={};for(var i in t)e[i]=t[i];return e},assign:function(t,e){if(!t)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(t),o=1;o<arguments.length;o++){var n=arguments[o];if(n)for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(i[r]=n[r])}return i},bind:function(t,e){if("function"!=typeof t)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var i=Array.prototype.slice.call(arguments,1),o=t,n=function(){},r=function(){return o.apply(t instanceof n?t:e,i.concat(Array.prototype.slice.call(arguments)))};return t.prototype&&(n.prototype=t.prototype),r.prototype=new n,r},defineProperty:function(t,e){var i="_"+e;t.prototype[e]=function(t){return void 0!==t&&(this[i]=t),this[i]}}};t.exports=o},function(t,e,i){"use strict";var o=i(0).Util,n={DEBUG:!0,DEBUG_MUTE:!1,DEBUG_SCENE:"rule",TYPE_RED:0,TYPE_BLUE:1,TYPE_GREEN:2,TYPE_PURPLE:3,COLOR_BLACK:o.hexToRGBString("272727"),COLOR_WHITE:o.hexToRGBString("FBF5F3"),COLOR_RED:o.hexToRGBString("DB2B39"),COLOR_BLUE:o.hexToRGBString("0A34DB"),COLOR_GREEN:o.hexToRGBString("317B22"),COLOR_PURPLE:o.hexToRGBString("801A86"),COLOR_VIVID_RED:"red",OPEN_CARD_X:330,OPEN_CARD_Y:330,TOP_CARD_X:130,TOP_CARD_Y:330,MARISA_CENTER_X:600,MARISA_CENTER_Y:350,CLEAR_NEED_MONEY:1e8,EX_CLEAR_NEED_MONEY:2e9};t.exports=n},function(t,e,i){"use strict";var o=i(23);t.exports=o.object_base},function(t,e){var i={EPSILON:1e-6};i.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,i.RANDOM=Math.random,i.ENABLE_SIMD=!1,i.SIMD_AVAILABLE=i.ARRAY_TYPE===Float32Array&&"SIMD"in this,i.USE_SIMD=i.ENABLE_SIMD&&i.SIMD_AVAILABLE,i.setMatrixArrayType=function(t){i.ARRAY_TYPE=t};var o=Math.PI/180;i.toRadian=function(t){return t*o},i.equals=function(t,e){return Math.abs(t-e)<=i.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))},t.exports=i},function(t,e,i){"use strict";t.exports={BUTTON_LEFT:1,BUTTON_UP:2,BUTTON_RIGHT:4,BUTTON_DOWN:8,BUTTON_Z:16,BUTTON_X:32,BUTTON_SHIFT:64,BUTTON_SPACE:128}},function(t,e,i){"use strict";var o=i(5),n=i(1),r={0:o.BUTTON_Z,1:o.BUTTON_X,2:o.BUTTON_SPACE,3:o.BUTTON_SHIFT},s=function(){this._current_keyflag=0,this._before_keyflag=0,this._key_bit_code_to_down_time={},this._button_id_to_key_bit_code=n.shallowCopyHash(r),this._is_left_clicked=!1,this._is_right_clicked=!1,this._before_is_left_clicked=!1,this._before_is_right_clicked=!1,this._mouse_change_x=0,this._mouse_change_y=0,this._mouse_x=0,this._mouse_y=0,this._mouse_scroll=0,this._touch_infos={},this._before_is_touched_map={},this._is_touched_map={},this._touch_ids=[],this._click_position_width_ratio=1,this._click_position_height_ratio=1,this._is_gamepad_usable=!1};s.prototype.init=function(){this._current_keyflag=0,this._before_keyflag=0,this._initPressedKeyTime(),this._button_id_to_key_bit_code=n.shallowCopyHash(r),this._is_left_clicked=!1,this._is_right_clicked=!1,this._before_is_left_clicked=!1,this._before_is_right_clicked=!1,this._mouse_change_x=0,this._mouse_change_y=0,this._mouse_x=0,this._mouse_y=0,this._mouse_scroll=0,this._touch_infos={},this._before_is_touched_map={},this._is_touched_map={},this._touch_ids=[],this._click_position_width_ratio=1,this._click_position_height_ratio=1},s.prototype.beforeRun=function(){this._handleGamePad(),this._setPressedKeyTime(),this._setTouchAsMouse()},s.prototype.afterRun=function(){for(var t in this._before_keyflag=this._current_keyflag,this._before_is_left_clicked=this._is_left_clicked,this._before_is_right_clicked=this._is_right_clicked,this._mouse_scroll=0,this._mouse_change_x=0,this._mouse_change_y=0,this._before_is_touched_map={},this._touch_infos){var e=this._touch_infos[t];e.change_x=0,e.change_y=0,t in this._is_touched_map&&(this._before_is_touched_map[t]=!0)}},s.prototype.setupEvents=function(t){var e=this;window.onkeydown=function(t){e._handleKeyDown(t)},window.onkeyup=function(t){e._handleKeyUp(t)},t.onmousedown=function(t){e._handleMouseDown(t)},t.onmouseup=function(t){e._handleMouseUp(t)},t.onmousemove=function(t){e._handleMouseMove(t)},t.ontouchstart=function(t){e._handleTouchDown(t)},t.ontouchend=function(t){e._handleTouchUp(t)},t.ontouchmove=function(t){e._handleTouchMove(t)};var i=window.navi&&/Firefox/i.test(window.navigator.userAgent)?"DOMMouseScroll":"mousewheel";t.addEventListener&&t.addEventListener(i,function(t){var i=window.event||t;e._handleMouseWheel(i)},!1),t.oncontextmenu=function(){return!1},window.Gamepad&&window.navigator&&window.navigator.getGamepads&&(e._is_gamepad_usable=!0)},s.prototype.scaleClickPosition=function(t,e){this._click_position_width_ratio=t,this._click_position_height_ratio=e},t.exports=s},function(t,e,i){"use strict";var o=i(3),n=function(t,e){o.apply(this,arguments),e=e||{},this._default_property={x:e.x||0,y:e.y||0,children:e.children||[]},this._event_to_callback={beforedraw:null,click:null,draw:null,touch:null},this.objects=this._default_property.children,this._show_call_count=0,this._is_touched=!1};i(1).inherit(n,o),n.prototype.init=function(){this.objects=this._default_property.children,o.prototype.init.apply(this,arguments),this._show_call_count=0,this._is_touched=!1,this.x(this._default_property.x),this.y(this._default_property.y),this.show()},n.prototype.beforeDraw=function(){var t,e;if(o.prototype.beforeDraw.apply(this,arguments),this.isEventSet("beforedraw")&&this._callEvent("beforedraw"),this.isEventSet("click")&&this.core.input_manager.isLeftClickPush()&&(t=this.core.input_manager.mousePositionX(),e=this.core.input_manager.mousePositionY(),this.checkCollisionWithPosition(t,e)&&this._callEvent("click")),this.isEventSet("touch")){var i=this.core.input_manager.getTouch(0);t=i.x(),e=i.y(),i.isTap()?this._is_touched=!0:i.isTouchRelease()&&(this.checkCollisionWithPosition(t,e)&&this._callEvent("touch"),this._is_touched=!1)}},n.prototype.draw=function(){this.isShow()&&(o.prototype.draw.apply(this,arguments),this.isEventSet("draw")&&this._callEvent("draw"))},n.prototype.on=function(t,e){return this._event_to_callback[t]=e,this},n.prototype.removeEvent=function(t){return this._event_to_callback[t]=null,this},n.prototype.isEventSet=function(t){return!!this._event_to_callback[t]},n.prototype.isShow=function(){return this._show_call_count>0},n.prototype.collisionWidth=function(){return this.width()},n.prototype.collisionHeight=function(){return this.height()},n.prototype.show=function(){this._show_call_count=1},n.prototype.hide=function(){this._show_call_count=0},n.prototype._callEvent=function(t){this._event_to_callback[t].apply(this)},t.exports=n},function(t,e,i){"use strict";var o=i(0).Scene.Base,n=function(t){o.apply(this,arguments)};i(0).Util.inherit(n,o),t.exports=n},function(t,e,i){"use strict";var o=i(3),n=i(1),r=function(t){this.core=t,this.parent=null,this.width=this.core.width,this.height=this.core.height,this._x=0,this._y=0,this.frame_count=0,this.objects=[],this.current_scene=null,this._reserved_next_scene=null,this._is_reserved_next_scene_init=!0,this.scenes={},this._wait_to_start_bgm_name=null,this._wait_to_start_bgm_duration=null,this._wait_to_start_bgm_start_frame_count=null,this._background_color=null,this.ui=new s(this),this.addObject(this.ui)};r.prototype.init=function(){this.current_scene=null,this._reserved_next_scene=null,this._is_reserved_next_scene_init=!0,this._x=0,this._y=0,this.frame_count=0,this._wait_to_start_bgm_name=null,this._wait_to_start_bgm_duration=null,this._wait_to_start_bgm_start_frame_count=null;for(var t=0,e=this.objects.length;t<e;t++)this.objects[t].init()},r.prototype.beforeDraw=function(){this._wait_to_start_bgm_name&&this.frame_count-this._wait_to_start_bgm_start_frame_count>=this._wait_to_start_bgm_duration&&(this.core.audio_loader.playBGM(this._wait_to_start_bgm_name),this._wait_to_start_bgm_name=null,this._wait_to_start_bgm_duration=null,this._wait_to_start_bgm_start_frame_count=null),this.changeNextSubSceneIfReserved();for(var t=0,e=this.objects.length;t<e;t++)this.objects[t].beforeDraw();this.currentSubScene()&&this.currentSubScene().beforeDraw(),this.frame_count++},r.prototype.draw=function(){this._drawBackground();for(var t=0,e=this.objects.length;t<e;t++)this.objects[t].draw();this.currentSubScene()&&this.currentSubScene().draw()},r.prototype._drawBackground=function(){var t=this.core.ctx;this._background_color&&(t.save(),t.fillStyle=this._background_color,t.fillRect(0,0,this.width,this.height),t.restore())},r.prototype.afterDraw=function(){for(var t=0,e=this.objects.length;t<e;t++)this.objects[t].afterDraw();this.currentSubScene()&&this.currentSubScene().afterDraw()},r.prototype.addObject=function(t){this.objects.push(t)},r.prototype.addObjects=function(t){this.objects=this.objects.concat(t)},r.prototype.removeAllObject=function(){this.objects=[]},r.prototype.removeObject=function(t){for(var e=0,i=this.objects.length;e<i;e++)if(this.objects[e].id===t.id){this.objects.splice(e,1);break}},r.prototype.setParent=function(t){if(this.parent)throw new Error("already set parent");this.parent=t},r.prototype.resetParent=function(){this.parent=null},r.prototype.currentSubScene=function(){if(null!==this.current_scene)return this.scenes[this.current_scene]},r.prototype.getSubScene=function(t){return this.scenes[t]},r.prototype.addSubScene=function(t,e){e.setParent(this),this.scenes[t]=e},r.prototype.changeSubScene=function(){var t=Array.prototype.slice.call(arguments);this._reserved_next_scene=t,this._is_reserved_next_scene_init=!0,this.current_scene||this.changeNextSubSceneIfReserved()},r.prototype.returnSubScene=function(t){this._reserved_next_scene=[t],this._is_reserved_next_scene_init=!1},r.prototype.changeNextSubSceneIfReserved=function(){if(this._reserved_next_scene){this.current_scene=this._reserved_next_scene.shift();var t=this.currentSubScene(),e=this._reserved_next_scene;this._reserved_next_scene=null,this._is_reserved_next_scene_init&&t.init.apply(t,e)}},r.prototype.setWaitToStartBGM=function(t,e){e||(e=0),this._wait_to_start_bgm_name=t,this._wait_to_start_bgm_duration=e,this._wait_to_start_bgm_start_frame_count=this.frame_count},r.prototype.x=function(t){return void 0!==t&&(this._x=t),this._x},r.prototype.y=function(t){return void 0!==t&&(this._y=t),this._y},r.prototype.root=function(){return this.parent?this.parent.root():this},r.prototype.setBackgroundColor=function(t){this._background_color=t},r.prototype.setFadeIn=function(t,e){return console.error("scene's setFadeIn method is deprecated."),this.core.scene_manager.setFadeIn.apply(this.core.scene_manager,arguments)},r.prototype.isInFadeIn=function(){return console.error("scene's isInFadeIn method is deprecated."),this.core.scene_manager.isInFadeIn.apply(this.core.scene_manager,arguments)},r.prototype.setFadeOut=function(t,e){return console.error("scene's setFadeOut method is deprecated."),this.core.scene_manager.setFadeOut.apply(this.core.scene_manager,arguments)},r.prototype.startFadeOut=function(){return console.error("scene's startFadeOut method is deprecated."),this.core.scene_manager.startFadeOut.apply(this.core.scene_manager,arguments)},r.prototype.isInFadeOut=function(){return console.error("scene's isInFadeOut method is deprecated."),this.core.scene_manager.isInFadeOut.apply(this.core.scene_manager,arguments)},r.prototype.isSetFadeOut=function(){return console.error("scene's isSetFadeOut method is deprecated."),this.core.scene_manager.isSetFadeOut.apply(this.core.scene_manager,arguments)};var s=function(t){o.apply(this,arguments)};n.inherit(s,o),t.exports=r},function(t,e,i){"use strict";var o=function(){this._name_to_class={}};o.prototype.addClass=function(t,e){if(void 0!==this[t])throw new Error(t+" is reserved word.");this._name_to_class[t]=e},o.prototype.initialLoad=function(){for(var t in this._name_to_class){var e=this._name_to_class[t];this[t]||(this[t]=e.load())}},o.prototype.load=function(){for(var t in this._name_to_class){var e=this._name_to_class[t];this[t]=e.load()}},o.prototype.save=function(){for(var t in this._name_to_class)this[t].save()},o.prototype.reload=function(){for(var t in this._name_to_class)this[t].reload()},o.prototype.del=function(){for(var t in this._name_to_class)this[t].del()},t.exports=o},function(t,e,i){"use strict";var o=i(23);t.exports=o.object_point},function(t,e,i){"use strict";var o=i(1),n=function(t){t||(t={}),this._data=t};n.KEY=function(){throw new Error("KEY method must be overridden.")},n.localFileDirectory=function(){return"save"},n.prototype.set=function(t,e){this._data[t]=e},n.prototype.get=function(t){return this._data[t]},n.prototype.exists=function(t){return t in this._data},n.prototype.remove=function(t){return delete this._data[t]},n.prototype.isEmpty=function(){return 0===Object.keys(this._data).length},n.prototype.toHash=function(){return o.shallowCopyHash(this._data)},n.isLocalMode=function(){return!!o.isElectron()},n.prototype.save=function(){this.constructor.isLocalMode()?this._saveToLocalFile():this._saveToWebStorage()},n.prototype._saveToLocalFile=function(){var t=this.constructor,e=window.require("fs"),i=window.require("path"),o=JSON.stringify(this._data),n=t._localFileDirectoryPath(),r=i.join(n,t._localFileName(t.KEY()));e.existsSync(n)||e.mkdirSync(n),e.writeFileSync(r,o)},n._localFileDirectoryPath=function(){var t=window.require("path"),e=window.require("electron").remote.app,i=e.getPath("appData"),o=e.getName();return t.join(i,o,this.localFileDirectory())},n._localFileName=function(t){return t+".json"},n._localFilePath=function(t){return window.require("path").join(this._localFileDirectoryPath(),this._localFileName(t))},n.prototype._saveToWebStorage=function(){var t=this.constructor.KEY(),e=JSON.stringify(this._data);try{window.localStorage.setItem(t,e)}catch(t){}},n.prototype.reload=function(){var t,e=this.constructor;t=e.isLocalMode()?e._loadFromLocalFile():e._loadFromWebStorage(),this._data=t||{}},n.load=function(){var t;return(t=this.isLocalMode()?this._loadFromLocalFile():this._loadFromWebStorage())?new this(t):new this},n._loadFromLocalFile=function(){var t=window.require("fs"),e=this._localFilePath(this.KEY());if(!t.existsSync(e))return null;var i=t.readFileSync(e,{encoding:"utf8"});return i?JSON.parse(i):null},n._loadFromWebStorage=function(){var t,e=this.KEY();try{t=window.localStorage.getItem(e)}catch(t){}return t?JSON.parse(t):null},n.prototype.del=function(){this.constructor.isLocalMode()?this._removeLocalFile():this._removeWebStorage(),this._data={}},n.prototype._removeLocalFile=function(){var t=this.constructor,e=window.require("fs"),i=t._localFilePath(t.KEY());e.existsSync(i)&&e.unlinkSync(i)},n.prototype._removeWebStorage=function(){var t=this.constructor.KEY();try{window.localStorage.removeItem(t)}catch(t){}},t.exports=n},function(t,e,i){"use strict";var o=i(8),n=function(t){o.apply(this,arguments)};i(0).Util.inherit(n,o),t.exports=n},function(t,e,i){"use strict";var o=i(9),n=function(t){o.apply(this,arguments),this.next_scene_name=null};i(1).inherit(n,o),n.prototype.init=function(t,e){o.prototype.init.apply(this,arguments);var i=t.images||[],n=t.sounds||[],r=t.bgms||[],s=t.fonts||[];this.next_scene_name=e,this._loadImages(i),this._loadSounds(n),this._loadBGMs(r),this._loadFonts(s)},n.prototype._loadImages=function(t){for(var e in t){var i=t[e];"string"==typeof i?this.core.image_loader.loadImage(e,i):this.core.image_loader.loadImage(e,i.path,i.scale_width,i.scale_height)}},n.prototype._loadSounds=function(t){for(var e in t){var i=t[e];this.core.audio_loader.loadSound(e,i.path,i.volume)}},n.prototype._loadBGMs=function(t){for(var e in t){var i=t[e],o="volume"in i?i.volume:1;this.core.audio_loader.loadBGM(e,i.path,o,i.loopStart,i.loopEnd)}},n.prototype._loadFonts=function(t){for(var e in t){var i=t[e];this.core.font_loader.loadFont(e,i.path,i.format)}},n.prototype.beforeDraw=function(){o.prototype.beforeDraw.apply(this,arguments),this.core.isAllLoaded()&&this.notifyAllLoaded()},n.prototype.progress=function(){return(this.core.audio_loader.progress()+this.core.image_loader.progress()+this.core.font_loader.progress())/3},n.prototype.draw=function(){o.prototype.draw.apply(this,arguments)},n.prototype.notifyAllLoaded=function(){this.next_scene_name&&this.core.scene_manager.changeScene(this.next_scene_name)},t.exports=n},function(t,e,i){"use strict";var o=function(){this.images={},this.loading_image_num=0,this.loaded_image_num=0};o.prototype.init=function(){for(var t in this.images)this.images[t].src="";this.images={},this.loading_image_num=0,this.loaded_image_num=0},o.prototype.loadImage=function(t,e,i,o){var n=this;n.loading_image_num++;var r=new Image;r.src=e,r.onload=function(){n.images[t]=n._generateImageCanvas(t,i,o),n.loaded_image_num++},this.images[t]=r},o.prototype._generateImageCanvas=function(t,e,i){e=void 0===e?1:e,i=void 0===i?1:i;var o=this.getImage(t),n=o.width*e,r=o.height*i,s=document.createElement("canvas");return s.width=n,s.height=r,s.getContext("2d").drawImage(o,0,0,n,r),s},o.prototype.isAllLoaded=function(){return this.loaded_image_num===this.loading_image_num},o.prototype.isLoaded=function(t){return t in this.images},o.prototype.getImage=function(t){if(!this.isLoaded(t))throw new Error("Can't find image '"+t+"'.");return this.images[t]},o.prototype.progress=function(){return 0===this.loading_image_num?1:this.loaded_image_num/this.loading_image_num},t.exports=o},function(t,e,i){"use strict";var o=function(){if(this.sounds={},this.bgms={},this.loading_audio_num=0,this.loaded_audio_num=0,this._reserved_play_sound_name_map={},this._audio_source_map={},this.audio_context=null,window){var t=window.AudioContext||window.webkitAudioContext;t&&(this.audio_context=new t,this.audio_context.createGain=this.audio_context.createGain||this.audio_context.createGainNode)}};o.prototype.init=function(){this.stopAllBGM(),this.sounds={},this.bgms={},this.loading_audio_num=0,this.loaded_audio_num=0,this._reserved_play_sound_name_map={},this._audio_source_map={}},o.prototype.loadSound=function(t,e,i){if(window&&window.Audio){var o=this;o.loading_audio_num++,void 0===i&&(i=1);var n=new window.Audio(e);n.volume=i,n.addEventListener("canplay",function(){o.loaded_audio_num++}),n.addEventListener("error",function(){throw new Error("Audio Element error. "+e+", code: "+n.error.code+", message: "+n.error.message)}),n.load(),o.sounds[t]={audio:n}}},o.prototype.setupEvents=function(){var t=this.sounds;window.document.addEventListener("touchend",function e(){for(var i in t)t[i].audio.load();window.document.removeEventListener("touchend",e)})},o.prototype.loadBGM=function(t,e,i,o,n){if(this.audio_context){var r=this;r.loading_audio_num++,void 0===i&&(i=1);var s=function(e){r.loaded_audio_num++,r.bgms[t]={audio:e,volume:i,loopStart:o,loopEnd:n}},a=function(t){throw t instanceof Error?new Error(t.message):t},u=new XMLHttpRequest;u.onload=function(){if(200===u.status){var t=u.response;r.audio_context.decodeAudioData(t,s,a)}},u.open("GET",e,!0),u.responseType="arraybuffer",u.send(null)}},o.prototype.isAllLoaded=function(){return this.loaded_audio_num===this.loading_audio_num},o.prototype.playSound=function(t){if(this.audio_context){if(!(t in this.sounds))throw new Error("Can't find sound '"+t+"'.");this._reserved_play_sound_name_map[t]=!0}},o.prototype.executePlaySound=function(){for(var t in this._reserved_play_sound_name_map)this.sounds[t].audio.pause(),this.sounds[t].audio.currentTime=0,this.sounds[t].audio.play(),delete this._reserved_play_sound_name_map[t]},o.prototype.playSoundByDataURL=function(t,e){if(window&&window.Audio){void 0===e&&(e=1);var i=new window.Audio;i.volume=e,i.src=t,i.addEventListener("canplay",function(){i.play()}),i.addEventListener("error",function(){throw new Error("Audio Element error. code: "+i.error.code+", message: "+i.error.message)}),i.load()}},o.prototype.playBGM=function(t){this.stopAllBGM(),this.addBGM(t)},o.prototype.addBGM=function(t){this.audio_context&&(this.isPlayingBGM(t)&&this.stopBGM(t),this._audio_source_map[t]=this._createSourceNodeAndGainNode(t),this._audio_source_map[t].source_node.start(0))},o.prototype.changeBGM=function(t){this.isPlayingBGM(t)||this.playBGM(t)},o.prototype.stopAllBGM=function(){for(var t in this._audio_source_map)this.stopBGM(t)},o.prototype.stopBGMWithout=function(t){for(var e in this._audio_source_map)e!==t&&this.stopBGM(e)},o.prototype.stopBGM=function(t){if(void 0===t)return this.stopAllBGM();this.fadeOutBGM(.1,t),t in this._audio_source_map&&delete this._audio_source_map[t]},o.prototype.isPlayingBGM=function(t){return void 0===t?!!Object.keys(this._audio_source_map).length:t in this._audio_source_map},o.prototype.fadeOutAllBGM=function(t){for(var e in this._audio_source_map)this.fadeOutBGM(t,e)},o.prototype.fadeOutBGM=function(t,e){if(this.audio_context){if(void 0===e)return this.fadeOutAllBGM(t);var i=this._audio_source_map[e];if(i){var o=i.gain_node.gain,n=this.audio_context.currentTime;o.cancelScheduledValues(n),o.setValueAtTime(o.value,n);var r=n+t;o.linearRampToValueAtTime(0,r)}}},o.prototype.muteAllBGM=function(){for(var t in this._audio_source_map)this.muteBGM(t)},o.prototype.muteBGM=function(t){if(this.audio_context){if(void 0===t)return this.muteAllBGM();var e=this._audio_source_map[t];if(e)e.gain_node.gain.setValueAtTime(0,this.audio_context.currentTime)}},o.prototype.unMuteAllBGM=function(){for(var t in this._audio_source_map)this.unMuteBGM(t)},o.prototype.unMuteBGM=function(t){if(this.audio_context){if(void 0===t)return this.unMuteAllBGM();var e=this._audio_source_map[t];if(e){var i=e.gain_node,o=this.bgms[t];i.gain.setValueAtTime(o.volume,this.audio_context.currentTime)}}},o.prototype.unMuteWithFadeInAllBGM=function(t){for(var e in this._audio_source_map)this.unMuteWithFadeInBGM(t,e)},o.prototype.unMuteWithFadeInBGM=function(t,e){if(this.audio_context){if(void 0===e)return this.unMuteWithFadeInAllBGM(t);var i=this._audio_source_map[e];if(i){var o=this.bgms[e],n=i.gain_node.gain,r=this.audio_context.currentTime;n.setValueAtTime(n.value,r);var s=r+t;n.linearRampToValueAtTime(o.volume,s)}}},o.prototype._createSourceNodeAndGainNode=function(t){if(this.audio_context){if(!(t in this.bgms))throw new Error("Can't find bgm name: "+t);var e=this.bgms[t],i=this.audio_context.createBufferSource();i.buffer=e.audio,("loopStart"in e||"loopEnd"in e)&&(i.loop=!0),e.loopStart&&(i.loopStart=e.loopStart),e.loopEnd&&(i.loopEnd=e.loopEnd);var o=this.audio_context.createGain();return o.gain.setValueAtTime(e.volume,this.audio_context.currentTime),i.connect(o),o.connect(this.audio_context.destination),i.start=i.start||i.noteOn,i.stop=i.stop||i.noteOff,{source_node:i,gain_node:o}}},o.prototype.progress=function(){return 0===this.loading_audio_num?1:this.loaded_audio_num/this.loading_audio_num},t.exports=o},function(t,e,i){"use strict";var o=function(){this._isLoadedDone=!1,this._loadedFonts=null,this._fontStatues={},this._hiddenCanvas=null};o.prototype.init=function(){this._isLoadedDone=!1,this._loadedFonts=null,this._fontStatues={}},o.prototype.isAllLoaded=function(){for(var t in this._fontStatues)if(!this.isLoaded(t))return!1;return!0},o.prototype.progress=function(){var t=0,e=0;for(var i in this._fontStatues)t++,this.isLoaded(i)&&e++;return 0===t?1:e/t},o.prototype.setupEvents=function(){var t=this;t.canUseCssFontLoading()?window.document.fonts.ready.then(function(e){t._isLoadedDone=!0,t._loadedFonts=e}).catch(function(t){throw new Error("Can't load font.")}):t.canUseCssFont()?window.document.fonts.addEventListener("loadingdone",function(){t._isLoadedDone=!0,t._loadedFonts=null}):(t._isLoadedDone=!0,t._loadedFonts=null)};var n=window.document&&window.document.fonts&&window.document.fonts.ready&&document.fonts.ready.then;o.prototype.canUseCssFontLoading=function(){return n},o.prototype.canUseCssFont=function(){return window.document&&window.document.fonts&&!this.isSafari10()},o.prototype.isSafari10=function(){return navigator.userAgent.toLowerCase().indexOf("safari")&&navigator.userAgent.toLowerCase().indexOf("version/10.0")},o.prototype.isLoaded=function(t){if(!(t in this._fontStatues))return!1;var e=this._fontStatues[t];if(e.is_loaded)return!0;var i=this.checkFontLoaded(t);return i&&(e.is_loaded=!0),i},o.prototype.checkFontLoaded=function(t){if(this.canUseCssFontLoading())return window.document.fonts.check('10px "'+t+'"');this._hiddenCanvas||(this._hiddenCanvas=window.document.createElement("canvas"));var e,i=this._hiddenCanvas.getContext("2d"),o="abcdefghijklmnopqrstuvwxyz";return i.font="40px "+t+", sans-serif",e=i.measureText(o).width,i.font="40px sans-serif",e!==i.measureText(o).width},o.prototype.loadFont=function(t,e,i){return!!window.document&&(this._fontStatues[t]={is_loaded:!1},this._createFontFaceStyle(t,e,i),this._createFontLoadingDOM(t),!0)},o.prototype._createFontFaceStyle=function(t,e,i){var o,n=window.document.getElementsByTagName("head");if(!n)throw new Error("Fontloader class needs head tag in html file.");o=void 0!==i?'@font-face { font-family: "'+t+'"; src: url("'+e+'") format("'+i+'"); }':'@font-face { font-family: "'+t+'"; src: url("'+e+'"); }';var r=window.document.createElement("style");r.type="text/css",n.item(0).appendChild(r),r.sheet.insertRule(o,0)},o.prototype._createFontLoadingDOM=function(t){var e=window.document.createElement("div"),i=window.document.createTextNode(".");e.style.fontFamily=t,e.style.fontSize="0px",e.style.color="transparent",e.style.position="absolute",e.style.margin="auto",e.style.top="0px",e.style.left="0px",e.style.width="1px",e.style.height="1px",e.appendChild(i),window.document.body.appendChild(e)},t.exports=o},function(t,e,i){"use strict";var o=function(t,e,i,o,n){if(!t)throw new Error("arguments 1 must be WebGLRenderingContext instance");this.gl=t;var r,s=this.createShader(t,t.VERTEX_SHADER,e),a=this.createShader(t,t.FRAGMENT_SHADER,i),u=this.createShaderProgram(t,s,a),h={};for(r=0;r<o.length;r++)h[o[r]]=t.getAttribLocation(u,o[r]);var c={};for(r=0;r<n.length;r++)c[n[r]]=t.getUniformLocation(u,n[r]);this.shader_program=u,this.attribute_locations=h,this.uniform_locations=c};o.prototype.createShader=function(t,e,i){if(e!==t.VERTEX_SHADER&&e!==t.FRAGMENT_SHADER)throw new Error("type must be vertex or fragment");var o=t.createShader(e);if(t.shaderSource(o,i),t.compileShader(o),!t.getShaderParameter(o,t.COMPILE_STATUS))throw(e===t.VERTEX_SHADER?"Vertex":"Fragment")+" failed to compile:\n\n"+t.getShaderInfoLog(o);return o},o.prototype.createShaderProgram=function(t,e,i){var o=t.createProgram();if(t.attachShader(o,e),t.attachShader(o,i),t.linkProgram(o),!t.getProgramParameter(o,t.LINK_STATUS))throw new Error("Could not initialize shaders:\n\n"+t.getProgramInfoLog(o));return o},t.exports=o},function(t,e,i){"use strict";var o=i(1),n=i(54),r=function(t,e){this.core=t,e=e||{},this._typography_speed="typography_speed"in e?e.typography_speed:10,this._criteria_function_map="criteria"in e?e.criteria:{},this._event_to_callback={printend:function(){}},this._timeoutID=null,this._script=null,this._progress=null,this._current_talking_pos=null,this._pos_to_chara_id_map={},this._pos_to_exp_id_map={},this._is_background_changed=!1,this._current_bg_image_name=null,this._current_junction_list=[],this._current_option={},this._current_message_letter_list=[],this._current_message_sentenses_num=null,this._current_message_max_length_letters=null,this._letter_idx=0,this._sentences_line_num=0,this._current_printed_sentences=[]};o.inherit(r,n),r.prototype.init=function(t){if(!t)throw new Error("set script arguments to use scenario_manager class");this._timeoutID&&this._stopPrintLetter(),this._script=t.slice(),this._progress=-1,this._current_talking_pos=null,this._pos_to_chara_id_map={},this._pos_to_exp_id_map={},this._is_background_changed=!1,this._current_bg_image_name=null,this._current_junction_list=[],this._current_option={},this._current_message_letter_list=[],this._current_message_sentenses_num=null,this._current_message_max_length_letters=null,this._letter_idx=0,this._sentences_line_num=0,this._current_printed_sentences=[]},r.prototype.on=function(t,e){return this._event_to_callback[t]=e,this},r.prototype.removeEvent=function(t){return this._event_to_callback[t]=function(){},this},r.prototype.start=function(t){if(!this._script)throw new Error("start method must be called after instance was initialized.");this.isEnd()||(this._progress=t||0,this._chooseNextSerifScript(),this._setupCurrentSerifScript())},r.prototype.next=function(t){return t=t||0,!this.isEnd()&&(this._progress++,this._chooseNextSerifScript(t),this._setupCurrentSerifScript(),!0)},r.prototype._chooseNextSerifScript=function(t){var e,i=this._script[this._progress],o=i.type||"serif";if("serif"===o);else if("junction_serif"===o){if(!(e=i.serifs[t]))throw new Error("chosen junction index '"+t+"' does not exists in next serifs array");Array.prototype.splice.apply(this._script,[this._progress,1].concat(e))}else{if("criteria_serif"!==o)throw new Error("Unknown serif script type: "+o);var n=i.criteria,r=i.arguments;if(t=this._execCriteriaFunction(n,r),!(e=i.serifs[t]))throw new Error("choisen criteria index '"+t+"' does not exists");Array.prototype.splice.apply(this._script,[this._progress,1].concat(e)),this._chooseNextSerifScript()}},r.prototype._execCriteriaFunction=function(t,e){var i=this._criteria_function_map[t];if(!i)throw new Error(t+" criteria does not exists");return i.apply({},[this.core].concat(e))},r.prototype.isStart=function(){return this._progress>-1},r.prototype.isEnd=function(){return this._progress===this._script.length-1},r.prototype.isPrintLetterEnd=function(){var t=this._current_message_letter_list.length;return this._letter_idx>=t},r.prototype._setupCurrentSerifScript=function(){var t=this._script[this._progress];this._setupChara(t),this._setupBackground(t),this._setupJunction(t),this._setupOption(t),this._saveSerifPlayed(t),"string"==typeof t.serif?this._setupSerif(t):this.isEnd()||this.next()},r.prototype._setupChara=function(t){var e=t.pos,i=t.chara,o=t.exp;e||(e=0),this._current_talking_pos=e,this._pos_to_chara_id_map[this._current_talking_pos]=i,this._pos_to_exp_id_map[this._current_talking_pos]=o},r.prototype._setupBackground=function(t){var e=t.background;this._is_background_changed=!1,e&&this._current_bg_image_name!==e&&(this._is_background_changed=!0,this._current_bg_image_name=e)},r.prototype._setupJunction=function(t){var e=t.junction;this._current_junction_list=e||[]},r.prototype._setupOption=function(t){this._current_option=t.option||{}},r.prototype._saveSerifPlayed=function(t){var e=t.id;if(t.save){if(void 0===e)throw new Error("script save property needs id property");this.core.save_manager.scenario.incrementPlayedCount(e)}},r.prototype._setupSerif=function(t){var e=t.serif;this._stopPrintLetter(),this._current_message_letter_list=e.split("");var i=e.split("\n");this._current_message_max_length_letters=0;for(var o=0,n=i.length;o<n;o++)this._current_message_max_length_letters<i[o].length&&(this._current_message_max_length_letters=i[o].length);this._current_message_sentenses_num=i.length,this._letter_idx=0,this._sentences_line_num=0,this._current_printed_sentences=[],this._startPrintLetter()},r.prototype._startPrintLetter=function(){this._printLetter(),this.isPrintLetterEnd()?this._timeoutID=null:this._timeoutID=setTimeout(o.bind(this._startPrintLetter,this),this._typography_speed)},r.prototype._stopPrintLetter=function(){null!==this._timeoutID&&(clearTimeout(this._timeoutID),this._timeoutID=null)},r.prototype._printLetter=function(){if(!this.isPrintLetterEnd()){var t=this._current_message_letter_list[this._letter_idx++];this._current_printed_sentences[this._sentences_line_num]||(this._current_printed_sentences[this._sentences_line_num]=""),"\n"===t?this._sentences_line_num++:this._current_printed_sentences[this._sentences_line_num]+=t,this.isPrintLetterEnd()&&this._event_to_callback.printend()}},r.prototype.resumePrintLetter=function(){this._startPrintLetter()},r.prototype.pausePrintLetter=function(){this._stopPrintLetter()},r.prototype.getCurrentPrintedSentences=function(){return this._current_printed_sentences},r.prototype.getCurrentSentenceNum=function(){return this._current_message_sentenses_num},r.prototype.getCurrentMaxLengthLetters=function(){return this._current_message_max_length_letters},r.prototype.isBackgroundChanged=function(){return this._is_background_changed},r.prototype.getCurrentBackgroundImageName=function(){return this._current_bg_image_name},r.prototype.getCurrentOption=function(){return this._current_option},r.prototype.getCurrentCharaNameByPosition=function(t){return t=t||0,this._pos_to_chara_id_map[t]},r.prototype.getCurrentCharaExpressionByPosition=function(t){return t=t||0,this._pos_to_exp_id_map[t]},r.prototype.isCurrentTalkingByPosition=function(t){return this._current_talking_pos===t},r.prototype.isCurrentSerifExistsJunction=function(){return this._current_junction_list.length>0},r.prototype.getCurrentJunctionList=function(){return this._current_junction_list},t.exports=r},function(t,e,i){"use strict";var o=i(33),n=function(t,e){o.apply(this,arguments),this.Class=e};i(1).inherit(n,o),n.prototype.init=function(){o.prototype.init.apply(this,arguments)},n.prototype.beforeDraw=function(){o.prototype.beforeDraw.apply(this,arguments)},n.prototype.draw=function(){o.prototype.draw.apply(this,arguments)},n.prototype.afterDraw=function(){o.prototype.afterDraw.apply(this,arguments)},n.prototype.create=function(t){var e=new this.Class(this.scene);return e.init.apply(e,arguments),this.addObject(e),e},t.exports=n},function(t,e,i){"use strict";var o=i(0).Object.Base,n=i(0).Util,r=i(2),s=function(t){o.apply(this,arguments),this._text="",this._color=null,this._transparent=0,this._is_start_extinguish=!1,this._is_start_show=!1};n.inherit(s,o),s.prototype.init=function(){o.prototype.init.apply(this,arguments),this._text="",this._color=r.COLOR_WHITE,this._transparent=0,this._is_start_extinguish=!1,this._is_start_show=!1},s.prototype.beforeDraw=function(){o.prototype.beforeDraw.apply(this,arguments),this._is_start_extinguish&&0!==this._transparent?(this._transparent-=.1,this._transparent<=0&&(this._is_start_extinguish=!1,this._transparent=0)):this._is_start_show&&1!==this._transparent&&(this._transparent+=.1,this._transparent>=1&&(this._is_start_show=!1,this._transparent=1))},s.prototype.draw=function(){if(o.prototype.draw.apply(this,arguments),0!==this._transparent){var t=this.core.ctx;t.save(),t.globalAlpha=this._transparent,t.fillStyle=this._color,t.font="64px 'MyFont'",t.textAlign="left",t.fillText(this._text,170,500),t.restore()}},s.prototype.show=function(t,e){this._transparent=0,this._is_start_show=!0,this._is_start_extinguish=!1,this._text=t,this._color=e},s.prototype.extinguish=function(){this._is_start_show=!1,this._is_start_extinguish=!0},t.exports=s},function(t,e,i){"use strict";var o=i(42),n=i(1),r=i(44),s=i(45),a=i(24),u=i(10),h=i(46),c=i(15),l=i(16),_=i(17),p=i(51),d=i(18),f=i(52),m=i(53),g=function(t,e){e||(e={}),this.canvas_dom=t,this.ctx=null,this.gl=null,e.webgl?(this.gl=this.createWebGLContext(this.canvas_dom),this.sprite_3d_shader=new d(this.gl,f,m,["aTextureCoordinates","aVertexPosition","aColor"],["uMVMatrix","uPMatrix","uSampler"])):this.ctx=this.canvas_dom.getContext("2d"),this.debug_manager=new r(this),this.scene_manager=new s(this),this.time_manager=new a,this.save_manager=new u,this.input_manager=new h,this.width=Number(t.getAttribute("width")),this.height=Number(t.getAttribute("height")),this._cursor_image_name=null,this._default_cursor_image_name=null,this._is_resize_fired=!1,this.frame_count=0,this.request_id=null,this.image_loader=new c,this.audio_loader=new l,this.font_loader=new _,this.save_manager.addClass("scenario",p)};g.prototype.init=function(){this._is_resize_fired=!1,this.frame_count=0,this.request_id=null,this.debug_manager.init(),this.scene_manager.init(),this.time_manager.init(),this.input_manager.init(),this.image_loader.init(),this.audio_loader.init(),this.font_loader.init(),this.save_manager.initialLoad()},g.prototype.reload=function(){this.init()},g.prototype.isRunning=function(){return!!this.request_id},g.prototype.startRun=function(){this.isRunning()||this.run()},g.prototype.stopRun=function(){this.isRunning()&&(cancelAnimationFrame(this.request_id),this.request_id=null)},g.prototype.run=function(){this.debug_manager.beforeRun(),this.scene_manager.beforeRun(),this.input_manager.beforeRun(),this.time_manager.executeEvents(),this.audio_loader.executePlaySound(),this.changeDefaultCursorImage();var t=this.scene_manager.currentScene();t&&(t.beforeDraw(),this.clearCanvas(),t.draw(),t.afterDraw(),this.scene_manager.drawTransition(),this._renderCursorImage()),this.frame_count++,this.debug_manager.afterRun(),this.input_manager.afterRun(),this._is_resize_fired&&this._fullsize(),this.request_id=requestAnimationFrame(n.bind(this.run,this))},g.prototype.clearCanvas=function(){this.is2D()?this.canvas_dom.width=this.canvas_dom.width:this.is3D()&&(this.gl.clearColor(0,0,0,0),this.gl.clearDepth(1),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT))},g.prototype.is2D=function(){return!!this.ctx},g.prototype.is3D=function(){return!!this.gl},g.prototype.isKeyDown=function(t){return this.input_manager.isKeyDown(t)},g.prototype.isKeyPush=function(t){return this.input_manager.isKeyPush(t)},g.prototype.getKeyDownTime=function(t){return this.input_manager.getKeyDownTime(t)},g.prototype.isLeftClickDown=function(){return this.input_manager.isLeftClickDown()},g.prototype.isLeftClickPush=function(){return this.input_manager.isLeftClickPush()},g.prototype.isRightClickDown=function(){return this.input_manager.isRightClickDown()},g.prototype.isRightClickPush=function(){return this.input_manager.isRightClickPush()},g.prototype.mousePositionX=function(){return this.input_manager.mousePositionX()},g.prototype.mousePositionY=function(){return this.input_manager.mousePositionX()},g.prototype.mouseMoveX=function(){return this.input_manager.mouseMoveX()},g.prototype.mouseMoveY=function(){return this.input_manager.mouseMoveY()},g.prototype.mouseScroll=function(){return this.input_manager.mouseScroll()},g.prototype.fullscreen=function(){var t=this.canvas_dom;t.requestFullscreen?t.requestFullscreen():t.msRequestuestFullscreen?t.msRequestuestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen()},g.prototype.isAllLoaded=function(){return!!(this.image_loader.isAllLoaded()&&this.audio_loader.isAllLoaded()&&this.font_loader.isAllLoaded())},g.prototype.setupEvents=function(){window&&(window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)},this._setupError(),this.audio_loader.setupEvents(),this.font_loader.setupEvents(),this.input_manager.setupEvents(this.canvas_dom))},g.prototype._setupError=function(){var t=this;window.onerror=function(e,i,o,n,r){t.showError(e,i,o,n,r)}},g.prototype.fullsize=function(){var t=this;window.onresize=function(e){t._is_resize_fired=!0},this._fullsize()},g.prototype._fullsize=function(){var t,e,i,o,n=window.innerWidth/window.innerHeight,r=this.width/this.height;r>=n?(i=window.innerWidth,o=window.innerWidth/r,e=(window.innerHeight-o)/2,t=0):(o=window.innerHeight,i=window.innerHeight*r,e=0,t=(window.innerWidth-i)/2);var s=this.width/i,a=this.height/o,u=this.canvas_dom;u.style.left=t+"px",u.style.top=e+"px",u.style.width=i+"px",u.style.height=o+"px",this.input_manager.scaleClickPosition(s,a)},g.prototype.showError=function(t,e,i,o,n){if(this.clearCanvas(),this.is2D()){var r=this.ctx,s=24,a=80;r.save(),r.fillStyle="black",r.fillRect(0,0,this.width,this.height),r.restore(),r.save(),r.fillStyle="red",r.font="48px 'sans-serif'",r.fillText("Error",s,a),a+=48,r.fillStyle="white",r.font="24px 'sans-serif'",r.fillText(t,s,a),a+=29,r.fillText("Time: "+(new Date).toString(),s,a),a+=29,r.fillText("File: "+e,s,a),a+=29,r.fillText("Line: "+i+", Column:"+o,s,a),a+=29,r.fillText("Stack Trace: ",s,a),a+=29,s+=29;for(var u=n.stack.split("\n"),h=0,c=u.length;h<c;h++){var l=u[h];r.fillText(l,s,a),a+=29}r.restore()}else this.is3D()&&window.alert(t+"\n"+i+":"+o)},g.prototype.createWebGLContext=function(t){var e;try{e=t.getContext("webgl")||t.getContext("experimental-webgl"),e=o.makeDebugContext(e)}catch(t){throw t}if(!e)throw new Error("Could not initialize WebGL");return e},g.prototype.enableCursorImage=function(t){this.canvas_dom.style.cursor="none",this._default_cursor_image_name=t},g.prototype.isUsingCursorImage=function(){return!!this._default_cursor_image_name},g.prototype.changeCursorImage=function(t){this._cursor_image_name=t},g.prototype.disableCursorImage=function(t){this.isUsingCursorImage()&&(this.canvas_dom.style.cursor="auto",this._cursor_image_name=null,this._default_cursor_image_name=null)},g.prototype.changeDefaultCursorImage=function(){this.isUsingCursorImage()&&(this._cursor_image_name=this._default_cursor_image_name)},g.prototype._renderCursorImage=function(){if(this.isUsingCursorImage()&&this.image_loader.isLoaded(this._cursor_image_name)){var t=this.ctx;if(t){t.save();var e=this.image_loader.getImage(this._cursor_image_name),i=this.input_manager.mousePositionX(),o=this.input_manager.mousePositionY(),n=this.image_loader.getScaleWidth(this._cursor_image_name),r=this.image_loader.getScaleHeight(this._cursor_image_name);t.translate(i,o),t.drawImage(e,0,0,e.width*n,e.height*r),t.restore()}}},g.prototype.setTimeout=function(t,e){console.error("core's setTimeout method is deprecated."),this.time_manager.setTimeout(t,e)},g.prototype.currentScene=function(){return console.error("core's currentScene method is deprecated."),this.scene_manager.currentScene.apply(this.scene_manager,arguments)},g.prototype.addScene=function(t,e){return console.error("core's addScene method is deprecated."),this.scene_manager.addScene.apply(this.scene_manager,arguments)},g.prototype.changeScene=function(t,e){return console.error("core's changeScene method is deprecated."),this.scene_manager.changeScene.apply(this.scene_manager,arguments)},g.prototype.changeNextSceneIfReserved=function(){return console.error("core's changeNextSceneIfReserved method is deprecated."),this.scene_manager.changeNextSceneIfReserved.apply(this.scene_manager,arguments)},g.prototype.changeSceneWithLoading=function(t,e){return console.error("core's changeSceneWithLoading method is deprecated."),this.scene_manager.changeSceneWithLoading.apply(this.scene_manager,arguments)},t.exports=g},function(t,e,i){"use strict";var o=i(1),n=0,r=function(t){this.scene=t,this.core=t.core,this.parent=null,this.id=++n,this.frame_count=0,this._x=0,this._y=0,this._auto_disable_times_map={},this._velocity=null,this.resetVelocity(),this._previous_x=null,this._previous_y=null,this.objects=[]};o.defineProperty(r,"x"),o.defineProperty(r,"y"),r.prototype.init=function(){this.frame_count=0,this._auto_disable_times_map={},this.resetVelocity(),this._previous_x=null,this._previous_y=null;for(var t=0,e=this.objects.length;t<e;t++)this.objects[t].init()},r.prototype.beforeDraw=function(){this.frame_count++,this._checkAutoDisableFlags();for(var t=0,e=this.objects.length;t<e;t++)this.objects[t].beforeDraw();this.moveByVelocity(this._velocity)},r.prototype.draw=function(){this.core.debug_manager.isShowingCollisionArea()&&this._drawCollisionArea(this.core.debug_manager.collisionAreaColor());for(var t=0,e=this.objects.length;t<e;t++)this.objects[t].draw()},r.prototype.afterDraw=function(){for(var t=0,e=this.objects.length;t<e;t++)this.objects[t].afterDraw()},r.prototype.width=function(){return 0},r.prototype.height=function(){return 0},r.prototype.setPosition=function(t,e){this._x=t,this._y=e},r.prototype.root=function(){return this.parent?this.parent.root():this},r.prototype.globalCenterX=function(){return this.scene.x()+this.x()},r.prototype.globalCenterY=function(){return this.scene.y()+this.y()},r.prototype.globalLeftX=function(){return this.scene.x()+this.x()-this.width()/2},r.prototype.globalRightX=function(){return this.scene.x()+this.x()+this.width()/2},r.prototype.globalUpY=function(){return this.scene.y()+this.y()-this.height()/2},r.prototype.globalDownY=function(){return this.scene.y()+this.y()+this.height()/2},r.prototype.addSubObject=function(t){t.setParent(this),this.objects.push(t)},r.prototype.addSubObjects=function(t){for(var e=0,i=t.length;e<i;e++){t[e].setParent(this)}this.objects=this.objects.concat(t)},r.prototype.removeSubObject=function(t){for(var e=0,i=this.objects.length;e<i;e++)if(this.objects[e].id===t.id){this.objects[e].resetParent(),this.objects.splice(e,1);break}},r.prototype.removeAllSubObject=function(){for(var t=0,e=this.objects.length;t<e;t++)this.objects[t].resetParent();this.objects=[]},r.prototype.setParent=function(t){if(this.parent)throw new Error("already set parent");this.parent=t},r.prototype.resetParent=function(){this.parent=null},r.prototype.collisionWidth=function(t){return 0},r.prototype.collisionHeight=function(t){return 0},r.prototype.onCollision=function(t){},r.prototype.isCollision=function(t){return!0},r.prototype.checkCollisionWithObject=function(t){var e=t.intersect(this);return e&&(t.onCollision(this),this.onCollision(t)),e},r.prototype.checkCollisionWithObjects=function(t){for(var e=!1,i=0;i<t.length;i++){var o=t[i];this.checkCollisionByObject(o)&&(this.onCollision(o),o.onCollision(this),e=!0)}return e},r.prototype.checkCollisionWithPosition=function(t,e){var i=new s(this.scene);return i.init(),i.setPosition(t,e),this.checkCollisionWithObject(i)},r.prototype.intersect=function(t){return!(!this.isCollision(t)||!t.isCollision(this))&&(Math.abs(this.collisionX()-t.collisionX())<this.collisionWidth(t)/2+t.collisionWidth(this)/2&&Math.abs(this.collisionY()-t.collisionY())<this.collisionHeight(t)/2+t.collisionHeight(this)/2)},r.prototype.collisionX=function(){return this.x()},r.prototype.collisionY=function(){return this.y()},r.prototype.getCollisionLeftX=function(t){return this.collisionX()-this.collisionWidth(t)/2},r.prototype.getCollisionRightX=function(t){return this.collisionX()+this.collisionWidth(t)/2},r.prototype.getCollisionUpY=function(t){return this.collisionY()-this.collisionHeight(t)/2},r.prototype.getCollisionDownY=function(t){return this.collisionY()+this.collisionHeight(t)/2},r.prototype._drawCollisionArea=function(t){var e=new r(this.scene);if(this.isCollision(e)){t=t||"rgb( 255, 255, 255 )";var i=this.core.ctx;i.save(),i.fillStyle=t,i.globalAlpha=.4,i.translate(this.globalCenterX(),this.globalCenterY()),i.fillRect(-this.collisionWidth(e)/2,-this.collisionHeight(e)/2,this.collisionWidth(e),this.collisionHeight(e)),i.restore()}},r.prototype.checkCollision=function(t){return this.checkCollisionByObject(t)},r.prototype.checkCollisionByObject=function(t){return this.intersect(t)},r.prototype.setAutoDisableFlag=function(t,e){this[t]=!0,this._auto_disable_times_map[t]=this.frame_count+e},r.prototype._checkAutoDisableFlags=function(){for(var t in this._auto_disable_times_map)this._auto_disable_times_map[t]<this.frame_count&&(this[t]=!1,delete this._auto_disable_times_map[t])},r.prototype.moveByVelocity=function(t){if(0!==this._velocity.magnitude){var e=o.calcMoveXByVelocity(t),i=o.calcMoveYByVelocity(t);this._previous_x=this._x,this._previous_y=this._y,this._x+=e,this._y+=i}},r.prototype.setVelocity=function(t){this._velocity=t},r.prototype.resetVelocity=function(){this._velocity={magnitude:0,theta:0}},r.prototype.setVelocityMagnitude=function(t){this._velocity.magnitude=t},r.prototype.setVelocityTheta=function(t){this._velocity.theta=t},r.prototype.moveBack=function(){if(null!==this._previous_x||!this._previous_y){var t=this._x,e=this._y;this._x=this._previous_x,this._y=this._previous_y,this._previous_x=t,this._previous_y=e}},r.prototype.isOutOfStage=function(){return this.x()+100<0||this.y()+100<0||this.x()>this.scene.width+100||this.y()>this.scene.height+100};var s=function(t){r.apply(this,arguments)};o.inherit(s,r),s.prototype.collisionWidth=function(){return 1},s.prototype.collisionHeight=function(){return 1},s.prototype.width=function(){return 1},s.prototype.height=function(){return 1},t.exports={object_base:r,object_point:s}},function(t,e,i){"use strict";var o=0,n=function(){this.events={},this.frame_count=0};n.prototype.init=function(){this.events={},this.frame_count=0},n.prototype.setTimeout=function(t,e){var i=this.frame_count+e,n=++o;return this.events[i]||(this.events[i]={}),this.events[i][n]={callback:t},n},n.prototype.clearTimeout=function(t){for(var e in this.events){var i=this.events[e];if(t in i)return delete i[t],!0}return!1},n.prototype.executeEvents=function(){var t=this.frame_count,e=this.events[t];if(e){for(var i in e){e[i].callback()}delete this.events[t]}this.frame_count++},t.exports=n},function(t,e,i){"use strict";var o=i(9),n=function(t){o.apply(this,arguments),this.video=null,this.next_scene_name_and_args=null,this.is_playing=!1,this._height=null,this._width=null,this._top=null,this._left=null,this.is_mute=!1};i(1).inherit(n,o),n.prototype.init=function(t,e){o.prototype.init.apply(this,arguments);var i=this;i.is_playing=!1,i._height=null,i._width=null,i._top=null,i._left=null,i._callback=function(){},e&&(i._callback=e),this.isStopBGM()&&this.core.audio_loader.stopBGM();var n=document.createElement("video");n.src=t,n.controls=!1,n.preload="auto",n.oncanplaythrough=function(){i._calcDrawSizeAndPosition(),n.play(),i.is_playing=!0},this.is_mute&&(n.muted=!0),n.load(),i.video=n},n.prototype.beforeDraw=function(){o.prototype.beforeDraw.apply(this,arguments),this.is_playing&&this.video.ended&&this.notifyEnd()},n.prototype.draw=function(){o.prototype.draw.apply(this,arguments);var t=this.core.ctx;t&&(t.save(),t.fillStyle="black",t.fillRect(0,0,this.core.width,this.core.height),this.is_playing&&t.drawImage(this.video,0,0,this.video.videoWidth,this.video.videoHeight,this._left,this._top,this._width,this._height),t.restore())},n.prototype._calcDrawSizeAndPosition=function(){var t,e,i,o,n=this.width/this.height,r=this.video.videoWidth/this.video.videoHeight;r>=n?(i=this.width,o=this.width/r,e=(this.height-o)/2,t=0):(o=this.height,i=this.height*r,e=0,t=(this.width-i)/2),this._height=o,this._width=i,this._top=e,this._left=t},n.prototype.notifyEnd=function(){this.video=null,this.is_playing=!1,this._callback()},n.prototype.isStopBGM=function(){return!0},t.exports=n},function(t,e,i){"use strict";var o=i(3),n=i(1),r=function(t){o.apply(this,arguments),this.current_sprite_index=0};n.inherit(r,o),r.prototype.init=function(){o.prototype.init.apply(this,arguments),this.current_sprite_index=0},r.prototype.beforeDraw=function(){o.prototype.beforeDraw.apply(this,arguments),this.frame_count%this.spriteAnimationSpan()==0&&(this.current_sprite_index++,this.current_sprite_index>=this.spriteIndices().length&&(this.current_sprite_index=0))},r.prototype.draw=function(){if(this.isShow()){var t=this.core.image_loader.getImage(this.spriteName());this.scale()&&console.error("scale method is deprecated. you should use scaleWidth and scaleHeight.");var e=this.core.ctx;e.save(),e.translate(this.globalCenterX(),this.globalCenterY());var i=n.thetaToRadian(this._velocity.theta+this.rotateAdjust());e.rotate(i);var r=this.spriteWidth(),s=this.spriteHeight();r||(r=t.width),s||(s=t.height);var a=this.width(),u=this.height();this.isReflect()&&e.transform(-1,0,0,1,0,0),e.globalAlpha=this.alpha(),e.drawImage(t,r*this.spriteIndexX(),s*this.spriteIndexY(),r,s,-a/2,-u/2,a,u),e.restore()}o.prototype.draw.apply(this,arguments)},r.prototype.spriteName=function(){throw new Error("spriteName method must be overridden.")},r.prototype.spriteIndexX=function(){return this.spriteIndices()[this.current_sprite_index].x},r.prototype.spriteIndexY=function(){return this.spriteIndices()[this.current_sprite_index].y},r.prototype.width=function(){return this.spriteWidth()*this.scaleWidth()},r.prototype.height=function(){return this.spriteHeight()*this.scaleHeight()},r.prototype.isShow=function(){return!0},r.prototype.spriteAnimationSpan=function(){return 0},r.prototype.spriteIndices=function(){return[{x:0,y:0}]},r.prototype.spriteWidth=function(){return 0},r.prototype.spriteHeight=function(){return 0},r.prototype.rotateAdjust=function(){return 0},r.prototype.scale=function(){return 0},r.prototype.scaleWidth=function(){return 1},r.prototype.scaleHeight=function(){return 1},r.prototype.isReflect=function(){return!1},r.prototype.alpha=function(){return 1},t.exports=r},function(t,e,i){"use strict";var o=i(3),n=i(1),r=i(28).SPRITE3D,s=i(29),a=function(t){o.apply(this,arguments),this.current_sprite_index=0,this._z=0,this.vertices=[],this.coordinates=[],this.indices=[],this.colors=[],this.vertices.length=r.V_SIZE,this.coordinates.length=r.C_SIZE,this.indices.length=r.I_SIZE,this.colors.length=r.A_SIZE;var e=this.core.gl;this.vBuffer=e.createBuffer(),this.cBuffer=e.createBuffer(),this.iBuffer=e.createBuffer(),this.aBuffer=e.createBuffer(),this.texture=null,this.mvMatrix=s.mat4.create(),this.pMatrix=s.mat4.create()};n.inherit(a,o),a.prototype.init=function(){o.prototype.init.apply(this,arguments),this.current_sprite_index=0,this._initmvpMatrix(),this._initVertices(),this._initCoordinates(),this._initIndices(),this._initColors(),this._initTexture()},a.prototype._initmvpMatrix=function(){s.mat4.identity(this.mvMatrix),s.mat4.translate(this.mvMatrix,this.mvMatrix,[-this.core.width/2,this.core.height/2,0]),this._setOrthographicProjection()},a.prototype._initVertices=function(){var t=this.spriteWidth()/2,e=this.spriteHeight()/2;this.vertices[0]=-t,this.vertices[1]=-e,this.vertices[2]=-1,this.vertices[3]=t,this.vertices[4]=-e,this.vertices[5]=-1,this.vertices[6]=t,this.vertices[7]=e,this.vertices[8]=-1,this.vertices[9]=-t,this.vertices[10]=e,this.vertices[11]=-1},a.prototype._initCoordinates=function(){var t=this.core.image_loader.getImage(this.spriteName()),e=this.spriteWidth()/t.width,i=this.spriteHeight()/t.height,o=e*this.spriteIndexX(),n=i*this.spriteIndexY(),r=o+e,s=n+i;this.coordinates[0]=o,this.coordinates[1]=s,this.coordinates[2]=r,this.coordinates[3]=s,this.coordinates[4]=r,this.coordinates[5]=n,this.coordinates[6]=o,this.coordinates[7]=n},a.prototype._initIndices=function(){this.indices[0]=0,this.indices[1]=1,this.indices[2]=2,this.indices[3]=0,this.indices[4]=2,this.indices[5]=3},a.prototype._initColors=function(){this.colors[0]=1,this.colors[1]=1,this.colors[2]=1,this.colors[3]=1,this.colors[4]=1,this.colors[5]=1,this.colors[6]=1,this.colors[7]=1,this.colors[8]=1,this.colors[9]=1,this.colors[10]=1,this.colors[11]=1,this.colors[12]=1,this.colors[13]=1,this.colors[14]=1,this.colors[15]=1},a.prototype._initTexture=function(){var t=this.core.gl,e=this.core.image_loader.getImage(this.spriteName()),i=t.createTexture();t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.bindTexture(t.TEXTURE_2D,null),this.texture=i},a.prototype._setOrthographicProjection=function(){s.mat4.identity(this.pMatrix);s.mat4.ortho(this.pMatrix,-this.core.width/2,this.core.width/2,-this.core.height/2,this.core.height/2,.1,10)},a.prototype.beforeDraw=function(){o.prototype.beforeDraw.apply(this,arguments),this.frame_count%this.spriteAnimationSpan()==0&&(this.current_sprite_index++,this.current_sprite_index>=this.spriteIndices().length&&(this.current_sprite_index=0)),this._initVertices(),this._initCoordinates(),this._translate()},a.prototype._translate=function(){for(var t=0;t<r.V_ITEM_NUM;t++)this.vertices[t*r.V_ITEM_SIZE+0]+=this.x(),this.vertices[t*r.V_ITEM_SIZE+1]-=this.y(),this.vertices[t*r.V_ITEM_SIZE+2]+=this.z()},a.prototype._rotate=function(){for(var t=this._getRadian(),e=0;e<r.V_ITEM_NUM;e++){var i=this.vertices[e*r.V_ITEM_SIZE+0],o=this.vertices[e*r.V_ITEM_SIZE+1];this.vertices[e*r.V_ITEM_SIZE+0]=i*Math.cos(t)-o*Math.sin(t),this.vertices[e*r.V_ITEM_SIZE+1]=i*Math.sin(t)+o*Math.cos(t)}},a.prototype._getRadian=function(){var t=this.velocity.theta;return n.thetaToRadian(t)},a.prototype.draw=function(){if(this.isShow()){var t=this.core.gl,e=this.shader();t.useProgram(e.shader_program),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.enable(t.BLEND),t.disable(t.DEPTH_TEST),this._setupAttribute("aVertexPosition",this.vBuffer,new Float32Array(this.vertices),r.V_ITEM_SIZE),this._setupAttribute("aTextureCoordinates",this.cBuffer,new Float32Array(this.coordinates),r.C_ITEM_SIZE),this._setupAttribute("aColor",this.aBuffer,new Float32Array(this.colors),r.A_ITEM_SIZE),this._setupTexture("uSampler",0,this.texture),t.uniformMatrix4fv(e.uniform_locations.uPMatrix,!1,this.pMatrix),t.uniformMatrix4fv(e.uniform_locations.uMVMatrix,!1,this.mvMatrix),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.iBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.indices),t.STATIC_DRAW),this.setupAdditionalVariables(),t.drawElements(t.TRIANGLES,this.indices.length,t.UNSIGNED_SHORT,0)}o.prototype.draw.apply(this,arguments)},a.prototype._setupAttribute=function(t,e,i,o){var n=this.core.gl,r=this.shader();n.bindBuffer(n.ARRAY_BUFFER,e),n.bufferData(n.ARRAY_BUFFER,i,n.STATIC_DRAW),n.enableVertexAttribArray(r.attribute_locations[t]),n.vertexAttribPointer(r.attribute_locations[t],o,n.FLOAT,!1,0,0)},a.prototype._setupTexture=function(t,e,i){var o=this.core.gl,n=this.shader();o.activeTexture(o["TEXTURE"+e]),o.bindTexture(o.TEXTURE_2D,i),o.uniform1i(n.uniform_locations[t],e)},a.prototype.z=function(t){return void 0!==t&&(this._z=t),this._z},a.prototype.shader=function(){return this.core.sprite_3d_shader},a.prototype.setupAdditionalVariables=function(){},a.prototype.spriteName=function(){throw new Error("spriteName method must be overridden.")},a.prototype.spriteIndexX=function(){return this.spriteIndices()[this.current_sprite_index].x},a.prototype.spriteIndexY=function(){return this.spriteIndices()[this.current_sprite_index].y},a.prototype.width=function(){return this.spriteWidth()*this.scaleWidth()},a.prototype.height=function(){return this.spriteHeight()*this.scaleHeight()},a.prototype.isShow=function(){return!0},a.prototype.spriteAnimationSpan=function(){return 0},a.prototype.spriteIndices=function(){return[{x:0,y:0}]},a.prototype.spriteWidth=function(){return 0},a.prototype.spriteHeight=function(){return 0},a.prototype.rotateAdjust=function(){return 0},a.prototype.scaleWidth=function(){return 1},a.prototype.scaleHeight=function(){return 1},a.prototype.isReflect=function(){return!1},t.exports=a},function(t,e,i){"use strict";var o={SPRITE3D:{}};o.SPRITE3D.V_ITEM_SIZE=3,o.SPRITE3D.V_ITEM_NUM=4,o.SPRITE3D.V_SIZE=o.SPRITE3D.V_ITEM_SIZE*o.SPRITE3D.V_ITEM_NUM,o.SPRITE3D.C_ITEM_SIZE=2,o.SPRITE3D.C_ITEM_NUM=4,o.SPRITE3D.C_SIZE=o.SPRITE3D.C_ITEM_SIZE*o.SPRITE3D.C_ITEM_NUM,o.SPRITE3D.I_ITEM_SIZE=1,o.SPRITE3D.I_ITEM_NUM=6,o.SPRITE3D.I_SIZE=o.SPRITE3D.I_ITEM_SIZE*o.SPRITE3D.I_ITEM_NUM,o.SPRITE3D.A_ITEM_SIZE=4,o.SPRITE3D.A_ITEM_NUM=4,o.SPRITE3D.A_SIZE=o.SPRITE3D.A_ITEM_SIZE*o.SPRITE3D.A_ITEM_NUM,t.exports=o},function(t,e,i){e.glMatrix=i(4),e.mat2=i(55),e.mat2d=i(56),e.mat3=i(30),e.mat4=i(57),e.quat=i(58),e.vec2=i(59),e.vec3=i(31),e.vec4=i(32)},function(t,e,i){var o=i(4),n={create:function(){var t=new o.ARRAY_TYPE(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},fromMat4:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},clone:function(t){var e=new o.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},fromValues:function(t,e,i,n,r,s,a,u,h){var c=new o.ARRAY_TYPE(9);return c[0]=t,c[1]=e,c[2]=i,c[3]=n,c[4]=r,c[5]=s,c[6]=a,c[7]=u,c[8]=h,c},set:function(t,e,i,o,n,r,s,a,u,h){return t[0]=e,t[1]=i,t[2]=o,t[3]=n,t[4]=r,t[5]=s,t[6]=a,t[7]=u,t[8]=h,t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},transpose:function(t,e){if(t===e){var i=e[1],o=e[2],n=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=o,t[7]=n}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},invert:function(t,e){var i=e[0],o=e[1],n=e[2],r=e[3],s=e[4],a=e[5],u=e[6],h=e[7],c=e[8],l=c*s-a*h,_=-c*r+a*u,p=h*r-s*u,d=i*l+o*_+n*p;return d?(d=1/d,t[0]=l*d,t[1]=(-c*o+n*h)*d,t[2]=(a*o-n*s)*d,t[3]=_*d,t[4]=(c*i-n*u)*d,t[5]=(-a*i+n*r)*d,t[6]=p*d,t[7]=(-h*i+o*u)*d,t[8]=(s*i-o*r)*d,t):null},adjoint:function(t,e){var i=e[0],o=e[1],n=e[2],r=e[3],s=e[4],a=e[5],u=e[6],h=e[7],c=e[8];return t[0]=s*c-a*h,t[1]=n*h-o*c,t[2]=o*a-n*s,t[3]=a*u-r*c,t[4]=i*c-n*u,t[5]=n*r-i*a,t[6]=r*h-s*u,t[7]=o*u-i*h,t[8]=i*s-o*r,t},determinant:function(t){var e=t[0],i=t[1],o=t[2],n=t[3],r=t[4],s=t[5],a=t[6],u=t[7],h=t[8];return e*(h*r-s*u)+i*(-h*n+s*a)+o*(u*n-r*a)},multiply:function(t,e,i){var o=e[0],n=e[1],r=e[2],s=e[3],a=e[4],u=e[5],h=e[6],c=e[7],l=e[8],_=i[0],p=i[1],d=i[2],f=i[3],m=i[4],g=i[5],y=i[6],v=i[7],b=i[8];return t[0]=_*o+p*s+d*h,t[1]=_*n+p*a+d*c,t[2]=_*r+p*u+d*l,t[3]=f*o+m*s+g*h,t[4]=f*n+m*a+g*c,t[5]=f*r+m*u+g*l,t[6]=y*o+v*s+b*h,t[7]=y*n+v*a+b*c,t[8]=y*r+v*u+b*l,t}};n.mul=n.multiply,n.translate=function(t,e,i){var o=e[0],n=e[1],r=e[2],s=e[3],a=e[4],u=e[5],h=e[6],c=e[7],l=e[8],_=i[0],p=i[1];return t[0]=o,t[1]=n,t[2]=r,t[3]=s,t[4]=a,t[5]=u,t[6]=_*o+p*s+h,t[7]=_*n+p*a+c,t[8]=_*r+p*u+l,t},n.rotate=function(t,e,i){var o=e[0],n=e[1],r=e[2],s=e[3],a=e[4],u=e[5],h=e[6],c=e[7],l=e[8],_=Math.sin(i),p=Math.cos(i);return t[0]=p*o+_*s,t[1]=p*n+_*a,t[2]=p*r+_*u,t[3]=p*s-_*o,t[4]=p*a-_*n,t[5]=p*u-_*r,t[6]=h,t[7]=c,t[8]=l,t},n.scale=function(t,e,i){var o=i[0],n=i[1];return t[0]=o*e[0],t[1]=o*e[1],t[2]=o*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},n.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},n.fromRotation=function(t,e){var i=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=i,t[2]=0,t[3]=-i,t[4]=o,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},n.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},n.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},n.fromQuat=function(t,e){var i=e[0],o=e[1],n=e[2],r=e[3],s=i+i,a=o+o,u=n+n,h=i*s,c=o*s,l=o*a,_=n*s,p=n*a,d=n*u,f=r*s,m=r*a,g=r*u;return t[0]=1-l-d,t[3]=c-g,t[6]=_+m,t[1]=c+g,t[4]=1-h-d,t[7]=p-f,t[2]=_-m,t[5]=p+f,t[8]=1-h-l,t},n.normalFromMat4=function(t,e){var i=e[0],o=e[1],n=e[2],r=e[3],s=e[4],a=e[5],u=e[6],h=e[7],c=e[8],l=e[9],_=e[10],p=e[11],d=e[12],f=e[13],m=e[14],g=e[15],y=i*a-o*s,v=i*u-n*s,b=i*h-r*s,x=o*u-n*a,w=o*h-r*a,M=n*h-r*u,S=c*f-l*d,I=c*m-_*d,E=c*g-p*d,D=l*m-_*f,F=l*g-p*f,T=_*g-p*m,C=y*T-v*F+b*D+x*E-w*I+M*S;return C?(C=1/C,t[0]=(a*T-u*F+h*D)*C,t[1]=(u*E-s*T-h*I)*C,t[2]=(s*F-a*E+h*S)*C,t[3]=(n*F-o*T-r*D)*C,t[4]=(i*T-n*E+r*I)*C,t[5]=(o*E-i*F-r*S)*C,t[6]=(f*M-m*w+g*x)*C,t[7]=(m*b-d*M-g*v)*C,t[8]=(d*w-f*b+g*y)*C,t):null},n.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},n.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))},n.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t},n.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t},n.sub=n.subtract,n.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t},n.multiplyScalarAndAdd=function(t,e,i,o){return t[0]=e[0]+i[0]*o,t[1]=e[1]+i[1]*o,t[2]=e[2]+i[2]*o,t[3]=e[3]+i[3]*o,t[4]=e[4]+i[4]*o,t[5]=e[5]+i[5]*o,t[6]=e[6]+i[6]*o,t[7]=e[7]+i[7]*o,t[8]=e[8]+i[8]*o,t},n.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},n.equals=function(t,e){var i=t[0],n=t[1],r=t[2],s=t[3],a=t[4],u=t[5],h=t[6],c=t[7],l=t[8],_=e[0],p=e[1],d=e[2],f=e[3],m=e[4],g=e[5],y=t[6],v=e[7],b=e[8];return Math.abs(i-_)<=o.EPSILON*Math.max(1,Math.abs(i),Math.abs(_))&&Math.abs(n-p)<=o.EPSILON*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(r-d)<=o.EPSILON*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(s-f)<=o.EPSILON*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(a-m)<=o.EPSILON*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(u-g)<=o.EPSILON*Math.max(1,Math.abs(u),Math.abs(g))&&Math.abs(h-y)<=o.EPSILON*Math.max(1,Math.abs(h),Math.abs(y))&&Math.abs(c-v)<=o.EPSILON*Math.max(1,Math.abs(c),Math.abs(v))&&Math.abs(l-b)<=o.EPSILON*Math.max(1,Math.abs(l),Math.abs(b))},t.exports=n},function(t,e,i){var o=i(4),n={create:function(){var t=new o.ARRAY_TYPE(3);return t[0]=0,t[1]=0,t[2]=0,t},clone:function(t){var e=new o.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},fromValues:function(t,e,i){var n=new o.ARRAY_TYPE(3);return n[0]=t,n[1]=e,n[2]=i,n},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},set:function(t,e,i,o){return t[0]=e,t[1]=i,t[2]=o,t},add:function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t},subtract:function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}};n.sub=n.subtract,n.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t},n.mul=n.multiply,n.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t},n.div=n.divide,n.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},n.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},n.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t},n.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t},n.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},n.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t},n.scaleAndAdd=function(t,e,i,o){return t[0]=e[0]+i[0]*o,t[1]=e[1]+i[1]*o,t[2]=e[2]+i[2]*o,t},n.distance=function(t,e){var i=e[0]-t[0],o=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(i*i+o*o+n*n)},n.dist=n.distance,n.squaredDistance=function(t,e){var i=e[0]-t[0],o=e[1]-t[1],n=e[2]-t[2];return i*i+o*o+n*n},n.sqrDist=n.squaredDistance,n.length=function(t){var e=t[0],i=t[1],o=t[2];return Math.sqrt(e*e+i*i+o*o)},n.len=n.length,n.squaredLength=function(t){var e=t[0],i=t[1],o=t[2];return e*e+i*i+o*o},n.sqrLen=n.squaredLength,n.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},n.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},n.normalize=function(t,e){var i=e[0],o=e[1],n=e[2],r=i*i+o*o+n*n;return r>0&&(r=1/Math.sqrt(r),t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r),t},n.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},n.cross=function(t,e,i){var o=e[0],n=e[1],r=e[2],s=i[0],a=i[1],u=i[2];return t[0]=n*u-r*a,t[1]=r*s-o*u,t[2]=o*a-n*s,t},n.lerp=function(t,e,i,o){var n=e[0],r=e[1],s=e[2];return t[0]=n+o*(i[0]-n),t[1]=r+o*(i[1]-r),t[2]=s+o*(i[2]-s),t},n.hermite=function(t,e,i,o,n,r){var s=r*r,a=s*(2*r-3)+1,u=s*(r-2)+r,h=s*(r-1),c=s*(3-2*r);return t[0]=e[0]*a+i[0]*u+o[0]*h+n[0]*c,t[1]=e[1]*a+i[1]*u+o[1]*h+n[1]*c,t[2]=e[2]*a+i[2]*u+o[2]*h+n[2]*c,t},n.bezier=function(t,e,i,o,n,r){var s=1-r,a=s*s,u=r*r,h=a*s,c=3*r*a,l=3*u*s,_=u*r;return t[0]=e[0]*h+i[0]*c+o[0]*l+n[0]*_,t[1]=e[1]*h+i[1]*c+o[1]*l+n[1]*_,t[2]=e[2]*h+i[2]*c+o[2]*l+n[2]*_,t},n.random=function(t,e){e=e||1;var i=2*o.RANDOM()*Math.PI,n=2*o.RANDOM()-1,r=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(i)*r,t[1]=Math.sin(i)*r,t[2]=n*e,t},n.transformMat4=function(t,e,i){var o=e[0],n=e[1],r=e[2],s=i[3]*o+i[7]*n+i[11]*r+i[15];return s=s||1,t[0]=(i[0]*o+i[4]*n+i[8]*r+i[12])/s,t[1]=(i[1]*o+i[5]*n+i[9]*r+i[13])/s,t[2]=(i[2]*o+i[6]*n+i[10]*r+i[14])/s,t},n.transformMat3=function(t,e,i){var o=e[0],n=e[1],r=e[2];return t[0]=o*i[0]+n*i[3]+r*i[6],t[1]=o*i[1]+n*i[4]+r*i[7],t[2]=o*i[2]+n*i[5]+r*i[8],t},n.transformQuat=function(t,e,i){var o=e[0],n=e[1],r=e[2],s=i[0],a=i[1],u=i[2],h=i[3],c=h*o+a*r-u*n,l=h*n+u*o-s*r,_=h*r+s*n-a*o,p=-s*o-a*n-u*r;return t[0]=c*h+p*-s+l*-u-_*-a,t[1]=l*h+p*-a+_*-s-c*-u,t[2]=_*h+p*-u+c*-a-l*-s,t},n.rotateX=function(t,e,i,o){var n=[],r=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],r[0]=n[0],r[1]=n[1]*Math.cos(o)-n[2]*Math.sin(o),r[2]=n[1]*Math.sin(o)+n[2]*Math.cos(o),t[0]=r[0]+i[0],t[1]=r[1]+i[1],t[2]=r[2]+i[2],t},n.rotateY=function(t,e,i,o){var n=[],r=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],r[0]=n[2]*Math.sin(o)+n[0]*Math.cos(o),r[1]=n[1],r[2]=n[2]*Math.cos(o)-n[0]*Math.sin(o),t[0]=r[0]+i[0],t[1]=r[1]+i[1],t[2]=r[2]+i[2],t},n.rotateZ=function(t,e,i,o){var n=[],r=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],r[0]=n[0]*Math.cos(o)-n[1]*Math.sin(o),r[1]=n[0]*Math.sin(o)+n[1]*Math.cos(o),r[2]=n[2],t[0]=r[0]+i[0],t[1]=r[1]+i[1],t[2]=r[2]+i[2],t},n.forEach=function(){var t=n.create();return function(e,i,o,n,r,s){var a,u;for(i||(i=3),o||(o=0),u=n?Math.min(n*i+o,e.length):e.length,a=o;a<u;a+=i)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],r(t,t,s),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2];return e}}(),n.angle=function(t,e){var i=n.fromValues(t[0],t[1],t[2]),o=n.fromValues(e[0],e[1],e[2]);n.normalize(i,i),n.normalize(o,o);var r=n.dot(i,o);return r>1?0:Math.acos(r)},n.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},n.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},n.equals=function(t,e){var i=t[0],n=t[1],r=t[2],s=e[0],a=e[1],u=e[2];return Math.abs(i-s)<=o.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(n-a)<=o.EPSILON*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-u)<=o.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))},t.exports=n},function(t,e,i){var o=i(4),n={create:function(){var t=new o.ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},clone:function(t){var e=new o.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},fromValues:function(t,e,i,n){var r=new o.ARRAY_TYPE(4);return r[0]=t,r[1]=e,r[2]=i,r[3]=n,r},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},set:function(t,e,i,o,n){return t[0]=e,t[1]=i,t[2]=o,t[3]=n,t},add:function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},subtract:function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}};n.sub=n.subtract,n.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t},n.mul=n.multiply,n.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t},n.div=n.divide,n.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},n.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},n.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t},n.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t},n.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},n.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},n.scaleAndAdd=function(t,e,i,o){return t[0]=e[0]+i[0]*o,t[1]=e[1]+i[1]*o,t[2]=e[2]+i[2]*o,t[3]=e[3]+i[3]*o,t},n.distance=function(t,e){var i=e[0]-t[0],o=e[1]-t[1],n=e[2]-t[2],r=e[3]-t[3];return Math.sqrt(i*i+o*o+n*n+r*r)},n.dist=n.distance,n.squaredDistance=function(t,e){var i=e[0]-t[0],o=e[1]-t[1],n=e[2]-t[2],r=e[3]-t[3];return i*i+o*o+n*n+r*r},n.sqrDist=n.squaredDistance,n.length=function(t){var e=t[0],i=t[1],o=t[2],n=t[3];return Math.sqrt(e*e+i*i+o*o+n*n)},n.len=n.length,n.squaredLength=function(t){var e=t[0],i=t[1],o=t[2],n=t[3];return e*e+i*i+o*o+n*n},n.sqrLen=n.squaredLength,n.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},n.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},n.normalize=function(t,e){var i=e[0],o=e[1],n=e[2],r=e[3],s=i*i+o*o+n*n+r*r;return s>0&&(s=1/Math.sqrt(s),t[0]=i*s,t[1]=o*s,t[2]=n*s,t[3]=r*s),t},n.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},n.lerp=function(t,e,i,o){var n=e[0],r=e[1],s=e[2],a=e[3];return t[0]=n+o*(i[0]-n),t[1]=r+o*(i[1]-r),t[2]=s+o*(i[2]-s),t[3]=a+o*(i[3]-a),t},n.random=function(t,e){return e=e||1,t[0]=o.RANDOM(),t[1]=o.RANDOM(),t[2]=o.RANDOM(),t[3]=o.RANDOM(),n.normalize(t,t),n.scale(t,t,e),t},n.transformMat4=function(t,e,i){var o=e[0],n=e[1],r=e[2],s=e[3];return t[0]=i[0]*o+i[4]*n+i[8]*r+i[12]*s,t[1]=i[1]*o+i[5]*n+i[9]*r+i[13]*s,t[2]=i[2]*o+i[6]*n+i[10]*r+i[14]*s,t[3]=i[3]*o+i[7]*n+i[11]*r+i[15]*s,t},n.transformQuat=function(t,e,i){var o=e[0],n=e[1],r=e[2],s=i[0],a=i[1],u=i[2],h=i[3],c=h*o+a*r-u*n,l=h*n+u*o-s*r,_=h*r+s*n-a*o,p=-s*o-a*n-u*r;return t[0]=c*h+p*-s+l*-u-_*-a,t[1]=l*h+p*-a+_*-s-c*-u,t[2]=_*h+p*-u+c*-a-l*-s,t[3]=e[3],t},n.forEach=function(){var t=n.create();return function(e,i,o,n,r,s){var a,u;for(i||(i=4),o||(o=0),u=n?Math.min(n*i+o,e.length):e.length,a=o;a<u;a+=i)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],r(t,t,s),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}}(),n.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},n.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},n.equals=function(t,e){var i=t[0],n=t[1],r=t[2],s=t[3],a=e[0],u=e[1],h=e[2],c=e[3];return Math.abs(i-a)<=o.EPSILON*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-u)<=o.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(r-h)<=o.EPSILON*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(s-c)<=o.EPSILON*Math.max(1,Math.abs(s),Math.abs(c))},t.exports=n},function(t,e,i){"use strict";var o=i(3),n=function(t){o.apply(this,arguments),this.objects={}};i(1).inherit(n,o),n.prototype.init=function(){o.prototype.init.apply(this,arguments),this.objects={}},n.prototype.beforeDraw=function(){for(var t in o.prototype.beforeDraw.apply(this,arguments),this.objects)this.objects[t].beforeDraw()},n.prototype.draw=function(){for(var t in o.prototype.draw.apply(this,arguments),this.objects)this.objects[t].draw()},n.prototype.afterDraw=function(){for(var t in o.prototype.afterDraw.apply(this,arguments),this.objects)this.objects[t].afterDraw()},n.prototype.addObject=function(t){this.objects[t.id]=t},n.prototype.addObjects=function(t){throw new Error("not implemented yet.")},n.prototype.removeAllObject=function(){this.objects={}},n.prototype.removeObject=function(t){return this.remove(t.id)},n.prototype.existsObject=function(t){return t.id in this.objects},n.prototype.remove=function(t){var e=this.objects[t];return delete this.objects[t],e},n.prototype.get=function(t){return this.objects[t]},n.prototype.getRandom=function(){var t=Object.keys(this.objects),e=t[Math.floor(Math.random()*t.length)];return this.objects[e]},n.prototype.forEach=function(t){for(var e in this.objects)t(this.objects[e])},n.prototype.count=function(){return Object.keys(this.objects).length},n.prototype.checkCollisionWithObject=function(t){var e=!1;for(var i in this.objects){var o=this.objects[i];t.intersect(o)&&(t.onCollision(o),o.onCollision(t),e=!0)}return e},n.prototype.checkCollisionWithContainer=function(t){for(var e in this.objects)for(var i in t.objects)if(this.objects[e].checkCollision(t.objects[i])){var o=this.objects[e],n=t.objects[i];if(o.onCollision(n),n.onCollision(o),!this.objects[e])break}},n.prototype.removeOutOfStageObjects=function(){for(var t in this.objects)this.objects[t].isOutOfStage()&&this.remove(t)},t.exports=n},function(t,e,i){"use strict";var o=i(3),n=i(1),r=i(29),s=i(28).SPRITE3D,a=function(t,e){o.apply(this,arguments),this.Class=e,this.objects={},this.vertices=[],this.coordinates=[],this.indices=[],this.colors=[];var i=this.core.gl;this.vBuffer=i.createBuffer(),this.cBuffer=i.createBuffer(),this.iBuffer=i.createBuffer(),this.aBuffer=i.createBuffer(),this.mvMatrix=r.mat4.create(),this.pMatrix=r.mat4.create()};n.inherit(a,o),a.prototype.init=function(){o.prototype.init.apply(this,arguments),this.objects={},this._initmvpMatrix()},a.prototype._initmvpMatrix=function(){r.mat4.identity(this.mvMatrix),r.mat4.translate(this.mvMatrix,this.mvMatrix,[-this.core.width/2,this.core.height/2,0]),this._setOrthographicProjection()},a.prototype._setOrthographicProjection=function(){r.mat4.identity(this.pMatrix);r.mat4.ortho(this.pMatrix,-this.core.width/2,this.core.width/2,-this.core.height/2,this.core.height/2,.1,10)},a.prototype.beforeDraw=function(){for(var t in o.prototype.beforeDraw.apply(this,arguments),this.objects)this.objects[t].beforeDraw();this._updateAttributes()},a.prototype._updateAttributes=function(){this._resetAttributes();var t=0;for(var e in this.objects){var i=this.objects[e];if(i.isShow()){var o;for(o=0;o<s.V_SIZE;o++)this.vertices[t*s.V_SIZE+o]=i.vertices[o];for(o=0;o<s.C_SIZE;o++)this.coordinates[t*s.C_SIZE+o]=i.coordinates[o];for(o=0;o<s.I_SIZE;o++)this.indices[t*s.I_SIZE+o]=t*s.V_ITEM_NUM+i.indices[o];for(o=0;o<s.A_SIZE;o++)this.colors[t*s.A_SIZE+o]=i.colors[o];t++}}},a.prototype._resetAttributes=function(){this.vertices.length=0,this.coordinates.length=0,this.indices.length=0,this.colors.length=0},a.prototype.draw=function(){if(o.prototype.draw.apply(this,arguments),0!==this.vertices.length){var t=this.core.gl,e=this.shader();for(var i in t.useProgram(e.shader_program),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.enable(t.BLEND),t.disable(t.DEPTH_TEST),this._setupAttribute("aVertexPosition",this.vBuffer,new Float32Array(this.vertices),s.V_ITEM_SIZE),this._setupAttribute("aTextureCoordinates",this.cBuffer,new Float32Array(this.coordinates),s.C_ITEM_SIZE),this._setupAttribute("aColor",this.aBuffer,new Float32Array(this.colors),s.A_ITEM_SIZE),this.objects){var n=this.objects[i].texture;this._setupTexture("uSampler",0,n);break}t.uniformMatrix4fv(e.uniform_locations.uPMatrix,!1,this.pMatrix),t.uniformMatrix4fv(e.uniform_locations.uMVMatrix,!1,this.mvMatrix),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.iBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.indices),t.STATIC_DRAW),t.drawElements(t.TRIANGLES,this.indices.length,t.UNSIGNED_SHORT,0)}},a.prototype._setupAttribute=function(t,e,i,o){var n=this.core.gl,r=this.shader();n.bindBuffer(n.ARRAY_BUFFER,e),n.bufferData(n.ARRAY_BUFFER,i,n.STATIC_DRAW),n.enableVertexAttribArray(r.attribute_locations[t]),n.vertexAttribPointer(r.attribute_locations[t],o,n.FLOAT,!1,0,0)},a.prototype._setupTexture=function(t,e,i){var o=this.core.gl,n=this.shader();o.activeTexture(o["TEXTURE"+e]),o.bindTexture(o.TEXTURE_2D,i),o.uniform1i(n.uniform_locations[t],e)},a.prototype.afterDraw=function(){for(var t in o.prototype.afterDraw.apply(this,arguments),this.objects)this.objects[t].afterDraw()},a.prototype.create=function(){var t=new this.Class(this.scene);return t.init.apply(t,arguments),this.objects[t.id]=t,t},a.prototype.remove=function(t){delete this.objects[t]},a.prototype.checkCollisionWithObject=function(t){for(var e in this.objects){var i=this.objects[e];t.checkCollision(i)&&(t.onCollision(i),i.onCollision(t))}},a.prototype.checkCollisionWithManager=function(t){for(var e in this.objects)for(var i in t.objects)if(this.objects[e].checkCollision(t.objects[i])){var o=this.objects[e],n=t.objects[i];if(o.onCollision(n),n.onCollision(o),!this.objects[e])break}},a.prototype.removeOutOfStageObjects=function(){for(var t in this.objects)this.objects[t].isOutOfStage()&&this.remove(t)},a.prototype.shader=function(){return this.core.sprite_3d_shader},t.exports=a},function(t,e,i){"use strict";var o=i(3),n=i(1),r=function(t,e,i,r,s,a){o.apply(this,arguments),this.x(e),this.y(i),this._width=r,this._height=s,this._draw_function=null,void 0!==a&&(this._draw_function=n.bind(a,this)),this._is_show_rect=!1,this._collision_callback=null};n.inherit(r,o),r.prototype.onCollision=function(t){this._collision_callback&&this._collision_callback(t)},r.prototype.collisionWidth=function(){return this._width},r.prototype.collisionHeight=function(){return this._height},r.prototype.setShowRect=function(){return this._is_show_rect=!0,this},r.prototype.setVariable=function(t,e){return this[t]=e,this},r.prototype.setCollisionCallback=function(t){this._collision_callback=n.bind(t,this)},r.prototype.draw=function(){o.prototype.draw.apply(this,arguments);var t=this.core.ctx;t.save(),this._draw_function&&this._draw_function(),t.restore(),this._is_show_rect&&(t.save(),t.fillStyle="rgb( 255, 255, 255 )",t.globalAlpha=.4,t.fillRect(this.getCollisionLeftX(),this.getCollisionUpY(),this.collisionWidth(),this.collisionHeight()),t.restore())},t.exports=r},function(t,e,i){"use strict";var o=i(12),n=function(t){o.apply(this,arguments)};i(1).inherit(n,o);var r="hakurei_engine",s="save";n.KEY=function(){return!this.isLocalMode()&&window&&window.location?[r,s,window.location.pathname].join(":"):s},t.exports=n},function(t,e,i){"use strict";var o=i(0).Object.UIParts,n=i(2),r={};function s(t){return function(){var e,i=this.core.ctx;e=this.onmouse?this.core.image_loader.getImage("button_gray"):this.core.image_loader.getImage("button_white");var o=0,r=0;this.isclick&&(o=3,r=3),i.save(),i.drawImage(e,this.getCollisionLeftX()+o,this.getCollisionUpY()+r,.5*e.width,1.5*e.height),i.textAlign="center",i.textBaseline="middle",i.font="24px 'MyFont'",i.fillStyle=n.COLOR_BLACK,i.fillText(t,this.x()+o,this.y()+r),i.restore()}}r.exec=function(t){return{pass_button:new o(t,75,480,90,45,s("Pass")),high_button:new o(t,190,480,90,45,s("High")),low_button:new o(t,290,480,90,45,s("Low")),same_button:new o(t,390,480,90,45,s("Same"))}},t.exports=r},function(t,e,i){"use strict";var o=i(0).Scene.Base,n=i(2),r=function(t){o.apply(this,arguments),this._money=0};i(0).Util.inherit(r,o),r.prototype.init=function(t){o.prototype.init.apply(this,arguments),this._money=t||0,this.core.scene_manager.setFadeIn(60,n.COLOR_BLACK),this.core.audio_loader.playSound(this.soundName())},r.prototype.beforeDraw=function(){o.prototype.beforeDraw.apply(this,arguments),this.core.input_manager.isLeftClickPush()&&(this.core.scene_manager.setFadeOut(60,n.COLOR_BLACK),this.core.scene_manager.changeScene("rule"))},r.prototype.draw=function(){o.prototype.draw.apply(this,arguments);var t=this.core.ctx,e=this.core.image_loader.getImage(this.bgName());t.save(),t.translate(this.width/2,this.height/2),t.drawImage(e,-e.width/2,-e.height/2),t.restore(),t.save(),t.font="48px 'MyFont'",t.strokeStyle=n.COLOR_BLACK,t.lineWidth=4,t.textAlign="left",t.strokeText("Congratulations!!",20,50),t.textAlign="right",t.strokeText("獲得した金額"+this._money+"円",this.width,this.height-20),t.fillStyle="rgb(255,215,0)",t.textAlign="left",t.fillText("Congratulations!!",20,50),t.textAlign="right",t.fillText("獲得した金額"+this._money+"円",this.width,this.height-20),t.restore()},r.prototype.soundName=function(){throw new Error("soundName must be overridden.")},r.prototype.bgName=function(){throw new Error("bgName must be overridden.")},t.exports=r},function(t,e,i){"use strict";var o,n=i(40),r=i(2);window.onload=function(){var t=document.getElementById("mainCanvas");if((o=new n(t,{})).init(),r.DEBUG){var e=document.getElementById("debug");o.setupDebug(e)}o.setupEvents(),o.fullsize(),o.startRun()},window.require&&window.require("electron").webFrame.setVisualZoomLevelLimits(1,1)},function(t,e,i){"use strict";var o=i(0).Core,n=i(0).Util,r=i(0).Scene.Loading,s=i(67),a=i(69),u=i(70),h=i(85),c=i(86),l=i(2),_=i(87),p=function(t){o.apply(this,arguments),this.is_finish_tutorial=!1,this.scene_manager.addScene("loading_preload",new r(this)),this.scene_manager.addScene("loading_all",new s(this)),this.scene_manager.addScene("rule",new a(this)),this.scene_manager.addScene("duel",new u(this)),this.scene_manager.addScene("clear",new h(this)),this.scene_manager.addScene("clear_ex",new c(this))};n.inherit(p,o),p.prototype.init=function(){o.prototype.init.apply(this,arguments),this.is_finish_tutorial=!1,this.scene_manager.changeScene("loading_preload",_,"loading_all")},p.prototype.setupDebug=function(t){l.DEBUG&&(this.debug_manager.setOn(t),this.debug_manager.addMenuButton("Run",function(t){t.startRun()}),this.debug_manager.addMenuButton("Stop",function(t){t.stopRun()}),this.debug_manager.addCaputureImageButton("画面キャプチャ"),this.debug_manager.addMenuButton("FPS表示",function(t){t.debug_manager.setShowingFpsOn()}),this.debug_manager.addMenuButton("FPS非表示",function(t){t.debug_manager.setShowingFpsOff()}),this.debug_manager.addMenuButton("所持金を2倍にする",function(t){t.scene_manager.currentScene()instanceof u?t.scene_manager.currentScene().rule_manager.twiceMoney():window.alert("ゲームが始まってから押してください")}))},t.exports=p},function(t,e,i){"use strict";var o={util:i(1),core:i(22),shader_program:i(18),constant:i(1).assign(i(5),{button:i(5)}),serif_manager:i(19),save_manager:i(10),manager:{save:i(10),scenario:i(19)},scene:{base:i(9),loading:i(14),movie:i(25)},object:{base:i(3),point:i(11),sprite:i(26),sprite3d:i(27),pool_manager:i(20),pool_manager3d:i(34),ui_parts:i(35)},asset_loader:{image:i(15),audio:i(16),font:i(17)},storage:{base:i(12),save:i(36)},Util:i(1),Core:i(22),ShaderProgram:i(18),Log:i(60),Constant:{Button:i(5)},Manager:{Save:i(10),Scenario:i(19),Time:i(24)},Scene:{Base:i(9),Loading:i(14),Movie:i(25)},Object:{Base:i(3),Point:i(11),Sprite:i(26),Sprite3d:i(27),Container:i(33),PoolManager:i(20),PoolManager3d:i(34),PoolContainer:i(20),UIParts:i(35),UI:{Base:i(7),Text:i(61),Spinner:i(62),Group:i(63),Image:i(64)}},AssetLoader:{Image:i(15),Audio:i(16),Font:i(17)},Storage:{Base:i(12),Save:i(36)},Master:{RepositoryGenerator:i(65)}};t.exports=o},function(t,e,i){(function(e){WebGLDebugUtils=function(){"undefined"==typeof window&&(window=e);var t=function(t){window.console&&window.console.error?window.console.error(t):function(t){window.console&&window.console.log&&window.console.log(t)}(t)},i={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},o=null,n=null;function r(t){if(null==o)for(var e in o={},n={},t)"number"==typeof t[e]&&(o[t[e]]=e,n[e]=t[e])}function s(){if(null==o)throw"WebGLDebugUtils.init(ctx) not called"}function a(t){s();var e=o[t];return void 0!==e?"gl."+e:"/*UNKNOWN WebGL ENUM*/ 0x"+t.toString(16)}function u(t,e,o,r){var s;if(void 0!==(s=i[t])&&(void 0!==(s=s[e])&&s[o])){if("object"==typeof s[o]&&void 0!==s[o].enumBitwiseOr){for(var u=s[o].enumBitwiseOr,h=0,c=[],l=0;l<u.length;++l){var _=n[u[l]];0!=(r&_)&&(h|=_,c.push(a(_)))}return h===r?c.join(" | "):a(r)}return a(r)}return null===r?"null":void 0===r?"undefined":r.toString()}function h(t,e,i){t.__defineGetter__(i,function(){return e[i]}),t.__defineSetter__(i,function(t){e[i]=t})}function c(t){var e=t.getParameter(t.MAX_VERTEX_ATTRIBS),i=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,i);for(var o=0;o<e;++o)t.disableVertexAttribArray(o),t.vertexAttribPointer(o,4,t.FLOAT,!1,0,0),t.vertexAttrib1f(o,0);t.deleteBuffer(i);var n=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);for(o=0;o<n;++o)t.activeTexture(t.TEXTURE0+o),t.bindTexture(t.TEXTURE_CUBE_MAP,null),t.bindTexture(t.TEXTURE_2D,null);for(t.activeTexture(t.TEXTURE0),t.useProgram(null),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindRenderbuffer(t.RENDERBUFFER,null),t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.DITHER),t.disable(t.SCISSOR_TEST),t.blendColor(0,0,0,0),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.clearColor(0,0,0,0),t.clearDepth(1),t.clearStencil(-1),t.colorMask(!0,!0,!0,!0),t.cullFace(t.BACK),t.depthFunc(t.LESS),t.depthMask(!0),t.depthRange(0,1),t.frontFace(t.CCW),t.hint(t.GENERATE_MIPMAP_HINT,t.DONT_CARE),t.lineWidth(1),t.pixelStorei(t.PACK_ALIGNMENT,4),t.pixelStorei(t.UNPACK_ALIGNMENT,4),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.UNPACK_COLORSPACE_CONVERSION_WEBGL&&t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.BROWSER_DEFAULT_WEBGL),t.polygonOffset(0,0),t.sampleCoverage(1,!1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilMask(4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.viewport(0,0,t.canvas.width,t.canvas.height),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT);t.getError(););}return{init:r,mightBeEnum:function(t){return s(),void 0!==o[t]},glEnumToString:a,glFunctionArgToString:u,glFunctionArgsToString:function(t,e){for(var i="",o=e.length,n=0;n<o;++n)i+=(0==n?"":", ")+u(t,o,n,e[n]);return i},makeDebugContext:function e(i,o,n,s){s=s||i,r(i),o=o||function(e,i,o){for(var n="",r=o.length,s=0;s<r;++s)n+=(0==s?"":", ")+u(i,r,s,o[s]);t("WebGL error "+a(e)+" in "+i+"("+n+")")};var c={};function l(t,e){return function(){n&&n(e,arguments);var i=t[e].apply(t,arguments),r=s.getError();return 0!=r&&(c[r]=!0,o(r,e,arguments)),i}}var _={};for(var p in i)if("function"==typeof i[p])if("getExtension"!=p)_[p]=l(i,p);else{var d=l(i,p);_[p]=function(){return e(d.apply(i,arguments),o,n,s)}}else h(_,i,p);return _.getError=function(){for(var t in c)if(c.hasOwnProperty(t)&&c[t])return c[t]=!1,t;return i.NO_ERROR},_},makeLostContextSimulatingCanvas:function(t){var e,i=[],o=[],n={},r=1,s=!1,a=[],u=0,l=0,_=!1,p=0,d={};function f(t){return"function"==typeof t?t:function(e){t.handleEvent(e)}}t.getContext=function(i){return function(){var o=i.apply(t,arguments);if(o instanceof WebGLRenderingContext){if(o!=e){if(e)throw"got different context";n=function(t){for(var i in t)"function"==typeof t[i]?n[i]=v(t,i):h(n,t,i);n.getError=function(){if(y(),!s)for(;t=e.getError();)d[t]=!0;for(var t in d)if(d[t])return delete d[t],t;return n.NO_ERROR};for(var o=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],u=0;u<o.length;++u){var c=o[u];n[c]=function(e){return function(){if(y(),s)return null;var i=e.apply(t,arguments);return i.__webglDebugContextLostId__=r,a.push(i),i}}(t[c])}for(var l=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"],u=0;u<l.length;++u){var c=l[u];n[c]=function(e){return function(){return y(),s?null:e.apply(t,arguments)}}(n[c])}for(var _=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"],u=0;u<_.length;++u){var c=_[u];n[c]=function(e){return function(){return y(),!s&&e.apply(t,arguments)}}(n[c])}return n.checkFramebufferStatus=function(e){return function(){return y(),s?n.FRAMEBUFFER_UNSUPPORTED:e.apply(t,arguments)}}(n.checkFramebufferStatus),n.getAttribLocation=function(e){return function(){return y(),s?-1:e.apply(t,arguments)}}(n.getAttribLocation),n.getVertexAttribOffset=function(e){return function(){return y(),s?0:e.apply(t,arguments)}}(n.getVertexAttribOffset),n.isContextLost=function(){return s},n}(e=o)}return n}return o}}(t.getContext);var m=function(t){i.push(f(t))},g=function(t){o.push(f(t))};function y(){++l,s||u==l&&t.loseContext()}function v(t,e){var i=t[e];return function(){if(y(),!s)return i.apply(t,arguments)}}function b(t){return{statusMessage:t,preventDefault:function(){_=!0}}}return function(t){var e=t.addEventListener;t.addEventListener=function(i,o,n){switch(i){case"webglcontextlost":m(o);break;case"webglcontextrestored":g(o);break;default:e.apply(t,arguments)}}}(t),t.loseContext=function(){if(!s){for(s=!0,u=0,++r;e.getError(););!function(){for(var t=Object.keys(d),e=0;e<t.length;++e)delete d[t]}(),d[e.CONTEXT_LOST_WEBGL]=!0;var o=b("context lost"),n=i.slice();setTimeout(function(){for(var e=0;e<n.length;++e)n[e](o);p>=0&&setTimeout(function(){t.restoreContext()},p)},0)}},t.restoreContext=function(){s&&o.length&&setTimeout(function(){if(!_)throw"can not restore. webglcontestlost listener did not call event.preventDefault";!function(){for(var t=0;t<a.length;++t){var i=a[t];i instanceof WebGLBuffer?e.deleteBuffer(i):i instanceof WebGLFramebuffer?e.deleteFramebuffer(i):i instanceof WebGLProgram?e.deleteProgram(i):i instanceof WebGLRenderbuffer?e.deleteRenderbuffer(i):i instanceof WebGLShader?e.deleteShader(i):i instanceof WebGLTexture&&e.deleteTexture(i)}}(),c(e),s=!1,l=0,_=!1;for(var t=o.slice(),i=b("context restored"),n=0;n<t.length;++n)t[n](i)},0)},t.loseContextInNCalls=function(t){if(s)throw"You can not ask a lost contet to be lost";u=l+t},t.getNumCalls=function(){return l},t.setRestoreTimeout=function(t){p=t},t},resetToInitialState:c}}(),t.exports=WebGLDebugUtils}).call(this,i(43))},function(t,e){var i;i=function(){return this}();try{i=i||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e,i){"use strict";var o=i(1),n=function(t){this.core=t,this.dom=null,this.is_debug_mode=!1,this._collision_area_color=null,this._is_showing_fps=!1,this._variables={},this._before_time=0,this._fps=0};n.prototype.init=function(){this._before_time=0,this._fps=0},n.prototype.setOn=function(t){this.is_debug_mode=!0,this.dom=t},n.prototype.setOff=function(){this.is_debug_mode=!1,this.dom=null},n.prototype.set=function(t,e){this.is_debug_mode&&(this._variables[t]=e)},n.prototype.get=function(t){return this.is_debug_mode?this._variables[t]:null},n.prototype.beforeRun=function(){this.isShowingFps()&&this._calculateFps()},n.prototype._calculateFps=function(){if(this.core.frame_count%60==0){var t=Date.now();this._before_time&&(this._fps=Math.floor(6e4/(t-this._before_time))),this._before_time=t}},n.prototype.afterRun=function(){this.isShowingFps()&&this._renderFps()},n.prototype._renderFps=function(){var t=this.core.ctx;t.save(),t.fillStyle="red",t.textAlign="left",t.font="16px 'sans-serif'",t.fillText("FPS: "+this._fps,this.core.width-70,this.core.height-10),t.restore()},n.prototype.addMenuText=function(t){if(this.is_debug_mode){var e=window.document.createElement("pre");e.textContent=t,this.dom.appendChild(e)}},n.prototype.addNewLine=function(){if(this.is_debug_mode){var t=window.document.createElement("br");this.dom.appendChild(t)}},n.prototype.addMenuImage=function(t){if(this.is_debug_mode){var e=window.document.createElement("img");e.src=t,this.dom.appendChild(e)}},n.prototype.addMenuButton=function(t,e){if(this.is_debug_mode){var i=this.core,o=window.document.createElement("input");o.setAttribute("type","button"),o.setAttribute("value",t),o.onclick=function(){e(i)},this.dom.appendChild(o)}},n.prototype.addMenuSelect=function(t,e,i){if(this.is_debug_mode){var o=this.core,n=window.document.createElement("select"),r=document.createElement("option");r.setAttribute("value",""),r.appendChild(document.createTextNode(t)),n.appendChild(r),n.onchange=function(){""!==n.value&&i(o,n.value)};for(var s=0,a=e.length;s<a;s++){var u=e[s],h=u.value,c=c in u?u.name:h,l=document.createElement("option");l.setAttribute("value",h),l.appendChild(document.createTextNode(c)),n.appendChild(l)}this.dom.appendChild(n)}},n.prototype.addGitLatestCommitInfo=function(t,e,i){if(this.is_debug_mode){i=i||"master";var o=window.document.createElement("pre");this.dom.appendChild(o);var n="https://api.github.com/repos/"+t+"/"+e+"/branches/"+i,r=new XMLHttpRequest;r.onload=function(){if(200===r.status){var t,e=r.response;if(!e)throw new Error("Can't parse git lastest commit info");t=JSON.parse(e),o.textContent="last update date: "+new Date(t.commit.commit.author.date)+"\n"}},r.open("GET",n,!0),r.send(null)}};n.prototype.addCaputureImageButton=function(t,e){if(this.is_debug_mode){var i=this.core.canvas_dom;this.addMenuButton(t,function(){var t=e;if(void 0===e){var n=new Date;t=Math.floor(n.getTime()/1e3)}var r=function(t){for(var e=t.split(","),i=atob(e[1]),o=e[0].split(":")[1].split(";")[0],n=new Uint8Array(i.length),r=0;r<i.length;r++)n[r]=i.charCodeAt(r);return new Blob([n],{type:o})}(i.toDataURL("image/png"));o.downloadBlob(r,t+".png")})}};var r={array_buffer:"readAsArrayBuffer",binary_string:"readAsBinaryString",text:"readAsText",data_url:"readAsDataURL"};n.prototype.addUploadFileButton=function(t,e,i){if(this.is_debug_mode){if(void 0===i&&(i="array_buffer"),!r[i])throw new Error("Unknown read_type: "+i);var o=window.document.createElement("pre");o.style.display="inline",o.textContent=t,this.dom.appendChild(o);var n=window.document.createElement("input");n.setAttribute("type","file");var s=r[i],a=this.core;n.onchange=function(t){if(n.value){var i=t.target.files[0],o=new FileReader,r=i.type;o.onload=function(t){var i=t.target.result;e(a,r,i)},o[s](i)}},n.onclick=function(t){n.value=null},this.dom.appendChild(n)}},n.prototype.setShowingCollisionAreaOn=function(t){if(!this.is_debug_mode)return null;t=t||"white",this._collision_area_color=t},n.prototype.setShowingCollisionAreaOff=function(){if(!this.is_debug_mode)return null;this._collision_area_color=null},n.prototype.isShowingCollisionArea=function(){return!!this.is_debug_mode&&!!this._collision_area_color},n.prototype.collisionAreaColor=function(){return this.is_debug_mode?this._collision_area_color:null},n.prototype.setShowingFpsOn=function(){if(!this.is_debug_mode)return null;this._is_showing_fps=!0},n.prototype.setShowingFpsOff=function(){if(!this.is_debug_mode)return null;this._is_showing_fps=!1},n.prototype.isShowingFps=function(){return!!this.is_debug_mode&&this._is_showing_fps},t.exports=n},function(t,e,i){"use strict";var o=i(14),n=function(t){this.core=t,this._current_scene=null,this._reserved_next_scene_name_and_arguments=null,this._is_reserved_next_scene_init=!0,this._scenes={},this._fade_in_duration=null,this._fade_in_color=null,this._fade_in_start_frame_count=null,this._fade_out_duration=null,this._fade_out_color=null,this._fade_out_start_frame_count=null,this._is_fade_out_finished=!1,this.addScene("loading",new o(t))};n.prototype.init=function(){this._current_scene=null,this._reserved_next_scene_name_and_arguments=null,this._is_reserved_next_scene_init=!0,this._fade_in_duration=null,this._fade_in_color=null,this._fade_in_start_frame_count=null,this._fade_out_duration=null,this._fade_out_color=null,this._fade_out_start_frame_count=null,this._is_fade_out_finished=!1},n.prototype.beforeRun=function(){this._changeNextSceneIfReserved()},n.prototype.currentScene=function(){return null===this._current_scene?null:this._scenes[this._current_scene]},n.prototype.addScene=function(t,e){this._scenes[t]=e},n.prototype.changeScene=function(t,e){if(!(t in this._scenes))throw new Error(t+" scene doesn't exists.");var i=Array.prototype.slice.call(arguments);this._reserved_next_scene_name_and_arguments=i,this._is_reserved_next_scene_init=!0,this._current_scene||this._changeNextSceneIfReserved()},n.prototype.returnScene=function(t){if(!(t in this._scenes))throw new Error(t+" scene doesn't exists.");this._reserved_next_scene_name_and_arguments=[t],this._is_reserved_next_scene_init=!1},n.prototype._changeNextSceneIfReserved=function(){if(this._reserved_next_scene_name_and_arguments)if(!this.isSetFadeOut()||this._is_fade_out_finished||this.isInFadeOut())if(this.isSetFadeOut()&&!this._is_fade_out_finished&&this.isInFadeOut());else{this._current_scene=this._reserved_next_scene_name_and_arguments.shift();var t=this.currentScene(),e=this._reserved_next_scene_name_and_arguments;this._reserved_next_scene_name_and_arguments=null,this._is_reserved_next_scene_init&&(this._resetFadeOut(),t.init.apply(t,e)),this._is_fade_out_finished=!1}else this.startFadeOut()},n.prototype.changeSceneWithLoading=function(t,e){e||(e={}),this.changeScene("loading",e,t)},n.prototype.setFadeIn=function(t,e){this._fade_in_duration=t||30,this._fade_in_color=e||"white",this._startFadeIn()},n.prototype._startFadeIn=function(){this._quitFadeOut(),this._fade_in_start_frame_count=this.core.frame_count},n.prototype._quitFadeIn=function(){this._fade_in_start_frame_count=null},n.prototype.isInFadeIn=function(){return null!==this._fade_in_start_frame_count},n.prototype.setFadeOut=function(t,e){t=void 0!==t?t:30,this._fade_out_duration=t,this._fade_out_color=e||"black"},n.prototype._resetFadeOut=function(){this._fade_out_duration=null,this._fade_out_color=null},n.prototype.startFadeOut=function(){this.isSetFadeOut()&&(this._quitFadeIn(),this._fade_out_start_frame_count=this.core.frame_count)},n.prototype._quitFadeOut=function(){this._fade_out_start_frame_count=null},n.prototype.isInFadeOut=function(){return null!==this._fade_out_start_frame_count},n.prototype.isSetFadeOut=function(){return!(!this._fade_out_duration||!this._fade_out_color)},n.prototype.drawTransition=function(){var t,e=this.core.ctx;this.isInFadeIn()?(e.save(),t=this.core.frame_count-this._fade_in_start_frame_count<this._fade_in_duration?1-(this.core.frame_count-this._fade_in_start_frame_count)/this._fade_in_duration:0,e.globalAlpha=t,e.fillStyle=this._fade_in_color,e.fillRect(0,0,this.core.width,this.core.height),e.restore(),0===t&&this._quitFadeIn()):this.isInFadeOut()&&(e.save(),t=this.core.frame_count-this._fade_out_start_frame_count<this._fade_out_duration?(this.core.frame_count-this._fade_out_start_frame_count)/this._fade_out_duration:1,e.globalAlpha=t,e.fillStyle=this._fade_out_color,e.fillRect(0,0,this.core.width,this.core.height),e.restore(),1===t&&(this._quitFadeOut(),this._is_fade_out_finished=!0))},t.exports=n},function(t,e,i){"use strict";i(47),i(48),i(49),i(50),t.exports=i(6)},function(t,e,i){"use strict";var o=i(5),n=i(6);n.prototype.getAnyButtonId=function(){if(this._is_gamepad_usable){var t=window.navigator.getGamepads()[0];if(t)for(var e=0;e<t.buttons.length;e++)if(t.buttons[e].pressed)return e}},n.prototype._getKeyByButtonId=function(t){var e=this._button_id_to_key_bit_code[t];return e||(e=0),e},n.prototype._handleGamePad=function(){if(this._is_gamepad_usable){var t=window.navigator.getGamepads()[0];if(t){for(var e=0,i=t.buttons.length;e<i;e++)e in this._button_id_to_key_bit_code&&(t.buttons[e].pressed?this._current_keyflag|=this._getKeyByButtonId(e):this._current_keyflag&=~this._getKeyByButtonId(e));t.axes[1]<-.5?this._current_keyflag|=o.BUTTON_UP:this._current_keyflag&=~o.BUTTON_UP,t.axes[1]>.5?this._current_keyflag|=o.BUTTON_DOWN:this._current_keyflag&=~o.BUTTON_DOWN,t.axes[0]<-.5?this._current_keyflag|=o.BUTTON_LEFT:this._current_keyflag&=~o.BUTTON_LEFT,t.axes[0]>.5?this._current_keyflag|=o.BUTTON_RIGHT:this._current_keyflag&=~o.BUTTON_RIGHT}}},t.exports=n},function(t,e,i){"use strict";var o=i(5),n=i(6);n.prototype.isKeyDown=function(t){return!!(this._current_keyflag&t)},n.prototype.isKeyPush=function(t){return!(this._before_keyflag&t)&&this._current_keyflag&t},n.prototype.isKeyRelease=function(t){return this._before_keyflag&t&&!(this._current_keyflag&t)},n.prototype.getKeyDownTime=function(t){return this._key_bit_code_to_down_time[t]},n.prototype._initPressedKeyTime=function(){for(var t in this._key_bit_code_to_down_time={},o){var e=o[t];this._key_bit_code_to_down_time[e]=0}},n.prototype._setPressedKeyTime=function(){for(var t in o){var e=o[t];this.isKeyDown(e)?++this._key_bit_code_to_down_time[e]:this._key_bit_code_to_down_time[e]=0}},n.prototype._keyCodeToBitCode=function(t){var e;switch(t){case 16:e=o.BUTTON_SHIFT;break;case 32:e=o.BUTTON_SPACE;break;case 37:e=o.BUTTON_LEFT;break;case 38:e=o.BUTTON_UP;break;case 39:e=o.BUTTON_RIGHT;break;case 40:e=o.BUTTON_DOWN;break;case 88:e=o.BUTTON_X;break;case 90:e=o.BUTTON_Z}return e},n.prototype._handleKeyDown=function(t){this._current_keyflag|=this._keyCodeToBitCode(t.keyCode),t.preventDefault()},n.prototype._handleKeyUp=function(t){this._current_keyflag&=~this._keyCodeToBitCode(t.keyCode),t.preventDefault()},t.exports=n},function(t,e,i){"use strict";var o=i(11),n=i(6);n.prototype.isLeftClickDown=function(){return this._is_left_clicked},n.prototype.isLeftClickPush=function(){return this._is_left_clicked&&!this._before_is_left_clicked},n.prototype.isLeftClickRelease=function(){return!this._is_left_clicked&&this._before_is_left_clicked},n.prototype.isRightClickDown=function(){return this._is_right_clicked},n.prototype.isRightClickPush=function(){return this._is_right_clicked&&!this._before_is_right_clicked},n.prototype.isRightClickRelease=function(){return!this._is_right_clicked&&this._before_is_right_clicked},n.prototype.mousePositionPoint=function(t){var e=this.mousePositionX(),i=this.mousePositionY(),n=new o(t);return n.init(),n.setPosition(e,i),n},n.prototype.mouseScroll=function(){return this._mouse_scroll},n.prototype.mousePositionX=function(){return this._mouse_x},n.prototype.mousePositionY=function(){return this._mouse_y},n.prototype.mouseMoveX=function(){return this._mouse_change_x},n.prototype.mouseMoveY=function(){return this._mouse_change_y},n.prototype._handleMouseDown=function(t){"which"in t?(this._is_left_clicked=1===t.which,this._is_right_clicked=3===t.which):"button"in t&&(this._is_left_clicked=1===t.button,this._is_right_clicked=2===t.button),t.preventDefault()},n.prototype._handleMouseUp=function(t){"which"in t?(this._is_left_clicked=1!==t.which&&this._is_left_clicked,this._is_right_clicked=3!==t.which&&this._is_right_clicked):"button"in t&&(this._is_left_clicked=1!==t.button&&this._is_left_clicked,this._is_right_clicked=2!==t.button&&this._is_right_clicked),t.preventDefault()},n.prototype._handleMouseMove=function(t){var e=(t=t||window.event).target.getBoundingClientRect(),i=(t.clientX-e.left)*this._click_position_width_ratio,o=(t.clientY-e.top)*this._click_position_height_ratio;this._mouse_change_x=this._mouse_x-i,this._mouse_change_y=this._mouse_y-o,this._mouse_x=i,this._mouse_y=o,t.preventDefault()},n.prototype._handleMouseWheel=function(t){this._mouse_scroll=t.detail?t.detail:-t.wheelDelta/120},t.exports=n},function(t,e,i){"use strict";var o=i(11),n=i(6);n.prototype.getTouch=function(t){if(t>this._touch_ids.length-1)return this._nullTouch();var e=this._touch_ids[t];return new r(this,e)},n.prototype.getAllTouchList=function(){for(var t=[],e=0,i=this._touch_ids.length;e<i;e++){var o=this._touch_ids[e];t.push(new r(this,o))}return t},n.prototype.getTouchList=function(){for(var t=[],e=0,i=this._touch_ids.length;e<i;e++){var o=this._touch_ids[e];o in this._is_touched_map&&t.push(new r(this,o))}return t},n.prototype._nullTouch=function(){return new r(this,-1)},n.prototype._handleTouchDown=function(t){t.preventDefault();for(var e=t.target.getBoundingClientRect(),i=t.changedTouches,o=0,n=i.length;o<n;o++){var r=i[o],s=r.identifier;!function(t,e){for(var i=null,o=0,n=t._touch_ids.length;o<n;o++){if(!(t._touch_ids[o]in t._is_touched_map)){i=o;break}}null===i?i=t._touch_ids.length:delete t._touch_infos[t._touch_ids[i]],t._touch_ids[i]=e,0===i&&(t._is_left_clicked=!0)}(this,s);var a=(r.clientX-e.left)*this._click_position_width_ratio,u=(r.clientY-e.top)*this._click_position_height_ratio;this._touch_infos[s]={x:a,y:u,change_x:0,change_y:0},this._is_touched_map[s]=!0}},n.prototype._handleTouchUp=function(t){t.preventDefault();for(var e=t.changedTouches,i=0,o=e.length;i<o;i++){var n=e[i].identifier;delete this._is_touched_map[n],n===this._touch_ids[0]&&(this._is_left_clicked=!1)}},n.prototype._handleTouchMove=function(t){t.preventDefault();for(var e=t.target.getBoundingClientRect(),i=t.changedTouches,o=0,n=i.length;o<n;o++){var r=i[o],s=r.identifier;if(s in this._touch_infos){var a=r.clientX-e.left,u=r.clientY-e.top,h=this._touch_infos[s];h.change_x=h.x-a,h.change_y=h.y-u,h.x=a,h.y=u}}},n.prototype._setTouchAsMouse=function(){var t=this.getTouch(0);t.isTouching()&&(this._mouse_change_x=t.moveX(),this._mouse_change_y=t.moveY(),this._mouse_x=t.x(),this._mouse_y=t.y())};var r=function(t,e){this._input_manager=t,this._id=e};r.prototype.isEnable=function(){return this._id in this._input_manager._touch_infos},r.prototype.isTouching=function(){return this._id in this._input_manager._is_touched_map},r.prototype.isTap=function(){return this.isTouching()&&!(this._id in this._input_manager._before_is_touched_map)},r.prototype.isTouchRelease=function(){return!this.isTouching()&&this._id in this._input_manager._before_is_touched_map},r.prototype.positionPoint=function(t){var e=this.x(),i=this.y(),n=new o(t);return n.init(),n.setPosition(e,i),n},r.prototype.x=function(){return this.isEnable()?this._input_manager._touch_infos[this._id].x:0},r.prototype.y=function(){return this.isEnable()?this._input_manager._touch_infos[this._id].y:0},r.prototype.moveX=function(){return this.isEnable()?this._input_manager._touch_infos[this._id].change_x:0},r.prototype.moveY=function(){return this.isEnable()?this._input_manager._touch_infos[this._id].change_y:0},t.exports=n},function(t,e,i){"use strict";var o=i(12),n=function(t){o.apply(this,arguments)};i(1).inherit(n,o);var r="hakurei_engine",s="scenario";n.KEY=function(){return!this.isLocalMode()&&window&&window.location?[r,s,window.location.pathname].join(":"):s},n.prototype.getSerifStatus=function(t){var e=this.get(t);return e||(e={}),e},n.prototype.getPlayedCount=function(t){return this.getSerifStatus(t).played_count||0},n.prototype.incrementPlayedCount=function(t){var e=this.getSerifStatus(t);e.played_count=e.played_count||0,e.played_count++,this.set(t,e)},n.prototype.resetPlayedCount=function(t){var e=this.getSerifStatus(t);e.played_count=0,this.set(t,e)},t.exports=n},function(t,e,i){"use strict";t.exports="precision mediump float;\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoordinates;\nvarying vec4 vColor;\n\nvoid main() {\n\tvec4 textureColor = texture2D(uSampler, vTextureCoordinates);\n\tgl_FragColor = textureColor * vColor;\n}\n\n"},function(t,e,i){"use strict";t.exports="attribute vec3 aVertexPosition;\nattribute vec2 aTextureCoordinates;\nattribute vec4 aColor;\n\nuniform mat4 uMVMatrix;\nuniform mat4 uPMatrix;\nvarying vec2 vTextureCoordinates;\nvarying vec4 vColor;\n\nvoid main() {\n\tgl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n\tvTextureCoordinates = aTextureCoordinates;\n\tvColor = aColor;\n}\n\n"},function(t,e,i){"use strict";var o=function(t){};o.prototype.init=function(t){return console.error("this method is abolished.")},o.prototype.setAutoStart=function(t){return console.error("this method is abolished.")},o.prototype.isEnd=function(){return console.error("this method is abolished.")},o.prototype.isStart=function(){return console.error("this method is abolished.")},o.prototype.next=function(){return console.error("this method is abolished.")},o.prototype._showBackground=function(t){return console.error("this method is abolished.")},o.prototype._showChara=function(t){return console.error("this method is abolished.")},o.prototype._setOption=function(t){return console.error("this method is abolished.")},o.prototype._printMessage=function(t){return console.error("this method is abolished.")},o.prototype.isWaitingNext=function(){return console.error("this method is abolished.")},o.prototype.isEndPrinting=function(){return console.error("this method is abolished.")},o.prototype._startPrintMessage=function(){return console.error("this method is abolished.")},o.prototype._cancelPrintMessage=function(){return console.error("this method is abolished.")},o.prototype.startPrintMessage=function(){return console.error("this method is abolished.")},o.prototype.cancelPrintMessage=function(){return console.error("this method is abolished.")},o.prototype.isBackgroundChanged=function(){return console.error("this method is abolished.")},o.prototype.getBackgroundImageName=function(){return console.error("this method is abolished.")},o.prototype.getImageName=function(t){return console.error("this method is abolished.")},o.prototype.getChara=function(t){return console.error("this method is abolished.")},o.prototype.isTalking=function(t){return console.error("this method is abolished.")},o.prototype.getOption=function(){return console.error("this method is abolished.")},o.prototype.lines=function(){return console.error("this method is abolished.")},o.prototype.getSerifRowsCount=function(){return console.error("this method is abolished.")},o.prototype.right_image=function(){return console.error("this method is abolished.")},o.prototype.left_image=function(){return console.error("this method is abolished.")},o.prototype.is_right_talking=function(){return console.error("this method is abolished.")},o.prototype.is_left_talking=function(){return console.error("this method is abolished.")},o.prototype.font_color=function(){return console.error("this method is abolished.")},o.prototype.is_end=function(){return console.error("this method is abolished.")},o.prototype.is_background_changed=function(){return console.error("this method is abolished.")},o.prototype.background_image=function(){return console.error("this method is abolished.")},t.exports=o},function(t,e,i){var o=i(4),n={create:function(){var t=new o.ARRAY_TYPE(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},clone:function(t){var e=new o.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},fromValues:function(t,e,i,n){var r=new o.ARRAY_TYPE(4);return r[0]=t,r[1]=e,r[2]=i,r[3]=n,r},set:function(t,e,i,o,n){return t[0]=e,t[1]=i,t[2]=o,t[3]=n,t},transpose:function(t,e){if(t===e){var i=e[1];t[1]=e[2],t[2]=i}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},invert:function(t,e){var i=e[0],o=e[1],n=e[2],r=e[3],s=i*r-n*o;return s?(s=1/s,t[0]=r*s,t[1]=-o*s,t[2]=-n*s,t[3]=i*s,t):null},adjoint:function(t,e){var i=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=i,t},determinant:function(t){return t[0]*t[3]-t[2]*t[1]},multiply:function(t,e,i){var o=e[0],n=e[1],r=e[2],s=e[3],a=i[0],u=i[1],h=i[2],c=i[3];return t[0]=o*a+r*u,t[1]=n*a+s*u,t[2]=o*h+r*c,t[3]=n*h+s*c,t}};n.mul=n.multiply,n.rotate=function(t,e,i){var o=e[0],n=e[1],r=e[2],s=e[3],a=Math.sin(i),u=Math.cos(i);return t[0]=o*u+r*a,t[1]=n*u+s*a,t[2]=o*-a+r*u,t[3]=n*-a+s*u,t},n.scale=function(t,e,i){var o=e[0],n=e[1],r=e[2],s=e[3],a=i[0],u=i[1];return t[0]=o*a,t[1]=n*a,t[2]=r*u,t[3]=s*u,t},n.fromRotation=function(t,e){var i=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=i,t[2]=-i,t[3]=o,t},n.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},n.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},n.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2))},n.LDU=function(t,e,i,o){return t[2]=o[2]/o[0],i[0]=o[0],i[1]=o[1],i[3]=o[3]-t[2]*i[1],[t,e,i]},n.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},n.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t},n.sub=n.subtract,n.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},n.equals=function(t,e){var i=t[0],n=t[1],r=t[2],s=t[3],a=e[0],u=e[1],h=e[2],c=e[3];return Math.abs(i-a)<=o.EPSILON*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-u)<=o.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(r-h)<=o.EPSILON*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(s-c)<=o.EPSILON*Math.max(1,Math.abs(s),Math.abs(c))},n.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},n.multiplyScalarAndAdd=function(t,e,i,o){return t[0]=e[0]+i[0]*o,t[1]=e[1]+i[1]*o,t[2]=e[2]+i[2]*o,t[3]=e[3]+i[3]*o,t},t.exports=n},function(t,e,i){var o=i(4),n={create:function(){var t=new o.ARRAY_TYPE(6);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},clone:function(t){var e=new o.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},fromValues:function(t,e,i,n,r,s){var a=new o.ARRAY_TYPE(6);return a[0]=t,a[1]=e,a[2]=i,a[3]=n,a[4]=r,a[5]=s,a},set:function(t,e,i,o,n,r,s){return t[0]=e,t[1]=i,t[2]=o,t[3]=n,t[4]=r,t[5]=s,t},invert:function(t,e){var i=e[0],o=e[1],n=e[2],r=e[3],s=e[4],a=e[5],u=i*r-o*n;return u?(u=1/u,t[0]=r*u,t[1]=-o*u,t[2]=-n*u,t[3]=i*u,t[4]=(n*a-r*s)*u,t[5]=(o*s-i*a)*u,t):null},determinant:function(t){return t[0]*t[3]-t[1]*t[2]},multiply:function(t,e,i){var o=e[0],n=e[1],r=e[2],s=e[3],a=e[4],u=e[5],h=i[0],c=i[1],l=i[2],_=i[3],p=i[4],d=i[5];return t[0]=o*h+r*c,t[1]=n*h+s*c,t[2]=o*l+r*_,t[3]=n*l+s*_,t[4]=o*p+r*d+a,t[5]=n*p+s*d+u,t}};n.mul=n.multiply,n.rotate=function(t,e,i){var o=e[0],n=e[1],r=e[2],s=e[3],a=e[4],u=e[5],h=Math.sin(i),c=Math.cos(i);return t[0]=o*c+r*h,t[1]=n*c+s*h,t[2]=o*-h+r*c,t[3]=n*-h+s*c,t[4]=a,t[5]=u,t},n.scale=function(t,e,i){var o=e[0],n=e[1],r=e[2],s=e[3],a=e[4],u=e[5],h=i[0],c=i[1];return t[0]=o*h,t[1]=n*h,t[2]=r*c,t[3]=s*c,t[4]=a,t[5]=u,t},n.translate=function(t,e,i){var o=e[0],n=e[1],r=e[2],s=e[3],a=e[4],u=e[5],h=i[0],c=i[1];return t[0]=o,t[1]=n,t[2]=r,t[3]=s,t[4]=o*h+r*c+a,t[5]=n*h+s*c+u,t},n.fromRotation=function(t,e){var i=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=i,t[2]=-i,t[3]=o,t[4]=0,t[5]=0,t},n.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},n.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},n.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},n.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+1)},n.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t},n.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t},n.sub=n.subtract,n.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t},n.multiplyScalarAndAdd=function(t,e,i,o){return t[0]=e[0]+i[0]*o,t[1]=e[1]+i[1]*o,t[2]=e[2]+i[2]*o,t[3]=e[3]+i[3]*o,t[4]=e[4]+i[4]*o,t[5]=e[5]+i[5]*o,t},n.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},n.equals=function(t,e){var i=t[0],n=t[1],r=t[2],s=t[3],a=t[4],u=t[5],h=e[0],c=e[1],l=e[2],_=e[3],p=e[4],d=e[5];return Math.abs(i-h)<=o.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(n-c)<=o.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(r-l)<=o.EPSILON*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(s-_)<=o.EPSILON*Math.max(1,Math.abs(s),Math.abs(_))&&Math.abs(a-p)<=o.EPSILON*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(u-d)<=o.EPSILON*Math.max(1,Math.abs(u),Math.abs(d))},t.exports=n},function(t,e,i){var o=i(4),n={scalar:{},SIMD:{},create:function(){var t=new o.ARRAY_TYPE(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},clone:function(t){var e=new o.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},fromValues:function(t,e,i,n,r,s,a,u,h,c,l,_,p,d,f,m){var g=new o.ARRAY_TYPE(16);return g[0]=t,g[1]=e,g[2]=i,g[3]=n,g[4]=r,g[5]=s,g[6]=a,g[7]=u,g[8]=h,g[9]=c,g[10]=l,g[11]=_,g[12]=p,g[13]=d,g[14]=f,g[15]=m,g},set:function(t,e,i,o,n,r,s,a,u,h,c,l,_,p,d,f,m){return t[0]=e,t[1]=i,t[2]=o,t[3]=n,t[4]=r,t[5]=s,t[6]=a,t[7]=u,t[8]=h,t[9]=c,t[10]=l,t[11]=_,t[12]=p,t[13]=d,t[14]=f,t[15]=m,t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}};n.scalar.transpose=function(t,e){if(t===e){var i=e[1],o=e[2],n=e[3],r=e[6],s=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=o,t[9]=r,t[11]=e[14],t[12]=n,t[13]=s,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},n.SIMD.transpose=function(t,e){var i,o,n,r,s,a,u,h,c,l;return i=SIMD.Float32x4.load(e,0),o=SIMD.Float32x4.load(e,4),n=SIMD.Float32x4.load(e,8),r=SIMD.Float32x4.load(e,12),s=SIMD.Float32x4.shuffle(i,o,0,1,4,5),a=SIMD.Float32x4.shuffle(n,r,0,1,4,5),u=SIMD.Float32x4.shuffle(s,a,0,2,4,6),h=SIMD.Float32x4.shuffle(s,a,1,3,5,7),SIMD.Float32x4.store(t,0,u),SIMD.Float32x4.store(t,4,h),s=SIMD.Float32x4.shuffle(i,o,2,3,6,7),a=SIMD.Float32x4.shuffle(n,r,2,3,6,7),c=SIMD.Float32x4.shuffle(s,a,0,2,4,6),l=SIMD.Float32x4.shuffle(s,a,1,3,5,7),SIMD.Float32x4.store(t,8,c),SIMD.Float32x4.store(t,12,l),t},n.transpose=o.USE_SIMD?n.SIMD.transpose:n.scalar.transpose,n.scalar.invert=function(t,e){var i=e[0],o=e[1],n=e[2],r=e[3],s=e[4],a=e[5],u=e[6],h=e[7],c=e[8],l=e[9],_=e[10],p=e[11],d=e[12],f=e[13],m=e[14],g=e[15],y=i*a-o*s,v=i*u-n*s,b=i*h-r*s,x=o*u-n*a,w=o*h-r*a,M=n*h-r*u,S=c*f-l*d,I=c*m-_*d,E=c*g-p*d,D=l*m-_*f,F=l*g-p*f,T=_*g-p*m,C=y*T-v*F+b*D+x*E-w*I+M*S;return C?(C=1/C,t[0]=(a*T-u*F+h*D)*C,t[1]=(n*F-o*T-r*D)*C,t[2]=(f*M-m*w+g*x)*C,t[3]=(_*w-l*M-p*x)*C,t[4]=(u*E-s*T-h*I)*C,t[5]=(i*T-n*E+r*I)*C,t[6]=(m*b-d*M-g*v)*C,t[7]=(c*M-_*b+p*v)*C,t[8]=(s*F-a*E+h*S)*C,t[9]=(o*E-i*F-r*S)*C,t[10]=(d*w-f*b+g*y)*C,t[11]=(l*b-c*w-p*y)*C,t[12]=(a*I-s*D-u*S)*C,t[13]=(i*D-o*I+n*S)*C,t[14]=(f*v-d*x-m*y)*C,t[15]=(c*x-l*v+_*y)*C,t):null},n.SIMD.invert=function(t,e){var i,o,n,r,s,a,u,h,c,l,_=SIMD.Float32x4.load(e,0),p=SIMD.Float32x4.load(e,4),d=SIMD.Float32x4.load(e,8),f=SIMD.Float32x4.load(e,12);return s=SIMD.Float32x4.shuffle(_,p,0,1,4,5),o=SIMD.Float32x4.shuffle(d,f,0,1,4,5),i=SIMD.Float32x4.shuffle(s,o,0,2,4,6),o=SIMD.Float32x4.shuffle(o,s,1,3,5,7),s=SIMD.Float32x4.shuffle(_,p,2,3,6,7),r=SIMD.Float32x4.shuffle(d,f,2,3,6,7),n=SIMD.Float32x4.shuffle(s,r,0,2,4,6),r=SIMD.Float32x4.shuffle(r,s,1,3,5,7),s=SIMD.Float32x4.mul(n,r),s=SIMD.Float32x4.swizzle(s,1,0,3,2),a=SIMD.Float32x4.mul(o,s),u=SIMD.Float32x4.mul(i,s),s=SIMD.Float32x4.swizzle(s,2,3,0,1),a=SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,s),a),u=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,s),u),u=SIMD.Float32x4.swizzle(u,2,3,0,1),s=SIMD.Float32x4.mul(o,n),s=SIMD.Float32x4.swizzle(s,1,0,3,2),a=SIMD.Float32x4.add(SIMD.Float32x4.mul(r,s),a),c=SIMD.Float32x4.mul(i,s),s=SIMD.Float32x4.swizzle(s,2,3,0,1),a=SIMD.Float32x4.sub(a,SIMD.Float32x4.mul(r,s)),c=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,s),c),c=SIMD.Float32x4.swizzle(c,2,3,0,1),s=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(o,2,3,0,1),r),s=SIMD.Float32x4.swizzle(s,1,0,3,2),n=SIMD.Float32x4.swizzle(n,2,3,0,1),a=SIMD.Float32x4.add(SIMD.Float32x4.mul(n,s),a),h=SIMD.Float32x4.mul(i,s),s=SIMD.Float32x4.swizzle(s,2,3,0,1),a=SIMD.Float32x4.sub(a,SIMD.Float32x4.mul(n,s)),h=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,s),h),h=SIMD.Float32x4.swizzle(h,2,3,0,1),s=SIMD.Float32x4.mul(i,o),s=SIMD.Float32x4.swizzle(s,1,0,3,2),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(r,s),h),c=SIMD.Float32x4.sub(SIMD.Float32x4.mul(n,s),c),s=SIMD.Float32x4.swizzle(s,2,3,0,1),h=SIMD.Float32x4.sub(SIMD.Float32x4.mul(r,s),h),c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(n,s)),s=SIMD.Float32x4.mul(i,r),s=SIMD.Float32x4.swizzle(s,1,0,3,2),u=SIMD.Float32x4.sub(u,SIMD.Float32x4.mul(n,s)),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(o,s),h),s=SIMD.Float32x4.swizzle(s,2,3,0,1),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(n,s),u),h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(o,s)),s=SIMD.Float32x4.mul(i,n),s=SIMD.Float32x4.swizzle(s,1,0,3,2),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(r,s),u),c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(o,s)),s=SIMD.Float32x4.swizzle(s,2,3,0,1),u=SIMD.Float32x4.sub(u,SIMD.Float32x4.mul(r,s)),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(o,s),c),l=SIMD.Float32x4.mul(i,a),l=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(l,2,3,0,1),l),l=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(l,1,0,3,2),l),s=SIMD.Float32x4.reciprocalApproximation(l),l=SIMD.Float32x4.sub(SIMD.Float32x4.add(s,s),SIMD.Float32x4.mul(l,SIMD.Float32x4.mul(s,s))),(l=SIMD.Float32x4.swizzle(l,0,0,0,0))?(SIMD.Float32x4.store(t,0,SIMD.Float32x4.mul(l,a)),SIMD.Float32x4.store(t,4,SIMD.Float32x4.mul(l,u)),SIMD.Float32x4.store(t,8,SIMD.Float32x4.mul(l,h)),SIMD.Float32x4.store(t,12,SIMD.Float32x4.mul(l,c)),t):null},n.invert=o.USE_SIMD?n.SIMD.invert:n.scalar.invert,n.scalar.adjoint=function(t,e){var i=e[0],o=e[1],n=e[2],r=e[3],s=e[4],a=e[5],u=e[6],h=e[7],c=e[8],l=e[9],_=e[10],p=e[11],d=e[12],f=e[13],m=e[14],g=e[15];return t[0]=a*(_*g-p*m)-l*(u*g-h*m)+f*(u*p-h*_),t[1]=-(o*(_*g-p*m)-l*(n*g-r*m)+f*(n*p-r*_)),t[2]=o*(u*g-h*m)-a*(n*g-r*m)+f*(n*h-r*u),t[3]=-(o*(u*p-h*_)-a*(n*p-r*_)+l*(n*h-r*u)),t[4]=-(s*(_*g-p*m)-c*(u*g-h*m)+d*(u*p-h*_)),t[5]=i*(_*g-p*m)-c*(n*g-r*m)+d*(n*p-r*_),t[6]=-(i*(u*g-h*m)-s*(n*g-r*m)+d*(n*h-r*u)),t[7]=i*(u*p-h*_)-s*(n*p-r*_)+c*(n*h-r*u),t[8]=s*(l*g-p*f)-c*(a*g-h*f)+d*(a*p-h*l),t[9]=-(i*(l*g-p*f)-c*(o*g-r*f)+d*(o*p-r*l)),t[10]=i*(a*g-h*f)-s*(o*g-r*f)+d*(o*h-r*a),t[11]=-(i*(a*p-h*l)-s*(o*p-r*l)+c*(o*h-r*a)),t[12]=-(s*(l*m-_*f)-c*(a*m-u*f)+d*(a*_-u*l)),t[13]=i*(l*m-_*f)-c*(o*m-n*f)+d*(o*_-n*l),t[14]=-(i*(a*m-u*f)-s*(o*m-n*f)+d*(o*u-n*a)),t[15]=i*(a*_-u*l)-s*(o*_-n*l)+c*(o*u-n*a),t},n.SIMD.adjoint=function(t,e){var i,o,n,r,s,a,u,h,c,l=SIMD.Float32x4.load(e,0),_=SIMD.Float32x4.load(e,4),p=SIMD.Float32x4.load(e,8),d=SIMD.Float32x4.load(e,12);return s=SIMD.Float32x4.shuffle(l,_,0,1,4,5),o=SIMD.Float32x4.shuffle(p,d,0,1,4,5),i=SIMD.Float32x4.shuffle(s,o,0,2,4,6),o=SIMD.Float32x4.shuffle(o,s,1,3,5,7),s=SIMD.Float32x4.shuffle(l,_,2,3,6,7),r=SIMD.Float32x4.shuffle(p,d,2,3,6,7),n=SIMD.Float32x4.shuffle(s,r,0,2,4,6),r=SIMD.Float32x4.shuffle(r,s,1,3,5,7),s=SIMD.Float32x4.mul(n,r),s=SIMD.Float32x4.swizzle(s,1,0,3,2),a=SIMD.Float32x4.mul(o,s),u=SIMD.Float32x4.mul(i,s),s=SIMD.Float32x4.swizzle(s,2,3,0,1),a=SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,s),a),u=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,s),u),u=SIMD.Float32x4.swizzle(u,2,3,0,1),s=SIMD.Float32x4.mul(o,n),s=SIMD.Float32x4.swizzle(s,1,0,3,2),a=SIMD.Float32x4.add(SIMD.Float32x4.mul(r,s),a),c=SIMD.Float32x4.mul(i,s),s=SIMD.Float32x4.swizzle(s,2,3,0,1),a=SIMD.Float32x4.sub(a,SIMD.Float32x4.mul(r,s)),c=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,s),c),c=SIMD.Float32x4.swizzle(c,2,3,0,1),s=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(o,2,3,0,1),r),s=SIMD.Float32x4.swizzle(s,1,0,3,2),n=SIMD.Float32x4.swizzle(n,2,3,0,1),a=SIMD.Float32x4.add(SIMD.Float32x4.mul(n,s),a),h=SIMD.Float32x4.mul(i,s),s=SIMD.Float32x4.swizzle(s,2,3,0,1),a=SIMD.Float32x4.sub(a,SIMD.Float32x4.mul(n,s)),h=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,s),h),h=SIMD.Float32x4.swizzle(h,2,3,0,1),s=SIMD.Float32x4.mul(i,o),s=SIMD.Float32x4.swizzle(s,1,0,3,2),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(r,s),h),c=SIMD.Float32x4.sub(SIMD.Float32x4.mul(n,s),c),s=SIMD.Float32x4.swizzle(s,2,3,0,1),h=SIMD.Float32x4.sub(SIMD.Float32x4.mul(r,s),h),c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(n,s)),s=SIMD.Float32x4.mul(i,r),s=SIMD.Float32x4.swizzle(s,1,0,3,2),u=SIMD.Float32x4.sub(u,SIMD.Float32x4.mul(n,s)),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(o,s),h),s=SIMD.Float32x4.swizzle(s,2,3,0,1),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(n,s),u),h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(o,s)),s=SIMD.Float32x4.mul(i,n),s=SIMD.Float32x4.swizzle(s,1,0,3,2),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(r,s),u),c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(o,s)),s=SIMD.Float32x4.swizzle(s,2,3,0,1),u=SIMD.Float32x4.sub(u,SIMD.Float32x4.mul(r,s)),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(o,s),c),SIMD.Float32x4.store(t,0,a),SIMD.Float32x4.store(t,4,u),SIMD.Float32x4.store(t,8,h),SIMD.Float32x4.store(t,12,c),t},n.adjoint=o.USE_SIMD?n.SIMD.adjoint:n.scalar.adjoint,n.determinant=function(t){var e=t[0],i=t[1],o=t[2],n=t[3],r=t[4],s=t[5],a=t[6],u=t[7],h=t[8],c=t[9],l=t[10],_=t[11],p=t[12],d=t[13],f=t[14],m=t[15];return(e*s-i*r)*(l*m-_*f)-(e*a-o*r)*(c*m-_*d)+(e*u-n*r)*(c*f-l*d)+(i*a-o*s)*(h*m-_*p)-(i*u-n*s)*(h*f-l*p)+(o*u-n*a)*(h*d-c*p)},n.SIMD.multiply=function(t,e,i){var o=SIMD.Float32x4.load(e,0),n=SIMD.Float32x4.load(e,4),r=SIMD.Float32x4.load(e,8),s=SIMD.Float32x4.load(e,12),a=SIMD.Float32x4.load(i,0),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(a,0,0,0,0),o),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(a,1,1,1,1),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(a,2,2,2,2),r),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(a,3,3,3,3),s))));SIMD.Float32x4.store(t,0,u);var h=SIMD.Float32x4.load(i,4),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,0,0,0,0),o),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,1,1,1,1),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,2,2,2,2),r),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,3,3,3,3),s))));SIMD.Float32x4.store(t,4,c);var l=SIMD.Float32x4.load(i,8),_=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,0,0,0,0),o),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,1,1,1,1),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,2,2,2,2),r),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,3,3,3,3),s))));SIMD.Float32x4.store(t,8,_);var p=SIMD.Float32x4.load(i,12),d=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(p,0,0,0,0),o),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(p,1,1,1,1),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(p,2,2,2,2),r),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(p,3,3,3,3),s))));return SIMD.Float32x4.store(t,12,d),t},n.scalar.multiply=function(t,e,i){var o=e[0],n=e[1],r=e[2],s=e[3],a=e[4],u=e[5],h=e[6],c=e[7],l=e[8],_=e[9],p=e[10],d=e[11],f=e[12],m=e[13],g=e[14],y=e[15],v=i[0],b=i[1],x=i[2],w=i[3];return t[0]=v*o+b*a+x*l+w*f,t[1]=v*n+b*u+x*_+w*m,t[2]=v*r+b*h+x*p+w*g,t[3]=v*s+b*c+x*d+w*y,v=i[4],b=i[5],x=i[6],w=i[7],t[4]=v*o+b*a+x*l+w*f,t[5]=v*n+b*u+x*_+w*m,t[6]=v*r+b*h+x*p+w*g,t[7]=v*s+b*c+x*d+w*y,v=i[8],b=i[9],x=i[10],w=i[11],t[8]=v*o+b*a+x*l+w*f,t[9]=v*n+b*u+x*_+w*m,t[10]=v*r+b*h+x*p+w*g,t[11]=v*s+b*c+x*d+w*y,v=i[12],b=i[13],x=i[14],w=i[15],t[12]=v*o+b*a+x*l+w*f,t[13]=v*n+b*u+x*_+w*m,t[14]=v*r+b*h+x*p+w*g,t[15]=v*s+b*c+x*d+w*y,t},n.multiply=o.USE_SIMD?n.SIMD.multiply:n.scalar.multiply,n.mul=n.multiply,n.scalar.translate=function(t,e,i){var o,n,r,s,a,u,h,c,l,_,p,d,f=i[0],m=i[1],g=i[2];return e===t?(t[12]=e[0]*f+e[4]*m+e[8]*g+e[12],t[13]=e[1]*f+e[5]*m+e[9]*g+e[13],t[14]=e[2]*f+e[6]*m+e[10]*g+e[14],t[15]=e[3]*f+e[7]*m+e[11]*g+e[15]):(o=e[0],n=e[1],r=e[2],s=e[3],a=e[4],u=e[5],h=e[6],c=e[7],l=e[8],_=e[9],p=e[10],d=e[11],t[0]=o,t[1]=n,t[2]=r,t[3]=s,t[4]=a,t[5]=u,t[6]=h,t[7]=c,t[8]=l,t[9]=_,t[10]=p,t[11]=d,t[12]=o*f+a*m+l*g+e[12],t[13]=n*f+u*m+_*g+e[13],t[14]=r*f+h*m+p*g+e[14],t[15]=s*f+c*m+d*g+e[15]),t},n.SIMD.translate=function(t,e,i){var o=SIMD.Float32x4.load(e,0),n=SIMD.Float32x4.load(e,4),r=SIMD.Float32x4.load(e,8),s=SIMD.Float32x4.load(e,12),a=SIMD.Float32x4(i[0],i[1],i[2],0);e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11]),o=SIMD.Float32x4.mul(o,SIMD.Float32x4.swizzle(a,0,0,0,0)),n=SIMD.Float32x4.mul(n,SIMD.Float32x4.swizzle(a,1,1,1,1)),r=SIMD.Float32x4.mul(r,SIMD.Float32x4.swizzle(a,2,2,2,2));var u=SIMD.Float32x4.add(o,SIMD.Float32x4.add(n,SIMD.Float32x4.add(r,s)));return SIMD.Float32x4.store(t,12,u),t},n.translate=o.USE_SIMD?n.SIMD.translate:n.scalar.translate,n.scalar.scale=function(t,e,i){var o=i[0],n=i[1],r=i[2];return t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t[3]=e[3]*o,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},n.SIMD.scale=function(t,e,i){var o,n,r,s=SIMD.Float32x4(i[0],i[1],i[2],0);return o=SIMD.Float32x4.load(e,0),SIMD.Float32x4.store(t,0,SIMD.Float32x4.mul(o,SIMD.Float32x4.swizzle(s,0,0,0,0))),n=SIMD.Float32x4.load(e,4),SIMD.Float32x4.store(t,4,SIMD.Float32x4.mul(n,SIMD.Float32x4.swizzle(s,1,1,1,1))),r=SIMD.Float32x4.load(e,8),SIMD.Float32x4.store(t,8,SIMD.Float32x4.mul(r,SIMD.Float32x4.swizzle(s,2,2,2,2))),t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},n.scale=o.USE_SIMD?n.SIMD.scale:n.scalar.scale,n.rotate=function(t,e,i,n){var r,s,a,u,h,c,l,_,p,d,f,m,g,y,v,b,x,w,M,S,I,E,D,F,T=n[0],C=n[1],R=n[2],A=Math.sqrt(T*T+C*C+R*R);return Math.abs(A)<o.EPSILON?null:(T*=A=1/A,C*=A,R*=A,r=Math.sin(i),a=1-(s=Math.cos(i)),u=e[0],h=e[1],c=e[2],l=e[3],_=e[4],p=e[5],d=e[6],f=e[7],m=e[8],g=e[9],y=e[10],v=e[11],b=T*T*a+s,x=C*T*a+R*r,w=R*T*a-C*r,M=T*C*a-R*r,S=C*C*a+s,I=R*C*a+T*r,E=T*R*a+C*r,D=C*R*a-T*r,F=R*R*a+s,t[0]=u*b+_*x+m*w,t[1]=h*b+p*x+g*w,t[2]=c*b+d*x+y*w,t[3]=l*b+f*x+v*w,t[4]=u*M+_*S+m*I,t[5]=h*M+p*S+g*I,t[6]=c*M+d*S+y*I,t[7]=l*M+f*S+v*I,t[8]=u*E+_*D+m*F,t[9]=h*E+p*D+g*F,t[10]=c*E+d*D+y*F,t[11]=l*E+f*D+v*F,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},n.scalar.rotateX=function(t,e,i){var o=Math.sin(i),n=Math.cos(i),r=e[4],s=e[5],a=e[6],u=e[7],h=e[8],c=e[9],l=e[10],_=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=r*n+h*o,t[5]=s*n+c*o,t[6]=a*n+l*o,t[7]=u*n+_*o,t[8]=h*n-r*o,t[9]=c*n-s*o,t[10]=l*n-a*o,t[11]=_*n-u*o,t},n.SIMD.rotateX=function(t,e,i){var o=SIMD.Float32x4.splat(Math.sin(i)),n=SIMD.Float32x4.splat(Math.cos(i));e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var r=SIMD.Float32x4.load(e,4),s=SIMD.Float32x4.load(e,8);return SIMD.Float32x4.store(t,4,SIMD.Float32x4.add(SIMD.Float32x4.mul(r,n),SIMD.Float32x4.mul(s,o))),SIMD.Float32x4.store(t,8,SIMD.Float32x4.sub(SIMD.Float32x4.mul(s,n),SIMD.Float32x4.mul(r,o))),t},n.rotateX=o.USE_SIMD?n.SIMD.rotateX:n.scalar.rotateX,n.scalar.rotateY=function(t,e,i){var o=Math.sin(i),n=Math.cos(i),r=e[0],s=e[1],a=e[2],u=e[3],h=e[8],c=e[9],l=e[10],_=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=r*n-h*o,t[1]=s*n-c*o,t[2]=a*n-l*o,t[3]=u*n-_*o,t[8]=r*o+h*n,t[9]=s*o+c*n,t[10]=a*o+l*n,t[11]=u*o+_*n,t},n.SIMD.rotateY=function(t,e,i){var o=SIMD.Float32x4.splat(Math.sin(i)),n=SIMD.Float32x4.splat(Math.cos(i));e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var r=SIMD.Float32x4.load(e,0),s=SIMD.Float32x4.load(e,8);return SIMD.Float32x4.store(t,0,SIMD.Float32x4.sub(SIMD.Float32x4.mul(r,n),SIMD.Float32x4.mul(s,o))),SIMD.Float32x4.store(t,8,SIMD.Float32x4.add(SIMD.Float32x4.mul(r,o),SIMD.Float32x4.mul(s,n))),t},n.rotateY=o.USE_SIMD?n.SIMD.rotateY:n.scalar.rotateY,n.scalar.rotateZ=function(t,e,i){var o=Math.sin(i),n=Math.cos(i),r=e[0],s=e[1],a=e[2],u=e[3],h=e[4],c=e[5],l=e[6],_=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=r*n+h*o,t[1]=s*n+c*o,t[2]=a*n+l*o,t[3]=u*n+_*o,t[4]=h*n-r*o,t[5]=c*n-s*o,t[6]=l*n-a*o,t[7]=_*n-u*o,t},n.SIMD.rotateZ=function(t,e,i){var o=SIMD.Float32x4.splat(Math.sin(i)),n=SIMD.Float32x4.splat(Math.cos(i));e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var r=SIMD.Float32x4.load(e,0),s=SIMD.Float32x4.load(e,4);return SIMD.Float32x4.store(t,0,SIMD.Float32x4.add(SIMD.Float32x4.mul(r,n),SIMD.Float32x4.mul(s,o))),SIMD.Float32x4.store(t,4,SIMD.Float32x4.sub(SIMD.Float32x4.mul(s,n),SIMD.Float32x4.mul(r,o))),t},n.rotateZ=o.USE_SIMD?n.SIMD.rotateZ:n.scalar.rotateZ,n.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},n.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},n.fromRotation=function(t,e,i){var n,r,s,a=i[0],u=i[1],h=i[2],c=Math.sqrt(a*a+u*u+h*h);return Math.abs(c)<o.EPSILON?null:(a*=c=1/c,u*=c,h*=c,n=Math.sin(e),s=1-(r=Math.cos(e)),t[0]=a*a*s+r,t[1]=u*a*s+h*n,t[2]=h*a*s-u*n,t[3]=0,t[4]=a*u*s-h*n,t[5]=u*u*s+r,t[6]=h*u*s+a*n,t[7]=0,t[8]=a*h*s+u*n,t[9]=u*h*s-a*n,t[10]=h*h*s+r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},n.fromXRotation=function(t,e){var i=Math.sin(e),o=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=i,t[7]=0,t[8]=0,t[9]=-i,t[10]=o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},n.fromYRotation=function(t,e){var i=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=0,t[2]=-i,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=i,t[9]=0,t[10]=o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},n.fromZRotation=function(t,e){var i=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=i,t[2]=0,t[3]=0,t[4]=-i,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},n.fromRotationTranslation=function(t,e,i){var o=e[0],n=e[1],r=e[2],s=e[3],a=o+o,u=n+n,h=r+r,c=o*a,l=o*u,_=o*h,p=n*u,d=n*h,f=r*h,m=s*a,g=s*u,y=s*h;return t[0]=1-(p+f),t[1]=l+y,t[2]=_-g,t[3]=0,t[4]=l-y,t[5]=1-(c+f),t[6]=d+m,t[7]=0,t[8]=_+g,t[9]=d-m,t[10]=1-(c+p),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t},n.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},n.getRotation=function(t,e){var i=e[0]+e[5]+e[10],o=0;return i>0?(o=2*Math.sqrt(i+1),t[3]=.25*o,t[0]=(e[6]-e[9])/o,t[1]=(e[8]-e[2])/o,t[2]=(e[1]-e[4])/o):e[0]>e[5]&e[0]>e[10]?(o=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/o,t[0]=.25*o,t[1]=(e[1]+e[4])/o,t[2]=(e[8]+e[2])/o):e[5]>e[10]?(o=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/o,t[0]=(e[1]+e[4])/o,t[1]=.25*o,t[2]=(e[6]+e[9])/o):(o=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/o,t[0]=(e[8]+e[2])/o,t[1]=(e[6]+e[9])/o,t[2]=.25*o),t},n.fromRotationTranslationScale=function(t,e,i,o){var n=e[0],r=e[1],s=e[2],a=e[3],u=n+n,h=r+r,c=s+s,l=n*u,_=n*h,p=n*c,d=r*h,f=r*c,m=s*c,g=a*u,y=a*h,v=a*c,b=o[0],x=o[1],w=o[2];return t[0]=(1-(d+m))*b,t[1]=(_+v)*b,t[2]=(p-y)*b,t[3]=0,t[4]=(_-v)*x,t[5]=(1-(l+m))*x,t[6]=(f+g)*x,t[7]=0,t[8]=(p+y)*w,t[9]=(f-g)*w,t[10]=(1-(l+d))*w,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t},n.fromRotationTranslationScaleOrigin=function(t,e,i,o,n){var r=e[0],s=e[1],a=e[2],u=e[3],h=r+r,c=s+s,l=a+a,_=r*h,p=r*c,d=r*l,f=s*c,m=s*l,g=a*l,y=u*h,v=u*c,b=u*l,x=o[0],w=o[1],M=o[2],S=n[0],I=n[1],E=n[2];return t[0]=(1-(f+g))*x,t[1]=(p+b)*x,t[2]=(d-v)*x,t[3]=0,t[4]=(p-b)*w,t[5]=(1-(_+g))*w,t[6]=(m+y)*w,t[7]=0,t[8]=(d+v)*M,t[9]=(m-y)*M,t[10]=(1-(_+f))*M,t[11]=0,t[12]=i[0]+S-(t[0]*S+t[4]*I+t[8]*E),t[13]=i[1]+I-(t[1]*S+t[5]*I+t[9]*E),t[14]=i[2]+E-(t[2]*S+t[6]*I+t[10]*E),t[15]=1,t},n.fromQuat=function(t,e){var i=e[0],o=e[1],n=e[2],r=e[3],s=i+i,a=o+o,u=n+n,h=i*s,c=o*s,l=o*a,_=n*s,p=n*a,d=n*u,f=r*s,m=r*a,g=r*u;return t[0]=1-l-d,t[1]=c+g,t[2]=_-m,t[3]=0,t[4]=c-g,t[5]=1-h-d,t[6]=p+f,t[7]=0,t[8]=_+m,t[9]=p-f,t[10]=1-h-l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},n.frustum=function(t,e,i,o,n,r,s){var a=1/(i-e),u=1/(n-o),h=1/(r-s);return t[0]=2*r*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*r*u,t[6]=0,t[7]=0,t[8]=(i+e)*a,t[9]=(n+o)*u,t[10]=(s+r)*h,t[11]=-1,t[12]=0,t[13]=0,t[14]=s*r*2*h,t[15]=0,t},n.perspective=function(t,e,i,o,n){var r=1/Math.tan(e/2),s=1/(o-n);return t[0]=r/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(n+o)*s,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*n*o*s,t[15]=0,t},n.perspectiveFromFieldOfView=function(t,e,i,o){var n=Math.tan(e.upDegrees*Math.PI/180),r=Math.tan(e.downDegrees*Math.PI/180),s=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),u=2/(s+a),h=2/(n+r);return t[0]=u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=h,t[6]=0,t[7]=0,t[8]=-(s-a)*u*.5,t[9]=(n-r)*h*.5,t[10]=o/(i-o),t[11]=-1,t[12]=0,t[13]=0,t[14]=o*i/(i-o),t[15]=0,t},n.ortho=function(t,e,i,o,n,r,s){var a=1/(e-i),u=1/(o-n),h=1/(r-s);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*h,t[11]=0,t[12]=(e+i)*a,t[13]=(n+o)*u,t[14]=(s+r)*h,t[15]=1,t},n.lookAt=function(t,e,i,r){var s,a,u,h,c,l,_,p,d,f,m=e[0],g=e[1],y=e[2],v=r[0],b=r[1],x=r[2],w=i[0],M=i[1],S=i[2];return Math.abs(m-w)<o.EPSILON&&Math.abs(g-M)<o.EPSILON&&Math.abs(y-S)<o.EPSILON?n.identity(t):(_=m-w,p=g-M,d=y-S,s=b*(d*=f=1/Math.sqrt(_*_+p*p+d*d))-x*(p*=f),a=x*(_*=f)-v*d,u=v*p-b*_,(f=Math.sqrt(s*s+a*a+u*u))?(s*=f=1/f,a*=f,u*=f):(s=0,a=0,u=0),h=p*u-d*a,c=d*s-_*u,l=_*a-p*s,(f=Math.sqrt(h*h+c*c+l*l))?(h*=f=1/f,c*=f,l*=f):(h=0,c=0,l=0),t[0]=s,t[1]=h,t[2]=_,t[3]=0,t[4]=a,t[5]=c,t[6]=p,t[7]=0,t[8]=u,t[9]=l,t[10]=d,t[11]=0,t[12]=-(s*m+a*g+u*y),t[13]=-(h*m+c*g+l*y),t[14]=-(_*m+p*g+d*y),t[15]=1,t)},n.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},n.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))},n.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t[9]=e[9]+i[9],t[10]=e[10]+i[10],t[11]=e[11]+i[11],t[12]=e[12]+i[12],t[13]=e[13]+i[13],t[14]=e[14]+i[14],t[15]=e[15]+i[15],t},n.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t[9]=e[9]-i[9],t[10]=e[10]-i[10],t[11]=e[11]-i[11],t[12]=e[12]-i[12],t[13]=e[13]-i[13],t[14]=e[14]-i[14],t[15]=e[15]-i[15],t},n.sub=n.subtract,n.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12]*i,t[13]=e[13]*i,t[14]=e[14]*i,t[15]=e[15]*i,t},n.multiplyScalarAndAdd=function(t,e,i,o){return t[0]=e[0]+i[0]*o,t[1]=e[1]+i[1]*o,t[2]=e[2]+i[2]*o,t[3]=e[3]+i[3]*o,t[4]=e[4]+i[4]*o,t[5]=e[5]+i[5]*o,t[6]=e[6]+i[6]*o,t[7]=e[7]+i[7]*o,t[8]=e[8]+i[8]*o,t[9]=e[9]+i[9]*o,t[10]=e[10]+i[10]*o,t[11]=e[11]+i[11]*o,t[12]=e[12]+i[12]*o,t[13]=e[13]+i[13]*o,t[14]=e[14]+i[14]*o,t[15]=e[15]+i[15]*o,t},n.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},n.equals=function(t,e){var i=t[0],n=t[1],r=t[2],s=t[3],a=t[4],u=t[5],h=t[6],c=t[7],l=t[8],_=t[9],p=t[10],d=t[11],f=t[12],m=t[13],g=t[14],y=t[15],v=e[0],b=e[1],x=e[2],w=e[3],M=e[4],S=e[5],I=e[6],E=e[7],D=e[8],F=e[9],T=e[10],C=e[11],R=e[12],A=e[13],O=e[14],P=e[15];return Math.abs(i-v)<=o.EPSILON*Math.max(1,Math.abs(i),Math.abs(v))&&Math.abs(n-b)<=o.EPSILON*Math.max(1,Math.abs(n),Math.abs(b))&&Math.abs(r-x)<=o.EPSILON*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(s-w)<=o.EPSILON*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(a-M)<=o.EPSILON*Math.max(1,Math.abs(a),Math.abs(M))&&Math.abs(u-S)<=o.EPSILON*Math.max(1,Math.abs(u),Math.abs(S))&&Math.abs(h-I)<=o.EPSILON*Math.max(1,Math.abs(h),Math.abs(I))&&Math.abs(c-E)<=o.EPSILON*Math.max(1,Math.abs(c),Math.abs(E))&&Math.abs(l-D)<=o.EPSILON*Math.max(1,Math.abs(l),Math.abs(D))&&Math.abs(_-F)<=o.EPSILON*Math.max(1,Math.abs(_),Math.abs(F))&&Math.abs(p-T)<=o.EPSILON*Math.max(1,Math.abs(p),Math.abs(T))&&Math.abs(d-C)<=o.EPSILON*Math.max(1,Math.abs(d),Math.abs(C))&&Math.abs(f-R)<=o.EPSILON*Math.max(1,Math.abs(f),Math.abs(R))&&Math.abs(m-A)<=o.EPSILON*Math.max(1,Math.abs(m),Math.abs(A))&&Math.abs(g-O)<=o.EPSILON*Math.max(1,Math.abs(g),Math.abs(O))&&Math.abs(y-P)<=o.EPSILON*Math.max(1,Math.abs(y),Math.abs(P))},t.exports=n},function(t,e,i){var o=i(4),n=i(30),r=i(31),s=i(32),a={create:function(){var t=new o.ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}};a.rotationTo=function(){var t=r.create(),e=r.fromValues(1,0,0),i=r.fromValues(0,1,0);return function(o,n,s){var u=r.dot(n,s);return u<-.999999?(r.cross(t,e,n),r.length(t)<1e-6&&r.cross(t,i,n),r.normalize(t,t),a.setAxisAngle(o,t,Math.PI),o):u>.999999?(o[0]=0,o[1]=0,o[2]=0,o[3]=1,o):(r.cross(t,n,s),o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=1+u,a.normalize(o,o))}}(),a.setAxes=function(){var t=n.create();return function(e,i,o,n){return t[0]=o[0],t[3]=o[1],t[6]=o[2],t[1]=n[0],t[4]=n[1],t[7]=n[2],t[2]=-i[0],t[5]=-i[1],t[8]=-i[2],a.normalize(e,a.fromMat3(e,t))}}(),a.clone=s.clone,a.fromValues=s.fromValues,a.copy=s.copy,a.set=s.set,a.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},a.setAxisAngle=function(t,e,i){i*=.5;var o=Math.sin(i);return t[0]=o*e[0],t[1]=o*e[1],t[2]=o*e[2],t[3]=Math.cos(i),t},a.getAxisAngle=function(t,e){var i=2*Math.acos(e[3]),o=Math.sin(i/2);return 0!=o?(t[0]=e[0]/o,t[1]=e[1]/o,t[2]=e[2]/o):(t[0]=1,t[1]=0,t[2]=0),i},a.add=s.add,a.multiply=function(t,e,i){var o=e[0],n=e[1],r=e[2],s=e[3],a=i[0],u=i[1],h=i[2],c=i[3];return t[0]=o*c+s*a+n*h-r*u,t[1]=n*c+s*u+r*a-o*h,t[2]=r*c+s*h+o*u-n*a,t[3]=s*c-o*a-n*u-r*h,t},a.mul=a.multiply,a.scale=s.scale,a.rotateX=function(t,e,i){i*=.5;var o=e[0],n=e[1],r=e[2],s=e[3],a=Math.sin(i),u=Math.cos(i);return t[0]=o*u+s*a,t[1]=n*u+r*a,t[2]=r*u-n*a,t[3]=s*u-o*a,t},a.rotateY=function(t,e,i){i*=.5;var o=e[0],n=e[1],r=e[2],s=e[3],a=Math.sin(i),u=Math.cos(i);return t[0]=o*u-r*a,t[1]=n*u+s*a,t[2]=r*u+o*a,t[3]=s*u-n*a,t},a.rotateZ=function(t,e,i){i*=.5;var o=e[0],n=e[1],r=e[2],s=e[3],a=Math.sin(i),u=Math.cos(i);return t[0]=o*u+n*a,t[1]=n*u-o*a,t[2]=r*u+s*a,t[3]=s*u-r*a,t},a.calculateW=function(t,e){var i=e[0],o=e[1],n=e[2];return t[0]=i,t[1]=o,t[2]=n,t[3]=Math.sqrt(Math.abs(1-i*i-o*o-n*n)),t},a.dot=s.dot,a.lerp=s.lerp,a.slerp=function(t,e,i,o){var n,r,s,a,u,h=e[0],c=e[1],l=e[2],_=e[3],p=i[0],d=i[1],f=i[2],m=i[3];return(r=h*p+c*d+l*f+_*m)<0&&(r=-r,p=-p,d=-d,f=-f,m=-m),1-r>1e-6?(n=Math.acos(r),s=Math.sin(n),a=Math.sin((1-o)*n)/s,u=Math.sin(o*n)/s):(a=1-o,u=o),t[0]=a*h+u*p,t[1]=a*c+u*d,t[2]=a*l+u*f,t[3]=a*_+u*m,t},a.sqlerp=function(){var t=a.create(),e=a.create();return function(i,o,n,r,s,u){return a.slerp(t,o,s,u),a.slerp(e,n,r,u),a.slerp(i,t,e,2*u*(1-u)),i}}(),a.invert=function(t,e){var i=e[0],o=e[1],n=e[2],r=e[3],s=i*i+o*o+n*n+r*r,a=s?1/s:0;return t[0]=-i*a,t[1]=-o*a,t[2]=-n*a,t[3]=r*a,t},a.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},a.length=s.length,a.len=a.length,a.squaredLength=s.squaredLength,a.sqrLen=a.squaredLength,a.normalize=s.normalize,a.fromMat3=function(t,e){var i,o=e[0]+e[4]+e[8];if(o>0)i=Math.sqrt(o+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{var n=0;e[4]>e[0]&&(n=1),e[8]>e[3*n+n]&&(n=2);var r=(n+1)%3,s=(n+2)%3;i=Math.sqrt(e[3*n+n]-e[3*r+r]-e[3*s+s]+1),t[n]=.5*i,i=.5/i,t[3]=(e[3*r+s]-e[3*s+r])*i,t[r]=(e[3*r+n]+e[3*n+r])*i,t[s]=(e[3*s+n]+e[3*n+s])*i}return t},a.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},a.exactEquals=s.exactEquals,a.equals=s.equals,t.exports=a},function(t,e,i){var o=i(4),n={create:function(){var t=new o.ARRAY_TYPE(2);return t[0]=0,t[1]=0,t},clone:function(t){var e=new o.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},fromValues:function(t,e){var i=new o.ARRAY_TYPE(2);return i[0]=t,i[1]=e,i},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t},set:function(t,e,i){return t[0]=e,t[1]=i,t},add:function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},subtract:function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}};n.sub=n.subtract,n.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t},n.mul=n.multiply,n.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t},n.div=n.divide,n.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},n.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},n.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t},n.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t},n.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},n.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},n.scaleAndAdd=function(t,e,i,o){return t[0]=e[0]+i[0]*o,t[1]=e[1]+i[1]*o,t},n.distance=function(t,e){var i=e[0]-t[0],o=e[1]-t[1];return Math.sqrt(i*i+o*o)},n.dist=n.distance,n.squaredDistance=function(t,e){var i=e[0]-t[0],o=e[1]-t[1];return i*i+o*o},n.sqrDist=n.squaredDistance,n.length=function(t){var e=t[0],i=t[1];return Math.sqrt(e*e+i*i)},n.len=n.length,n.squaredLength=function(t){var e=t[0],i=t[1];return e*e+i*i},n.sqrLen=n.squaredLength,n.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},n.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},n.normalize=function(t,e){var i=e[0],o=e[1],n=i*i+o*o;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n),t},n.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},n.cross=function(t,e,i){var o=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=o,t},n.lerp=function(t,e,i,o){var n=e[0],r=e[1];return t[0]=n+o*(i[0]-n),t[1]=r+o*(i[1]-r),t},n.random=function(t,e){e=e||1;var i=2*o.RANDOM()*Math.PI;return t[0]=Math.cos(i)*e,t[1]=Math.sin(i)*e,t},n.transformMat2=function(t,e,i){var o=e[0],n=e[1];return t[0]=i[0]*o+i[2]*n,t[1]=i[1]*o+i[3]*n,t},n.transformMat2d=function(t,e,i){var o=e[0],n=e[1];return t[0]=i[0]*o+i[2]*n+i[4],t[1]=i[1]*o+i[3]*n+i[5],t},n.transformMat3=function(t,e,i){var o=e[0],n=e[1];return t[0]=i[0]*o+i[3]*n+i[6],t[1]=i[1]*o+i[4]*n+i[7],t},n.transformMat4=function(t,e,i){var o=e[0],n=e[1];return t[0]=i[0]*o+i[4]*n+i[12],t[1]=i[1]*o+i[5]*n+i[13],t},n.forEach=function(){var t=n.create();return function(e,i,o,n,r,s){var a,u;for(i||(i=2),o||(o=0),u=n?Math.min(n*i+o,e.length):e.length,a=o;a<u;a+=i)t[0]=e[a],t[1]=e[a+1],r(t,t,s),e[a]=t[0],e[a+1]=t[1];return e}}(),n.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},n.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},n.equals=function(t,e){var i=t[0],n=t[1],r=e[0],s=e[1];return Math.abs(i-r)<=o.EPSILON*Math.max(1,Math.abs(i),Math.abs(r))&&Math.abs(n-s)<=o.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))},t.exports=n},function(t,e,i){"use strict";var o=function(){this._mode=this.ERROR,this._generateFunction()};o.prototype.DEBUG=0,o.prototype.INFO=1,o.prototype.WARN=2,o.prototype.ERROR=3;var n={};n[o.prototype.DEBUG]={name:"debug",logger:function(){console.log.apply(console,arguments)}},n[o.prototype.INFO]={name:"info",logger:function(){console.info.apply(console,arguments)}},n[o.prototype.WARN]={name:"warn",logger:function(){console.warn.apply(console,arguments)}},n[o.prototype.ERROR]={name:"error",logger:function(){console.error.apply(console,arguments)}},o.prototype.setMode=function(t){this._mode=t,this._generateFunction()},o.prototype.mode=function(){return this._mode},o.prototype._generateFunction=function(){for(var t in n){var e=n[t],i=e.name,o=e.logger;this.mode()<=t?this[i]=o:this[i]=function(){}}},t.exports=new o},function(t,e,i){"use strict";var o=i(7),n=i(1),r=function(t,e){o.apply(this,arguments),e=e||{},this._default_property=n.assign(this._default_property,{text:e.text||"",textColor:e.textColor||"black",textSize:e.textSize||"24px",textAlign:e.textAlign||"left"})};n.inherit(r,o),n.defineProperty(r,"text"),n.defineProperty(r,"textColor"),n.defineProperty(r,"textSize"),n.defineProperty(r,"textAlign"),r.prototype.init=function(){o.prototype.init.apply(this,arguments),this.text(this._default_property.text),this.textColor(this._default_property.textColor),this.textSize(this._default_property.textSize),this.textAlign(this._default_property.textAlign)},r.prototype.beforeDraw=function(){o.prototype.beforeDraw.apply(this,arguments)},r.prototype.draw=function(){if(this.isShow()){var t=this.core.ctx;t.save(),t.fillStyle=this.textColor(),t.textAlign=this.textAlign(),t.font=this.textSize()+" 'sans-serif'",t.fillText(this.text(),this.x(),this.y()),t.restore(),o.prototype.draw.apply(this,arguments)}},t.exports=r},function(t,e,i){"use strict";var o=i(7),n=i(1),r=function(t,e){o.apply(this,arguments),e=e||{},this._default_property=n.assign(this._default_property,{size:e.size||"",color:e.color||"black"})};n.inherit(r,o),n.defineProperty(r,"size"),n.defineProperty(r,"color"),r.prototype.init=function(){o.prototype.init.apply(this,arguments),this.size(this._default_property.size),this.color(this._default_property.color),this._start=new Date},r.prototype.beforeDraw=function(){o.prototype.beforeDraw.apply(this,arguments)},r.prototype.draw=function(){if(this.isShow()){var t=this.core.ctx,e=Math.floor(this.frame_count/60*16)/16;t.save(),t.translate(this.x(),this.y()),t.rotate(2*Math.PI*e);for(var i=0;i<16;i++)t.beginPath(),t.rotate(2*Math.PI/16),t.moveTo(this.size()/10,0),t.lineTo(this.size()/4,0),t.lineWidth=this.size()/30,t.globalAlpha=i/16,t.strokeStyle=this.color(),t.stroke();t.restore(),o.prototype.draw.apply(this,arguments)}},r.prototype.width=function(){return this.size()/2},r.prototype.height=function(){return this.size()/2},t.exports=r},function(t,e,i){"use strict";var o=i(7),n=i(1),r=function(t,e){o.apply(this,arguments),e=e||{},this._default_property=n.assign(this._default_property,{width:e.width||0,height:e.height||0,backgroundColor:e.backgroundColor||null,alpha:e.alpha||1})};n.inherit(r,o),n.defineProperty(r,"width"),n.defineProperty(r,"height"),n.defineProperty(r,"backgroundColor"),n.defineProperty(r,"alpha"),r.prototype.init=function(){o.prototype.init.apply(this,arguments),this.width(this._default_property.width),this.height(this._default_property.height),this.backgroundColor(this._default_property.backgroundColor),this.alpha(this._default_property.alpha)},r.prototype.beforeDraw=function(){o.prototype.beforeDraw.apply(this,arguments)},r.prototype.draw=function(){if(this.isShow()){var t=this.core.ctx;this.backgroundColor()&&(t.save(),t.translate(this.x(),this.y()),t.fillStyle=this.backgroundColor(),t.globalAlpha=this.alpha(),t.fillRect(-this.width()/2,-this.height()/2,this.width(),this.height()),t.restore()),o.prototype.draw.apply(this,arguments)}},t.exports=r},function(t,e,i){"use strict";var o=i(7),n=i(1),r=function(t,e){o.apply(this,arguments),e=e||{},this._default_property=n.assign(this._default_property,{image_name:e.image_name||null,scale:e.scale||1,width:e.width||null,height:e.height||null})};n.inherit(r,o),n.defineProperty(r,"image_name"),n.defineProperty(r,"scale"),n.defineProperty(r,"width"),n.defineProperty(r,"height"),r.prototype.init=function(){if(o.prototype.init.apply(this,arguments),this.image_name(this._default_property.image_name),this.scale(this._default_property.scale),this.width(this._default_property.width),this.height(this._default_property.height),!this.width()&&!this.height()){var t=this.core.image_loader.getImage(this.image_name());this.width(t.width*this.scale()),this.height(t.height*this.scale())}},r.prototype.beforeDraw=function(){o.prototype.beforeDraw.apply(this,arguments)},r.prototype.draw=function(){if(this.isShow()){var t=this.core.image_loader.getImage(this.image_name()),e=t.width*this.scale(),i=t.height*this.scale(),n=this.core.ctx;n.save(),n.translate(this.x(),this.y()),n.drawImage(t,-e/2,-i/2,e,i),n.restore(),o.prototype.draw.apply(this,arguments)}},t.exports=r},function(t,e,i){"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n=i(66),r={exec:function(t,e,i){if(!t||"object"!==(void 0===t?"undefined":o(t)))throw new Error("type_info argument must be set");if(e=e||{pk:null,validate:!1},i=i||[],!e.pk)throw new Error("pk option must be set");for(var r=n.exec(t,e),s={},a=[],u=0,h=i.length;u<h;u++){var c=i[u];if(!(e.pk in c))throw new Error(e.pk+" key data does not exists in master data (index: "+u+")");var l=c[e.pk],_=new r(c);s[l]=_,a[u]=_}var p={};return p.DAOClass=r,p.find=function(t){return s[t]},p.all=function(){return a},p}};t.exports=r},function(t,e,i){"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n={exec:function(t,e){if(!t||"object"!==(void 0===t?"undefined":o(t)))throw new Error("type_info argument must be set");if(!(e=e||{pk:null}).pk)throw new Error("pk option must be set");var i=function(t){this._data=t||{}};for(var n in t)!function(t){i.prototype[t]=function(){return this._data[t]}}(n);return i}};t.exports=n},function(t,e,i){"use strict";var o=i(0).Scene.Loading,n=i(2),r=i(68),s=i(0).Util,a=function(t){o.apply(this,arguments)};s.inherit(a,o),a.prototype.init=function(){o.prototype.init.apply(this,[r])},a.prototype._loadSounds=function(t){var e=s.canPlayOgg()?".ogg":".m4a";for(var i in t){var o=t[i],r=n.DEBUG_MUTE?0:o.volume;this.core.audio_loader.loadSound(i,o.path+e,r)}},a.prototype.beforeDraw=function(){this.frame_count++,this.core.isAllLoaded()&&(this.frame_count>300||this.core.input_manager.isLeftClickPush())&&(n.DEBUG?this.core.scene_manager.changeScene(n.DEBUG_SCENE):this.core.scene_manager.changeScene("rule"))},a.prototype.draw=function(){o.prototype.draw.apply(this,arguments);var t=this.core.ctx;t.save(),t.fillStyle=n.COLOR_BLACK,t.fillRect(0,0,this.width,this.height),t.restore(),this._drawCaution(),this.core.isAllLoaded()||this._drawLoading()},a.prototype._drawCaution=function(){var t=this.core.ctx;t.save();var e=0;this.frame_count<100?e=3*this.frame_count/300:100<=this.frame_count&&this.frame_count<200?e=1:200<=this.frame_count&&this.frame_count<300&&(e=3*(300-this.frame_count)/300),t.globalAlpha=e;var i=this.core.image_loader.getImage("caution");t.translate(this.width/2,this.height/2),t.drawImage(i,-i.width/2,-i.height/2),t.restore()},a.prototype._drawLoading=function(){var t=this.core.ctx,e=this.frame_count%60,i="";i=15>e&&e>=0?"":30>e&&e>=15?".":45>e&&e>=30?"..":"...",t.save(),t.fillStyle=n.COLOR_WHITE,t.textAlign="left",t.font="30px 'MyFont'",t.fillText("Now Loading"+i,this.core.width-250,this.core.height-50),t.restore(),t.save(),t.fillStyle=n.COLOR_WHITE,t.fillRect(0,this.core.height-20,this.core.width*this.progress(),50),t.restore()},t.exports=a},function(t,e,i){"use strict";var o={images:{spotlight:"./image/spotlight.png",button_white:"./image/button_white.png",button_gray:"./image/button_gray.png",balloon_up_left:"./image/balloon_up_left.png",balloon_down_left:"./image/balloon_down_left.png",balloon_up_right:"./image/balloon_up_right.png",message_window:"./image/message_window.png",ex_clear:"./image/ex_clear.png",clear:"./image/clear.png",rule:"./image/rule.png",revolver:"./image/revolver.png",head_1:"./image/head/1.png",head_2:"./image/head/2.png",head_3:"./image/head/3.png",head_4:"./image/head/4.png",head_dead:"./image/head/died.png",body_1:"./image/body/1.png",body_2:"./image/body/2.png",body_3:"./image/body/3.png",body_4:"./image/body/4.png",body_5:"./image/body/5.png",eye_1_1:"./image/eye/1/1.png",eye_1_2:"./image/eye/1/2.png",eye_1_3:"./image/eye/1/3.png",eye_1_4:"./image/eye/1/4.png",eye_2_1:"./image/eye/2/5.png",eye_2_2:"./image/eye/2/6.png",eye_2_3:"./image/eye/2/7.png",eye_2_4:"./image/eye/2/8.png",eye_3_1:"./image/eye/3/9.png",eye_3_2:"./image/eye/3/10.png",eye_3_3:"./image/eye/3/11.png",eye_3_4:"./image/eye/3/12.png",eye_4_1:"./image/eye/4/13.png",eye_4_2:"./image/eye/4/14.png",eye_4_3:"./image/eye/4/15.png",eye_4_4:"./image/eye/4/16.png",mouse_1_1:"./image/mouse/1/1.png",mouse_1_2:"./image/mouse/1/2.png",mouse_1_3:"./image/mouse/1/3.png",mouse_1_4:"./image/mouse/1/4.png",mouse_2_1:"./image/mouse/2/5.png",mouse_2_2:"./image/mouse/2/6.png",mouse_2_3:"./image/mouse/2/7.png",mouse_2_4:"./image/mouse/2/8.png",mouse_3_1:"./image/mouse/3/9.png",mouse_3_2:"./image/mouse/3/10.png",mouse_3_3:"./image/mouse/3/11.png",mouse_3_4:"./image/mouse/3/12.png",mouse_4_1:"./image/mouse/4/13.png",mouse_4_2:"./image/mouse/4/14.png",mouse_4_3:"./image/mouse/4/15.png",mouse_4_4:"./image/mouse/4/16.png"},sounds:{heartbeat:{path:"./sound/heartbeat",volume:.25},lose:{path:"./sound/lose",volume:1},win:{path:"./sound/win",volume:1},draw:{path:"./sound/draw",volume:1},pass:{path:"./sound/pass",volume:1},next:{path:"./sound/next",volume:1},revolver_prepare:{path:"./sound/revolver_prepare",volume:1},revolver_fire:{path:"./sound/revolver_fire",volume:1},revolver_not_fire:{path:"./sound/revolver_not_fire",volume:1},clear:{path:"./sound/clear",volume:1},ex_clear:{path:"./sound/ex_clear",volume:1}},bgms:{},fonts:{MyFont:{path:"07LogoTypeGothic-Condense.ttf",format:"truetype"}}};t.exports=o},function(t,e,i){"use strict";var o=i(0).Scene.Base,n=i(0).Util,r=i(2),s=function(t){o.apply(this,arguments)};n.inherit(s,o),s.prototype.init=function(){o.prototype.init.apply(this,arguments),this.core.scene_manager.setFadeIn(60,r.COLOR_BLACK)},s.prototype.beforeDraw=function(){o.prototype.beforeDraw.apply(this,arguments),this.core.input_manager.isLeftClickPush()&&(this.core.scene_manager.setFadeOut(60,r.COLOR_BLACK),this.core.audio_loader.playSound("next"),this.core.scene_manager.changeScene("duel"))},s.prototype.draw=function(){o.prototype.draw.apply(this,arguments);var t=this.core.ctx;t.save(),t.fillStyle=r.COLOR_BLACK,t.fillRect(0,0,this.width,this.height),t.restore();this._drawText(30,10,18,r.COLOR_WHITE,"・ルール説明\n今、表になっているカードより、次にめくるカードの数字が大きいか小さいかを当てる。\n予想が的中すると所持金が2倍になるが、外すとロシアンルーレットとなる。\n数字が同じ場合は、何も起こらない。"),this._drawText(300,200,18,r.COLOR_WHITE,"High: 高い数字が出た場合に勝利。所持金が2倍になる。\nLow: 低い数字が出た場合に勝利。所持金が2倍になる。\nSame: 同じ数字が出た場合に勝利。所持金が10倍になる。\nPass: めくったカードをスルーする。\n"),this._drawText(300,350,18,r.COLOR_WHITE,"・クリア条件\n所持金1円を1億円に増やすこと"),this._drawText(300,450,18,r.COLOR_WHITE,"なお、山札(35枚)が無くなった時点で\n所持金が1億円に満たなければ即射殺となる。");var e=this.core.image_loader.getImage("rule");t.save(),t.translate(this.width/2-250,this.height/2+100),t.drawImage(e,-e.width/2,-e.height/2),t.restore()},s.prototype._drawText=function(t,e,i,o,n){var r=n.split("\n"),s=this.core.ctx;s.save(),s.fillStyle=o,s.font=i.toString()+"px 'MyFont'",s.textAlign="left";for(var a=0,u=r.length;a<u;a++)e+=1.5*i,s.fillText(r[a],t,e);s.restore()},t.exports=s},function(t,e,i){"use strict";var o=i(0).Scene.Base,n=i(0).Util,r=i(2),s=i(71),a=i(72),u=i(73),h=i(74),c=i(75),l=i(76),_=i(77),p=i(78),d=i(79),f=i(80),m=i(82),g=i(84),y=function(t){o.apply(this,arguments),this._deck=new f(this),this._opened_card=null,this.addSubScene("choose",new a(t)),this.addSubScene("dead",new u(t)),this.addSubScene("draw",new h(t)),this.addSubScene("lose",new c(t)),this.addSubScene("pass",new l(t)),this.addSubScene("win",new _(t)),this.addSubScene("not_reach",new p(t)),this.addSubScene("tutorial",new d(t)),this._marisa=new m(this),this._serif=new g(this),this.rule_manager=new s(this),this.addObjects([this._marisa,this._serif,this.rule_manager])};n.inherit(y,o),y.prototype.init=function(){o.prototype.init.apply(this,arguments),this._deck.init(),this.setNewCard(),this.core.is_finish_tutorial?this.changeSubScene("choose"):(this.core.is_finish_tutorial=!0,this.changeSubScene("tutorial"))},y.prototype.setNewCard=function(){this._opened_card=this._deck.serve(),this._opened_card.setPosition(r.OPEN_CARD_X,r.OPEN_CARD_Y),this._deck.topCard()&&this._deck.topCard().setPosition(r.TOP_CARD_X,r.TOP_CARD_Y)},y.prototype.marisa=function(){return this._marisa},y.prototype.deck=function(){return this._deck},y.prototype.opendCard=function(){return this._opened_card},y.prototype.showSerif=function(t){this._serif.show(t)},y.prototype.startSerifExtinguish=function(){this._serif.startExtinguish()},y.prototype.beforeDraw=function(){if(o.prototype.beforeDraw.apply(this,arguments),r.DEBUG&&this.core.input_manager.isLeftClickPush()){var t=this.core.input_manager.mousePositionX(),e=this.core.input_manager.mousePositionY();console.log("x: "+t+", y: "+e)}},y.prototype.draw=function(){var t=this.core.ctx;t.save(),t.fillStyle=r.COLOR_BLACK,t.fillRect(0,0,this.width,this.height);var e=this.core.image_loader.getImage("spotlight");t.drawImage(e,200,-100,e.width,e.height),t.restore(),this._deck.draw(),this._opened_card.draw(),this._deck.topCard()&&this._deck.topCard().draw();var i=this._deck.count();t.save(),t.fillStyle=r.COLOR_WHITE,t.font="36px 'MyFont'",t.textAlign="left",t.fillText("残りのカード："+i+"枚",50,550),t.fillText("所持金："+this.rule_manager.money()+"円",50,600),t.restore(),o.prototype.draw.apply(this,arguments)},t.exports=y},function(t,e,i){"use strict";var o=i(0).util,n=i(0).Object.Base,r=i(2),s=function(t){n.apply(this,arguments),this._bullet_num=0,this._money=0};o.inherit(s,n),s.prototype.init=function(t){n.prototype.init.apply(this,arguments),this._bullet_num=5,this._money=1},s.prototype.beforeDraw=function(){n.prototype.beforeDraw.apply(this,arguments)},s.prototype.draw=function(){n.prototype.draw.apply(this,arguments)},s.prototype.twiceMoney=function(){this._money*=2},s.prototype.isGameOver=function(){return 0===this.scene.deck().count()&&this._money<r.CLEAR_NEED_MONEY},s.prototype.isClear=function(){return 0===this.scene.deck().count()&&r.EX_CLEAR_NEED_MONEY>this._money&&this._money>=r.CLEAR_NEED_MONEY},s.prototype.isExClear=function(){return 0===this.scene.deck().count()&&this._money>=r.EX_CLEAR_NEED_MONEY},s.prototype.pass=function(){this.scene.changeSubScene("pass")},s.prototype.chooseHigh=function(){var t=this.scene.deck().topCard().number(),e=this.scene.opendCard().number();t>e?(this.twiceMoney(),this.scene.changeSubScene("win")):t===e?this.scene.changeSubScene("draw"):t<e&&this.scene.changeSubScene("lose")},s.prototype.chooseLow=function(){var t=this.scene.deck().topCard().number(),e=this.scene.opendCard().number();t>e?this.scene.changeSubScene("lose"):t===e?this.scene.changeSubScene("draw"):t<e&&(this.twiceMoney(),this.scene.changeSubScene("win"))},s.prototype.chooseSame=function(){this.scene.deck().topCard().number()===this.scene.opendCard().number()?(this._money*=10,this.scene.changeSubScene("win")):this.scene.changeSubScene("lose")},s.prototype.roulette=function(){var t=o.getRandomInt(this._bullet_num);return this._bullet_num--,1===t},s.prototype.money=function(){return this._money},t.exports=s},function(t,e,i){"use strict";var o=i(8),n=i(0).Util,r=i(37),s=function(t){o.apply(this,arguments);var e=r.exec(this);this._pass_button=e.pass_button,this._high_button=e.high_button,this._low_button=e.low_button,this._same_button=e.same_button,this.addObjects([this._high_button,this._low_button,this._same_button,this._pass_button])};n.inherit(s,o),s.prototype.init=function(){o.prototype.init.apply(this,arguments)},s.prototype.beforeDraw=function(){o.prototype.beforeDraw.apply(this,arguments);var t=this.core.input_manager.mousePositionX(),e=this.core.input_manager.mousePositionY();if(this.core.input_manager.isLeftClickPush())this._pass_button.checkCollisionWithPosition(t,e)?(this.parent.showSerif("Pass!"),this.parent.rule_manager.pass(),this._pass_button.setVariable("isclick",!0)):this._high_button.checkCollisionWithPosition(t,e)?(this.parent.showSerif("High!"),this.parent.rule_manager.chooseHigh(),this._high_button.setVariable("isclick",!0)):this._low_button.checkCollisionWithPosition(t,e)?(this.parent.showSerif("Low!"),this.parent.rule_manager.chooseLow(),this._low_button.setVariable("isclick",!0)):this._same_button.checkCollisionWithPosition(t,e)&&(this.parent.showSerif("Same!"),this.parent.rule_manager.chooseSame(),this._same_button.setVariable("isclick",!0));else for(var i=[this._high_button,this._low_button,this._same_button,this._pass_button],n=0,r=i.length;n<r;n++){var s=i[n];s.checkCollisionWithPosition(t,e)?s.setVariable("onmouse",!0):s.setVariable("onmouse",!1),s.setVariable("isclick",!1)}},s.prototype.draw=function(){o.prototype.draw.apply(this,arguments)},t.exports=s},function(t,e,i){"use strict";var o=i(8),n=i(0).Util,r=i(2),s=function(t){o.apply(this,arguments),this._flash_transparent=0,this._message_transparent=0};n.inherit(s,o),s.prototype.init=function(){o.prototype.init.apply(this,arguments),this._flash_transparent=0,this._message_transparent=0,this.core.audio_loader.playSound("revolver_fire")},s.prototype.beforeDraw=function(){o.prototype.beforeDraw.apply(this,arguments),this.frame_count<6?this._flash_transparent=this.frame_count/6:6===this.frame_count?(this._flash_transparent=1,this.parent.marisa().die()):this.frame_count<=12?this._flash_transparent=(12-this.frame_count)/6:this.frame_count<=30||(this.frame_count<=60?this._message_transparent+=1/30:this.core.input_manager.isLeftClickPush()&&this.core.scene_manager.changeScene("duel"))},s.prototype.draw=function(){o.prototype.draw.apply(this,arguments);var t=this.core.ctx,e=this.core.image_loader.getImage("revolver");if(t.save(),t.translate(r.MARISA_CENTER_X,r.MARISA_CENTER_Y),t.drawImage(e,-e.width/2,-e.height/2),t.restore(),this._flash_transparent>0)t.save(),t.fillStyle=r.COLOR_WHITE,t.globalAlpha=this._flash_transparent,t.fillRect(0,0,this.width,this.height),t.restore();else if(this._message_transparent>0){t.save(),t.globalAlpha=this._message_transparent,t.translate(this.width/2,this.height/2);var i=this.core.image_loader.getImage("message_window");t.drawImage(i,-200,-100,400,200),t.fillStyle=r.COLOR_VIVID_RED,t.font="36px 'MyFont'",t.textAlign="center",t.textBaseline="middle",t.fillText("射殺された...",0,0),t.restore()}},t.exports=s},function(t,e,i){"use strict";var o=i(13),n=i(0).Util,r=i(21),s=i(2),a=function(t){o.apply(this,arguments),this._judge_message=new r(this),this.addObjects([this._judge_message])};n.inherit(a,o),a.prototype.init=function(){o.prototype.init.apply(this,arguments),this.parent.deck().topCard().flip(),this._judge_message.show("DRAW",s.COLOR_GREEN),this.core.audio_loader.playSound("draw")},a.prototype.beforeDraw=function(){if(o.prototype.beforeDraw.apply(this,arguments),!(this.frame_count<60)){if(60===this.frame_count)return this.parent.startSerifExtinguish(),void this._judge_message.extinguish();if(!this.core.scene_manager.isInFadeOut()){var t=this.parent.deck().topCard().x();t<s.OPEN_CARD_X?(t+=10,this.parent.deck().topCard().x(t)):(this.parent.setNewCard(),this.parent.rule_manager.isClear()?(this.core.scene_manager.setFadeOut(60,s.COLOR_BLACK),this.core.scene_manager.changeScene("clear",this.parent.rule_manager.money())):this.parent.rule_manager.isExClear()?(this.core.scene_manager.setFadeOut(60,s.COLOR_BLACK),this.core.scene_manager.changeScene("clear_ex",this.parent.rule_manager.money())):this.parent.rule_manager.isGameOver()?this.parent.changeSubScene("not_reach"):(this.parent.marisa().rouletteFace(),this.parent.changeSubScene("choose")))}}},a.prototype.draw=function(){o.prototype.draw.apply(this,arguments)},t.exports=a},function(t,e,i){"use strict";var o=i(13),n=i(0).Util,r=i(21),s=i(2),a=function(t){o.apply(this,arguments),this._judge_message=new r(this),this.addObjects([this._judge_message]),this._gun_transparent=0,this._is_start_gun_extinguish=!1};n.inherit(a,o),a.prototype.init=function(){o.prototype.init.apply(this,arguments),this._gun_transparent=0,this._is_start_gun_extinguish=!1,this.parent.deck().topCard().flip(),this._judge_message.show("LOSE...",s.COLOR_BLUE),this.core.audio_loader.playSound("lose")},a.prototype.beforeDraw=function(){if(o.prototype.beforeDraw.apply(this,arguments),this._is_start_gun_extinguish&&0!==this._gun_transparent&&(this._gun_transparent-=.1,this._gun_transparent<=0&&(this._is_start_gun_extinguish=!1,this._gun_transparent=0)),!(this.frame_count<60)){if(60===this.frame_count)return this.parent.startSerifExtinguish(),this._judge_message.extinguish(),this.parent.marisa().gunPointed(),void this._showGun();if(!(this.frame_count<180))if(180!==this.frame_count){if(!this.core.scene_manager.isInFadeOut()){var t=this.parent.deck().topCard().x();t<s.OPEN_CARD_X?(t+=10,this.parent.deck().topCard().x(t)):(this.parent.setNewCard(),this.parent.rule_manager.isClear()?(this.core.scene_manager.setFadeOut(60,s.COLOR_BLACK),this.core.scene_manager.changeScene("clear",this.parent.rule_manager.money())):this.parent.rule_manager.isExClear()?(this.core.scene_manager.setFadeOut(60,s.COLOR_BLACK),this.core.scene_manager.changeScene("clear_ex",this.parent.rule_manager.money())):this.parent.rule_manager.isGameOver()?this.parent.changeSubScene("not_reach"):(this.parent.marisa().rouletteFace(),this.parent.changeSubScene("choose")))}}else this.parent.rule_manager.roulette()?this.parent.changeSubScene("dead"):(this.parent.marisa().survive(),this._hideGun())}},a.prototype.draw=function(){if(o.prototype.draw.apply(this,arguments),0!==this._gun_transparent){var t=this.core.ctx,e=this.core.image_loader.getImage("revolver");t.save(),t.globalAlpha=this._gun_transparent,t.translate(s.MARISA_CENTER_X,s.MARISA_CENTER_Y),t.drawImage(e,-e.width/2,-e.height/2),t.restore()}},a.prototype._showGun=function(){this.core.audio_loader.playSound("revolver_prepare"),this._gun_transparent=1},a.prototype._hideGun=function(){this.core.audio_loader.playSound("revolver_not_fire"),this._is_start_gun_extinguish=!0},t.exports=a},function(t,e,i){"use strict";var o=i(13),n=i(0).Util,r=i(2),s=function(t){o.apply(this,arguments)};n.inherit(s,o),s.prototype.init=function(){o.prototype.init.apply(this,arguments),this.parent.deck().topCard().flip(),this.core.audio_loader.playSound("pass")},s.prototype.beforeDraw=function(){if(o.prototype.beforeDraw.apply(this,arguments),!(this.frame_count<60))if(60!==this.frame_count){if(!this.core.scene_manager.isInFadeOut()){var t=this.parent.deck().topCard().x();t<r.OPEN_CARD_X?(t+=10,this.parent.deck().topCard().x(t)):(this.parent.setNewCard(),this.parent.rule_manager.isClear()?(this.core.scene_manager.setFadeOut(60,r.COLOR_BLACK),this.core.scene_manager.changeScene("clear",this.parent.rule_manager.money())):this.parent.rule_manager.isExClear()?(this.core.scene_manager.setFadeOut(60,r.COLOR_BLACK),this.core.scene_manager.changeScene("clear_ex",this.parent.rule_manager.money())):this.parent.rule_manager.isGameOver()?this.parent.changeSubScene("not_reach"):(this.parent.marisa().rouletteFace(),this.parent.changeSubScene("choose")))}}else this.parent.startSerifExtinguish()},s.prototype.draw=function(){o.prototype.draw.apply(this,arguments)},t.exports=s},function(t,e,i){"use strict";var o=i(13),n=i(0).Util,r=i(21),s=i(2),a=function(t){o.apply(this,arguments),this._judge_message=new r(this),this.addObjects([this._judge_message])};n.inherit(a,o),a.prototype.init=function(){o.prototype.init.apply(this,arguments),this.parent.deck().topCard().flip(),this._judge_message.show("WIN !",s.COLOR_RED),this.core.audio_loader.playSound("win")},a.prototype.beforeDraw=function(){if(o.prototype.beforeDraw.apply(this,arguments),!(this.frame_count<60)){if(60===this.frame_count)return this.parent.startSerifExtinguish(),void this._judge_message.extinguish();if(!this.core.scene_manager.isInFadeOut()){var t=this.parent.deck().topCard().x();t<s.OPEN_CARD_X?(t+=10,this.parent.deck().topCard().x(t)):(this.parent.setNewCard(),this.parent.rule_manager.isClear()?(this.core.scene_manager.setFadeOut(60,s.COLOR_BLACK),this.core.scene_manager.changeScene("clear",this.parent.rule_manager.money())):this.parent.rule_manager.isExClear()?(this.core.scene_manager.setFadeOut(60,s.COLOR_BLACK),this.core.scene_manager.changeScene("clear_ex",this.parent.rule_manager.money())):this.parent.rule_manager.isGameOver()?this.parent.changeSubScene("not_reach"):(this.parent.marisa().rouletteFace(),this.parent.changeSubScene("choose")))}}},a.prototype.draw=function(){o.prototype.draw.apply(this,arguments)},t.exports=a},function(t,e,i){"use strict";var o=i(8),n=i(0).Util,r=i(2),s=function(t){o.apply(this,arguments),this._message_transparent=0,this._gun_transparent=0};n.inherit(s,o),s.prototype.init=function(){o.prototype.init.apply(this,arguments),this._message_transparent=0,this._gun_transparent=0},s.prototype.beforeDraw=function(){o.prototype.beforeDraw.apply(this,arguments),this.frame_count<30?this._message_transparent+=1/30:30===this.frame_count?this.parent.marisa().gunPointed():this.frame_count<90||(90===this.frame_count?(this._gun_transparent=1,this.core.audio_loader.playSound("revolver_prepare")):this.frame_count<210||this.parent.changeSubScene("dead"))},s.prototype.draw=function(){o.prototype.draw.apply(this,arguments);var t=this.core.ctx;if(this._message_transparent>0){t.save(),t.globalAlpha=this._message_transparent,t.translate(this.width/2,this.height/2);var e=this.core.image_loader.getImage("message_window");t.drawImage(e,-300,-100,600,200),t.fillStyle=r.COLOR_VIVID_RED,t.font="36px 'MyFont'",t.textAlign="center",t.textBaseline="middle",t.fillText("獲得金額が1億円に満たない！",0,0),t.restore()}if(this._gun_transparent>0){var i=this.core.image_loader.getImage("revolver");t.save(),t.globalAlpha=this._gun_transparent,t.translate(r.MARISA_CENTER_X,r.MARISA_CENTER_Y),t.drawImage(i,-i.width/2,-i.height/2),t.restore()}},t.exports=s},function(t,e,i){"use strict";var o=i(8),n=i(0).Util,r=i(37),s=i(2),a=[{x:120,y:200,window:"balloon_up_left",text:"左のカードが、右のカードより\n大きいか小さいか当てる"},{x:200,y:450,window:"balloon_up_left",text:"左のカードの数字の方が大きいと\n思えば High を押す"},{x:290,y:450,window:"balloon_up_left",text:"左のカードの数字の方が小さいと\n思えば Low を押す"},{x:370,y:450,window:"balloon_up_left",text:"左のカードと右のカードの数字が\n同じだと思えば Same を押す"},{x:370,y:450,window:"balloon_up_left",text:"Same が当たれば、所持金が\n10倍になる"},{x:100,y:450,window:"balloon_up_left",text:"わからなければ Pass を\n押せばスルーできる"},{x:100,y:450,window:"balloon_up_left",text:"Pass にデメリットはない\n何回でも Pass できる"},{x:150,y:330,window:"balloon_down_left",text:"まだ出現したことのないカードは\nここに表示される"},{x:500,y:150,window:"balloon_up_right",text:"所持金が1億を超えると\n霧雨魔理沙は解放される"},{x:150,y:550,window:"balloon_up_left",text:"所持金が1億を超えてもゲームは続く\nPass し続ければゲームは終わる"},{x:150,y:550,window:"balloon_up_left",text:"それでは健闘を祈る"}],u=2,h=1,c=function(t){o.apply(this,arguments),this._step=0;var e=r.exec(this);this._pass_button=e.pass_button,this._high_button=e.high_button,this._low_button=e.low_button,this._same_button=e.same_button,this.addObjects([this._high_button,this._low_button,this._same_button,this._pass_button])};n.inherit(c,o),c.prototype.init=function(){o.prototype.init.apply(this,arguments),this._step=0},c.prototype.beforeDraw=function(){o.prototype.beforeDraw.apply(this,arguments),this.core.input_manager.isLeftClickPush()&&(this._step++,this.core.audio_loader.playSound("next"),this._step>=a.length&&this.parent.changeSubScene("choose"))},c.prototype.draw=function(){o.prototype.draw.apply(this,arguments),this._drawCurrentStepMessage()},c.prototype._drawCurrentStepMessage=function(){if(this._step in a){var t=a[this._step];this._drawWindow(t.x,t.y,t.window),this._drawText(t.x,t.y,t.window,t.text)}},c.prototype._drawWindow=function(t,e,i){var o=this.core.ctx;o.save(),o.translate(t,e);var n=this.core.image_loader.getImage(i);o.drawImage(n,-110,-n.height*h,n.width*u,n.height*h),o.restore()},c.prototype._drawText=function(t,e,i,o){e-=this.core.image_loader.getImage(i).height*h-40,t+=-60;var n=o.split("\n"),r=this.core.ctx;r.save(),r.fillStyle=s.COLOR_BLACK,r.font=18..toString()+"px 'MyFont'",r.textAlign="left";for(var a=0,u=n.length;a<u;a++)e+=27,r.fillText(n[a],t,e);r.restore()},t.exports=c},function(t,e,i){"use strict";var o=i(0).Object.Container,n=i(0).Util,r=i(81),s=i(2),a=function(t){o.apply(this,arguments),this._top_card=null};n.inherit(a,o),a.prototype.init=function(){o.prototype.init.apply(this,arguments),this._top_card=null,this._generateCard(),this._setTopCard()},a.prototype._generateCard=function(){this.removeAllObject();for(var t=1;t<=9;t++)for(var e=0;e<=3;e++){var i=new r(this);i.init(),i.setType(e,t),this.addObject(i)}},a.prototype._setTopCard=function(){var t=this.count();if(0!==t){var e=n.getRandomInt(t)-1,i=Object.keys(this.objects)[e];this._top_card=this.get(i)}else this._top_card=null},a.prototype.beforeDraw=function(){o.prototype.beforeDraw.apply(this,arguments)},a.prototype.draw=function(){var t=this.core.ctx;t.save();var e=n.shallowCopyHash(this.objects);for(var i in e){var o=e[i],r=90,a=50;o.type()===s.TYPE_RED?(t.fillStyle=s.COLOR_RED,a+=0):o.type()===s.TYPE_BLUE?(t.fillStyle=s.COLOR_BLUE,a+=30):o.type()===s.TYPE_GREEN?(t.fillStyle=s.COLOR_GREEN,a+=60):o.type()===s.TYPE_PURPLE&&(t.fillStyle=s.COLOR_PURPLE,a+=90),r+=20*o.number(),t.fillRect(r,a,20,30),t.strokeStyle=s.COLOR_WHITE,t.beginPath(),t.moveTo(r,a),t.lineTo(r+20,a),t.lineTo(r+20,a+30),t.lineTo(r,a+30),t.closePath(),t.stroke(),t.fillStyle=s.COLOR_WHITE,t.font="18px 'MyFont'",t.textAlign="center",t.textBaseline="middle",t.fillText(o.number(),r+10,a+15)}t.restore()},a.prototype.serve=function(){var t=this.removeObject(this._top_card);return t.isReverse()&&t.flip(),this._setTopCard(),t},a.prototype.topCard=function(){return this._top_card},t.exports=a},function(t,e,i){"use strict";var o=i(0).Object.Base,n=i(0).Util,r=i(2),s=function(t){o.apply(this,arguments),this._type=null,this._number=null,this._is_reverse=!0};n.inherit(s,o),s.prototype.init=function(){o.prototype.init.apply(this,arguments),this._type=null,this._number=null,this._is_reverse=!0},s.prototype.flip=function(){this._is_reverse=!this._is_reverse},s.prototype.isReverse=function(){return this._is_reverse},s.prototype.setType=function(t,e){this._type=t,this._number=e},s.prototype.type=function(){return this._type},s.prototype.number=function(){return this._number},s.prototype.beforeDraw=function(){o.prototype.beforeDraw.apply(this,arguments)},s.prototype.draw=function(){o.prototype.draw.apply(this,arguments);var t=this.core.ctx;t.save(),t.translate(this.x(),this.y()),this.type()===r.TYPE_RED?t.fillStyle=r.COLOR_RED:this.type()===r.TYPE_BLUE?t.fillStyle=r.COLOR_BLUE:this.type()===r.TYPE_GREEN?t.fillStyle=r.COLOR_GREEN:this.type()===r.TYPE_PURPLE&&(t.fillStyle=r.COLOR_PURPLE);var e=this.width()/2,i=this.height()/2;t.fillRect(-e,-i,this.width(),this.height()),t.lineWidth=5,t.strokeStyle=r.COLOR_WHITE,t.beginPath(),t.moveTo(e,i),t.lineTo(-e,i),t.lineTo(-e,-i),t.lineTo(e,-i),t.closePath(),t.stroke(),this._is_reverse?(t.beginPath(),t.moveTo(e,i),t.lineTo(-e,-i),t.closePath(),t.stroke(),t.beginPath(),t.moveTo(-e,i),t.lineTo(e,-i),t.closePath(),t.stroke()):(t.fillStyle=r.COLOR_WHITE,t.font="192px 'MyFont'",t.textAlign="center",t.textBaseline="middle",t.fillText(this.number(),0,0)),t.restore()},s.prototype.width=function(){return 135},s.prototype.height=function(){return 200},t.exports=s},function(t,e,i){"use strict";var o=i(0).Object.Base,n=i(0).Util,r=i(2),s=i(83),a=["body_1","body_2","body_3","body_4","body_5"],u=["head_1","head_2","head_3","head_4","head_4"],h=[["mouse_1_1","mouse_1_2","mouse_1_3","mouse_1_4"],["mouse_2_1","mouse_2_2","mouse_2_3","mouse_2_4"],["mouse_3_1","mouse_3_2","mouse_3_3","mouse_3_4"],["mouse_4_1","mouse_4_2","mouse_4_3","mouse_4_4"],["mouse_4_1","mouse_4_2","mouse_4_3","mouse_4_4"]],c=[["eye_1_1","eye_1_2","eye_1_3","eye_1_4"],["eye_1_1","eye_1_2","eye_1_3","eye_1_4"],["eye_2_1","eye_2_2","eye_2_3","eye_2_4"],["eye_3_1","eye_3_2","eye_3_3","eye_3_4"],["eye_4_1","eye_4_2","eye_4_3","eye_4_4"],["eye_4_1","eye_4_2","eye_4_3","eye_4_4"]],l=function(t){o.apply(this,arguments),this._is_dead=!1,this._dread_idx=0,this._body_image=null,this._head_image=null,this._mouse_image=null,this._eye_image=null,this._heartbeat_manager=new s(this.scene),this.addSubObject(this._heartbeat_manager)};n.inherit(l,o),l.prototype.init=function(){o.prototype.init.apply(this,arguments),this._is_dead=!1,this._dread_idx=0,this._body_image=null,this._head_image=null,this._mouse_image=null,this._eye_image=null,this._setFace(this._dread_idx,0,0)},l.prototype.beforeDraw=function(){o.prototype.beforeDraw.apply(this,arguments)},l.prototype.draw=function(){o.prototype.draw.apply(this,arguments);var t,e,i,n,s=this.core.ctx;this._is_dead?(t=this.core.image_loader.getImage(this._body_image),e=this.core.image_loader.getImage("head_dead"),s.save(),s.translate(r.MARISA_CENTER_X,r.MARISA_CENTER_Y),s.drawImage(t,-t.width/2,-t.height/2),s.drawImage(e,-e.width/2,-e.height/2),s.restore()):(t=this.core.image_loader.getImage(this._body_image),e=this.core.image_loader.getImage(this._head_image),i=this.core.image_loader.getImage(this._mouse_image),n=this.core.image_loader.getImage(this._eye_image),s.save(),s.translate(r.MARISA_CENTER_X,r.MARISA_CENTER_Y),s.drawImage(t,-t.width/2,-t.height/2),s.drawImage(e,-e.width/2,-e.height/2),s.drawImage(i,-i.width/2,-i.height/2),s.drawImage(n,-n.width/2,-n.height/2),s.restore())},l.prototype.die=function(){this._heartbeat_manager.stop(),this._is_dead=!0},l.prototype.gunPointed=function(){this._heartbeat_manager.accelerateFaster()},l.prototype.survive=function(){this._heartbeat_manager.calmDown(),this._heartbeat_manager.accelerate(),this._dread_idx++},l.prototype.rouletteFace=function(){var t=n.getRandomInt(4)-1,e=n.getRandomInt(4)-1;this._setFace(this._dread_idx,t,e)},l.prototype._setFace=function(t,e,i){this._body_image=a[t],this._head_image=u[t],this._mouse_image=h[t][e],this._eye_image=c[t][i]},t.exports=l},function(t,e,i){"use strict";var o=i(0).util,n=i(0).Object.Base,r=function(t){n.apply(this,arguments),this._next_heart_rate=0,this._prev_heart_rate=0,this._current_heart_rate=0};o.inherit(r,n),r.prototype.init=function(){n.prototype.init.apply(this,arguments),this._next_heart_rate=60,this._prev_heart_rate=0,this._current_heart_rate=this._next_heart_rate},r.prototype.beforeDraw=function(){n.prototype.beforeDraw.apply(this,arguments),0!==this._next_heart_rate&&this.frame_count%this._current_heart_rate==0&&(this.core.audio_loader.playSound("heartbeat"),this._next_heart_rate!==this._current_heart_rate&&(this.frame_count=0,this._prev_heart_rate=this._current_heart_rate,this._current_heart_rate=this._next_heart_rate))},r.prototype.accelerate=function(){this._next_heart_rate-=5},r.prototype.accelerateFaster=function(){this._next_heart_rate=30},r.prototype.calmDown=function(){this._next_heart_rate=this._prev_heart_rate},r.prototype.stop=function(){this._next_heart_rate=0},t.exports=r},function(t,e,i){"use strict";var o=i(0).Object.Base,n=i(0).Util,r=i(2),s=1,a=1,u=function(t){o.apply(this,arguments),this._text="",this._transparent=0,this._is_start_extinguish=!1};n.inherit(u,o),u.prototype.init=function(){o.prototype.init.apply(this,arguments),this._text="",this._transparent=0,this._is_start_extinguish=!1},u.prototype.beforeDraw=function(){o.prototype.beforeDraw.apply(this,arguments),this._is_start_extinguish&&0!==this._transparent&&(this._transparent-=.1,this._transparent<=0&&(this._is_start_extinguish=!1,this._transparent=0))},u.prototype.draw=function(){o.prototype.draw.apply(this,arguments),0!==this._transparent&&(this._drawWindow(610,280),this._drawText(610,280,this._text))},u.prototype._drawWindow=function(t,e){var i=this.core.ctx;i.save(),i.translate(t,e);var o=this.core.image_loader.getImage("balloon_down_left");i.globalAlpha=this._transparent,i.drawImage(o,-60,0,o.width*s,o.height*a),i.restore()},u.prototype._drawText=function(t,e,i){e-=-40,t+=-10;var o=i.split("\n"),n=this.core.ctx;n.save(),n.globalAlpha=this._transparent,n.fillStyle=r.COLOR_BLACK,n.font=36..toString()+"px 'MyFont'",n.textAlign="left";for(var s=0,a=o.length;s<a;s++)e+=54,n.fillText(o[s],t,e);n.restore()},u.prototype.show=function(t){this._transparent=1,this._text=t},u.prototype.startExtinguish=function(){this._is_start_extinguish=!0},t.exports=u},function(t,e,i){"use strict";var o=i(38),n=function(t){o.apply(this,arguments)};i(0).Util.inherit(n,o),n.prototype.soundName=function(){return"clear"},n.prototype.bgName=function(){return"clear"},t.exports=n},function(t,e,i){"use strict";var o=i(38),n=function(t){o.apply(this,arguments)};i(0).Util.inherit(n,o),n.prototype.soundName=function(){return"ex_clear"},n.prototype.bgName=function(){return"ex_clear"},t.exports=n},function(t,e,i){"use strict";var o={images:{caution:"./image/caution.png"},sounds:{},bgms:{},fonts:{}};t.exports=o}]);